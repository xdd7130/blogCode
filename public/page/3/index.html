
<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <title>DD_XIE的学习笔记</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="">
    <meta name="description" content="前端学习">
    
        <link rel="icon" href="/favicon.ico">
    
    
        
            <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
        
            <link rel="stylesheet" href="/css/stage.css">
        
            <link rel="stylesheet" href="/css/avatar-bg.css">
        
    
</head>
</html>
<body>
<header id="header">
    <div class="menu">
        <i class="fa fa-bars"></i>
    </div>
    <div class="header-main">
        <h1><a href="/">DD_XIE的学习笔记</a></h1>
    </div>
    <div id="nav">
        <div class="nav-img" id="nav-img"></div>
        <div class="sentences">
            时光荏苒，旦夕之间，略有遗憾，似白驹过隙，蹉跎自悟。
        </div>
    </div>
</header>

<div id="content-outer">
    <div id="content-inner">
        <div class="clearfix">
    
    <div id="recent-posts">
        
            <div class="post-item">
                <h1>
                    <a href="/2019/08/06/ArcGIS-API-for-JS23/">
                        ArcGIS API For Javascript之地图输出
                    </a>
                </h1>
                <div class="create">
                    <span>创建于</span>
                    
                        <time datetime="2019-08-06T09:54:17.000Z">
                            2019-08-06
                        </time>
                    
                    <ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/ArcGIS/">ArcGIS</a></li></ul>
                </div>
                
                    <p>在WebGIS中地图输出是一个比较常用的功能，当我们制图结束时，往往要将我们的地图打印成一张图片保存起来，在ArcGIS API要想实现地图打印，需要借助PrintingTools工具，此工具实质上是一个GP工具，因为是GP工具，所以地图的生成是在服务器端生成的，也可以叫做服务器端打印.<br>服务器端打印的执行对象是 PrintTask，打印的参数是 PrintParameters，通过设置打印模板对象PrintTemplate，可以对图片的大小，像素，格式等进行设置</p>
<h3 id="启用PrintingTools-工具"><a href="#启用PrintingTools-工具" class="headerlink" title="启用PrintingTools 工具"></a>启用PrintingTools 工具</h3><p>PrintingTools 和几何服务一样，默认情况下是关闭的，我们应当开启此工具<br>默认情况下关闭<br><img src="/2019/08/06/ArcGIS-API-for-JS23/01.png" alt="01.png"><br>启动成功<br><img src="/2019/08/06/ArcGIS-API-for-JS23/02.png" alt="02.png"><br>要使用的URL<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:6080/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task</span><br></pre></td></tr></table></figure></p>
<h3 id="使用PrintingTools-打印地图"><a href="#使用PrintingTools-打印地图" class="headerlink" title="使用PrintingTools 打印地图"></a>使用PrintingTools 打印地图</h3><h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><p>加载地图（略）<br>添加两个按钮（一个按钮用于画polygon，一个按钮用于地图打印）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;button class=&quot;pbtn&quot; &gt;画多边形&lt;/button&gt;</span><br><span class="line">&lt;input id=&quot;Btn&quot; type=&quot;button&quot; value=&quot;地图打印&quot; /&gt;</span><br></pre></td></tr></table></figure></p>
<p>创建相关对象（例如：绘图对象，符号对象）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//创建绘图对象</span><br><span class="line">var toolBar = new Draw(map);        </span><br><span class="line">//线符号</span><br><span class="line">lineSymbol = new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new Color([255, 0, 0]), 3);</span><br><span class="line">//面符号</span><br><span class="line">polygonSymbol = new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol, new Color([255, 0, 0, 0.25]));</span><br></pre></td></tr></table></figure></p>
<p>给绘制多边形按钮绑定事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//给绘制polygon的按钮绑定事件</span><br><span class="line">query(&quot;.pbtn&quot;).on(&quot;click&quot;,function(event)&#123;</span><br><span class="line">    //激活绘制多边形</span><br><span class="line">    toolBar.activate(Draw.POLYGON, &#123;</span><br><span class="line">        showTooltips:true</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line">//绘图结束绑定事件</span><br><span class="line">on(toolBar,&quot;draw-end&quot;,function(result)&#123;</span><br><span class="line">    //获得面形状</span><br><span class="line">    var geometry=result.geometry;</span><br><span class="line">    //创建Graphic</span><br><span class="line">    var graphicpoint= new Graphic(geometry, polygonSymbol);</span><br><span class="line">    map.graphics.add(graphicpoint); </span><br><span class="line">    //关闭绘图工具</span><br><span class="line">    toolBar.deactivate();                   </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>给地图打印按钮绑定事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">//给地图打印按钮绑定事件</span><br><span class="line">                on(dom.byId(&quot;Btn&quot;),&quot;click&quot;,function()&#123;</span><br><span class="line">                    //创建地图打印对象</span><br><span class="line">                    var printMap = new PrintTask(&quot;http://localhost:6080/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task&quot;);</span><br><span class="line">                    //创建地图打印模版</span><br><span class="line">                    var template = new PrintTemplate();</span><br><span class="line">                    //创建地图的打印参数，参数里面包括：模版和地图</span><br><span class="line">                    var params = new PrintParameters(); </span><br><span class="line">                    //输出图片的空间参考</span><br><span class="line">                    printMap.outSpatialReference = map.SpatialReference </span><br><span class="line">                    //打印图片的各种参数</span><br><span class="line">                    template.exportOptions = &#123; </span><br><span class="line">                        width: 850, </span><br><span class="line">                        height: 650, </span><br><span class="line">                        dpi: 96 </span><br><span class="line">                    &#125;;</span><br><span class="line">                    //打印输出的格式</span><br><span class="line">                    template.format = &quot;PDF&quot;; </span><br><span class="line">                    //输出地图的布局</span><br><span class="line">                    template.layout = &quot;MAP_ONLY&quot;; </span><br><span class="line">                    PrintTemplate </span><br><span class="line">                    //设置参数地图</span><br><span class="line">                    params.map = map; </span><br><span class="line">                    //设置参数模版</span><br><span class="line">                    params.template = template; </span><br><span class="line">                    //运行结果</span><br><span class="line">                    printMap.execute(params, function(result)&#123;</span><br><span class="line">                        if (result != null) &#123; </span><br><span class="line">                            //网页打开生成的地图</span><br><span class="line">                            window.open(result.url); </span><br><span class="line">                        &#125; </span><br><span class="line">                    &#125;)</span><br></pre></td></tr></table></figure></p>
<h4 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h4><p><img src="/2019/08/06/ArcGIS-API-for-JS23/03.png" alt="03.png"><br><img src="/2019/08/06/ArcGIS-API-for-JS23/04.png" alt="04.png"></p>
<h4 id="全部代码"><a href="#全部代码" class="headerlink" title="全部代码"></a>全部代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;/&gt;</span><br><span class="line">    &lt;title&gt;地图打印&lt;/title&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script  type=&quot;text/Javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">        .MapClass&#123;</span><br><span class="line">            width:100%;</span><br><span class="line">            height:500px;</span><br><span class="line">            border:1px solid #000;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line"></span><br><span class="line">        require([&quot;esri/map&quot;,</span><br><span class="line">            &quot;dojo/dom&quot;,&quot;dojo/on&quot;,&quot;dojo/query&quot;,</span><br><span class="line">            &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleMarkerSymbol&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleLineSymbol&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleFillSymbol&quot;,</span><br><span class="line">            &quot;esri/toolbars/draw&quot;,</span><br><span class="line">            &quot;esri/graphic&quot;,</span><br><span class="line">            &quot;esri/tasks/PrintTask&quot;,</span><br><span class="line">            &quot;esri/tasks/PrintTemplate&quot;,</span><br><span class="line">            &quot;esri/tasks/PrintParameters&quot;,</span><br><span class="line">            &quot;dojo/colors&quot;,</span><br><span class="line">            &quot;dojo/domReady!&quot;],</span><br><span class="line">            function (Map,dom,on,query,</span><br><span class="line">                ArcGISDynamicMapServiceLayer,</span><br><span class="line">                SimpleMarkerSymbol,</span><br><span class="line">                SimpleLineSymbol,</span><br><span class="line">                SimpleFillSymbol,</span><br><span class="line">                Draw,</span><br><span class="line">                Graphic,</span><br><span class="line">                PrintTask,PrintTemplate,PrintParameters,</span><br><span class="line">                Color) &#123;</span><br><span class="line">                var map = new esri.Map(&quot;mapDiv&quot;);</span><br><span class="line">                var layer = new esri.layers.ArcGISDynamicMapServiceLayer</span><br><span class="line">                (&quot;http://localhost:6080/arcgis/rest/services/Test/ft/MapServer&quot;);</span><br><span class="line">                map.addLayer(layer);</span><br><span class="line">                //创建绘图对象</span><br><span class="line">                var toolBar = new Draw(map);    </span><br><span class="line">                //线符号</span><br><span class="line">                lineSymbol = new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new Color([255, 0, 0]), 3);</span><br><span class="line">                //面符号</span><br><span class="line">                polygonSymbol = new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol, new Color([255, 0, 0, 0.25]));</span><br><span class="line">                </span><br><span class="line">                //给绘制polygon的按钮绑定事件</span><br><span class="line">                query(&quot;.pbtn&quot;).on(&quot;click&quot;,function(event)&#123;</span><br><span class="line">                    //激活绘制多边形</span><br><span class="line">                    toolBar.activate(Draw.POLYGON, &#123;</span><br><span class="line">                        showTooltips:true</span><br><span class="line">                    &#125;)</span><br><span class="line">                    </span><br><span class="line">                &#125;)</span><br><span class="line">                //绘图结束绑定事件</span><br><span class="line">                on(toolBar,&quot;draw-end&quot;,function(result)&#123;</span><br><span class="line">                    //获得面形状</span><br><span class="line">                    var geometry=result.geometry;</span><br><span class="line">                    //创建Graphic</span><br><span class="line">                    var graphicpoint= new Graphic(geometry, polygonSymbol);</span><br><span class="line">                    map.graphics.add(graphicpoint); </span><br><span class="line">                    //关闭绘图工具</span><br><span class="line">                    toolBar.deactivate();                   </span><br><span class="line">                &#125;)</span><br><span class="line">                //给地图打印按钮绑定事件</span><br><span class="line">                on(dom.byId(&quot;Btn&quot;),&quot;click&quot;,function()&#123;</span><br><span class="line">                    //创建地图打印对象</span><br><span class="line">                    var printMap = new PrintTask(&quot;http://localhost:6080/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task&quot;);</span><br><span class="line">                    //创建地图打印模版</span><br><span class="line">                    var template = new PrintTemplate();</span><br><span class="line">                    //创建地图的打印参数，参数里面包括：模版和地图</span><br><span class="line">                    var params = new PrintParameters(); </span><br><span class="line">                    //输出图片的空间参考</span><br><span class="line">                    printMap.outSpatialReference = map.SpatialReference </span><br><span class="line">                    //打印图片的各种参数</span><br><span class="line">                    template.exportOptions = &#123; </span><br><span class="line">                        width: 850, </span><br><span class="line">                        height: 650, </span><br><span class="line">                        dpi: 96 </span><br><span class="line">                    &#125;;</span><br><span class="line">                    //打印输出的格式</span><br><span class="line">                    template.format = &quot;PDF&quot;; </span><br><span class="line">                    //输出地图的布局</span><br><span class="line">                    template.layout = &quot;MAP_ONLY&quot;; </span><br><span class="line">                    PrintTemplate </span><br><span class="line">                    //设置参数地图</span><br><span class="line">                    params.map = map; </span><br><span class="line">                    //设置参数模版</span><br><span class="line">                    params.template = template; </span><br><span class="line">                    //运行结果</span><br><span class="line">                    printMap.execute(params, function(result)&#123;</span><br><span class="line">                        if (result != null) &#123; </span><br><span class="line">                            //网页打开生成的地图</span><br><span class="line">                            window.open(result.url); </span><br><span class="line">                        &#125; </span><br><span class="line">                    &#125;) </span><br><span class="line">                &#125;)</span><br><span class="line">               </span><br><span class="line">            &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=&quot;mapDiv&quot; class=&quot;MapClass&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;button class=&quot;pbtn&quot; &gt;画多边形&lt;/button&gt;</span><br><span class="line">    &lt;input id=&quot;Btn&quot; type=&quot;button&quot; value=&quot;地图打印&quot; /&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
                
                <div class="readmore">
                    <a href="/2019/08/06/ArcGIS-API-for-JS23/">
                        阅读更多
                    </a>
                </div>
            </div>
        
            <div class="post-item">
                <h1>
                    <a href="/2019/08/06/ArcGIS-API-for-JS22/">
                        ArcGIS API For Javascript之几何服务
                    </a>
                </h1>
                <div class="create">
                    <span>创建于</span>
                    
                        <time datetime="2019-08-06T09:43:13.000Z">
                            2019-08-06
                        </time>
                    
                    <ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/ArcGIS/">ArcGIS</a></li></ul>
                </div>
                
                    <p>什么是几何服务（GeometryService）？从字面意义上来说是和几何（Geometry）相关的服务，具体一点讲我们可以用这个类实现一些简单的图形操作。例如：</p>
<ul>
<li>测量直线的距离</li>
<li>形状的缓冲区分析</li>
<li>判断两个形状之间的关系（相交，相离等等）</li>
<li>两个形状求交</li>
<li>对形状的裁剪等等</li>
</ul>
<p>在此以缓冲区分析和图形求交来介绍几何服务的使用.</p>
<h3 id="启用几何服务"><a href="#启用几何服务" class="headerlink" title="启用几何服务"></a>启用几何服务</h3><p>当我们安装好ArcGIS Server的时候，几何服务就已经存在了，因此几何服务不需要我们发布，但是在默认情况下几何服务是关闭的，因此我们首先启动几何服务，步骤如下：</p>
<p>登录我们的ArcGIS Server Manager<br><img src="/2019/08/06/ArcGIS-API-for-JS22/01.png" alt="01.png"><br>启动成功<br><img src="/2019/08/06/ArcGIS-API-for-JS22/02.png" alt="02.png"><br>几何服务的URL<br><img src="/2019/08/06/ArcGIS-API-for-JS22/03.png" alt="03.png"></p>
<h3 id="利用几何服务进行缓冲区分析"><a href="#利用几何服务进行缓冲区分析" class="headerlink" title="利用几何服务进行缓冲区分析"></a>利用几何服务进行缓冲区分析</h3><p>几何服务的使用一般分为四个步骤：</p>
<ul>
<li>创建几何服务对象</li>
<li>创建参数</li>
<li>构建参数对象</li>
<li>执行相应的方法，并处理返回的结果</li>
</ul>
<h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><p>加载地图（省略）<br>创建两个按钮–一个按钮用于画点，另外一个按钮用于缓冲区分析<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;input id=&quot;point&quot; type=&quot;button&quot; value=&quot;点&quot;/&gt;</span><br><span class="line">&lt;input id=&quot;Btn&quot; type=&quot;button&quot; /&gt;</span><br></pre></td></tr></table></figure></p>
<p>创建相关对象（例如符号对象，Draw对象等等）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//使用toolbar上的绘图工具</span><br><span class="line">                var toolBar = new Draw(map);</span><br><span class="line">                //创建点符号</span><br><span class="line">                var pointSymbol = new SimpleMarkerSymbol();</span><br><span class="line">                pointSymbol.style = SimpleMarkerSymbol.STYLE_CIRCLE;</span><br><span class="line">                pointSymbol.setSize(12);</span><br><span class="line">                pointSymbol.setColor(new Color(&quot;#FFFFCC&quot;));</span><br><span class="line">                //线符号</span><br><span class="line">                lineSymbol = new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new Color([255, 0, 0]), 3);</span><br><span class="line">                //面符号</span><br><span class="line">                polygonSymbol= new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol, new Color([255, 255, 0, 0.25]));</span><br></pre></td></tr></table></figure></p>
<p>创建几何服务对象，创建相应的缓冲区参数对象<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var geometryServices = new GeometryService(&quot;http://localhost:6080/arcgis/rest/services/Utilities/Geometry/GeometryServer&quot;);</span><br><span class="line">var params = new BufferParameters();</span><br></pre></td></tr></table></figure></p>
<p>给画点按钮绑定事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">//给画点按钮绑定事件</span><br><span class="line">                on(dom.byId(&quot;point&quot;),&quot;click&quot;,function()&#123;</span><br><span class="line">                    //激活画点工具</span><br><span class="line">                    toolBar.activate(Draw.POINT, &#123;</span><br><span class="line">                        showTooltips:true</span><br><span class="line">                    &#125;)</span><br><span class="line">                    </span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">                //绘图结束绑定事件</span><br><span class="line">                on(toolBar,&quot;draw-end&quot;,function(result)&#123;</span><br><span class="line">                    //获得点形状</span><br><span class="line">                    var geometry=result.geometry;</span><br><span class="line">                    //创建Graphic</span><br><span class="line">                    var graphicpoint = new Graphic(geometry, pointSymbol);</span><br><span class="line">                    map.graphics.add(graphicpoint); </span><br><span class="line">                    //关闭绘图工具</span><br><span class="line">                    toolBar.deactivate();</span><br><span class="line">                    //很重要！！！在这里构建缓冲区分析的形状属性</span><br><span class="line">                    //注意这里可以放一个数组，此处为了方便我们只对一个形状进行缓冲区分析</span><br><span class="line">                    params.geometries  = [ geometry ];</span><br><span class="line"></span><br><span class="line">                    </span><br><span class="line">                &#125;)</span><br></pre></td></tr></table></figure></p>
<p>给缓冲区分析按钮绑定事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//给缓冲区分析按钮绑定事件</span><br><span class="line">                on(dom.byId(&quot;Btn&quot;),&quot;click&quot;,function()&#123;</span><br><span class="line">                    //缓冲距离</span><br><span class="line">                    params.distances = [ &quot;80&quot; ];</span><br><span class="line">                    //空间参考</span><br><span class="line">                    params.bufferSpatialReference = map.spatialReference;</span><br><span class="line">                    params.outSpatialReference = map.spatialReference;</span><br><span class="line">                    //执行分析处理结果</span><br><span class="line">                    geometryServices.buffer(params,function(result)&#123;</span><br><span class="line">                        //处理缓冲区分析得到的结果</span><br><span class="line">                        for(var idx in result)</span><br><span class="line">                        &#123;   </span><br><span class="line">                            //创建Graphic</span><br><span class="line">                            var graphic=new Graphic(result[idx],polygonSymbol)</span><br><span class="line">                            //将每一个结果都放在map中</span><br><span class="line">                            map.graphics.add(graphic)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;)</span><br></pre></td></tr></table></figure></p>
<h4 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h4><p><img src="/2019/08/06/ArcGIS-API-for-JS22/04.png" alt="04.png"></p>
<h4 id="全部代码"><a href="#全部代码" class="headerlink" title="全部代码"></a>全部代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;/&gt;</span><br><span class="line">    &lt;title&gt;缓冲区分析&lt;/title&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script  type=&quot;text/Javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">        .MapClass&#123;</span><br><span class="line">            width:100%;</span><br><span class="line">            height:500px;</span><br><span class="line">            border:1px solid #000;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line"></span><br><span class="line">        require([&quot;esri/map&quot;,</span><br><span class="line">            &quot;dojo/dom&quot;,&quot;dojo/on&quot;,</span><br><span class="line">            &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleMarkerSymbol&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleLineSymbol&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleFillSymbol&quot;,</span><br><span class="line">            &quot;esri/toolbars/draw&quot;,</span><br><span class="line">            &quot;esri/graphic&quot;,</span><br><span class="line">            &quot;esri/tasks/GeometryService&quot;,</span><br><span class="line">            &quot;esri/tasks/BufferParameters&quot;,</span><br><span class="line">            &quot;dojo/colors&quot;,</span><br><span class="line">            &quot;dojo/domReady!&quot;],</span><br><span class="line">            function (Map,dom,on,</span><br><span class="line">                ArcGISDynamicMapServiceLayer,</span><br><span class="line">                SimpleMarkerSymbol,</span><br><span class="line">                SimpleLineSymbol,</span><br><span class="line">                SimpleFillSymbol,</span><br><span class="line">                Draw,</span><br><span class="line">                Graphic,</span><br><span class="line">                GeometryService,</span><br><span class="line">                BufferParameters,Color) &#123;</span><br><span class="line">                var map = new esri.Map(&quot;mapDiv&quot;);</span><br><span class="line">                var layer = new esri.layers.ArcGISDynamicMapServiceLayer</span><br><span class="line">                (&quot;http://localhost:6080/arcgis/rest/services/Test/ft/MapServer&quot;);</span><br><span class="line">                map.addLayer(layer);</span><br><span class="line">                //创建几何服务对象</span><br><span class="line">                var geometryServices = new GeometryService(&quot;http://localhost:6080/arcgis/rest/services/Utilities/Geometry/GeometryServer&quot;);</span><br><span class="line">                //创建缓存参数对象</span><br><span class="line">                var params = new BufferParameters();</span><br><span class="line">                </span><br><span class="line">                //使用toolbar上的绘图工具</span><br><span class="line">                var toolBar = new Draw(map);</span><br><span class="line">                //创建点符号</span><br><span class="line">                var pointSymbol = new SimpleMarkerSymbol();</span><br><span class="line">                pointSymbol.style = SimpleMarkerSymbol.STYLE_CIRCLE;</span><br><span class="line">                pointSymbol.setSize(12);</span><br><span class="line">                pointSymbol.setColor(new Color(&quot;#FFFFCC&quot;));</span><br><span class="line">                //线符号</span><br><span class="line">                lineSymbol = new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new Color([255, 0, 0]), 3);</span><br><span class="line">                //面符号</span><br><span class="line">                polygonSymbol = new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol, new Color([255, 255, 0, 0.25]));</span><br><span class="line">                //给画点按钮绑定事件</span><br><span class="line">                on(dom.byId(&quot;point&quot;),&quot;click&quot;,function()&#123;</span><br><span class="line">                    //激活画点工具</span><br><span class="line">                    toolBar.activate(Draw.POINT, &#123;</span><br><span class="line">                        showTooltips:true</span><br><span class="line">                    &#125;)</span><br><span class="line">                    </span><br><span class="line">                &#125;)</span><br><span class="line">                //绘图结束绑定事件</span><br><span class="line">                on(toolBar,&quot;draw-end&quot;,function(result)&#123;</span><br><span class="line">                    //获得点形状</span><br><span class="line">                    var geometry=result.geometry;</span><br><span class="line">                    //创建Graphic</span><br><span class="line">                    var graphicpoint = new Graphic(geometry, pointSymbol);</span><br><span class="line">                    map.graphics.add(graphicpoint); </span><br><span class="line">                    //关闭绘图工具</span><br><span class="line">                    toolBar.deactivate();</span><br><span class="line">                    //很重要！！！在这里构建缓冲区分析的形状属性</span><br><span class="line">                    //注意这里可以放一个数组，此处为了方便我们只对一个形状进行缓冲区分析</span><br><span class="line">                    params.geometries  = [ geometry ];</span><br><span class="line"></span><br><span class="line">                    </span><br><span class="line">                &#125;)</span><br><span class="line">                //给缓冲区分析按钮绑定事件</span><br><span class="line">                on(dom.byId(&quot;Btn&quot;),&quot;click&quot;,function()&#123;</span><br><span class="line">                    //缓冲距离</span><br><span class="line">                    params.distances = [ &quot;80&quot; ];</span><br><span class="line">                    //空间参考</span><br><span class="line">                    params.bufferSpatialReference = map.spatialReference;</span><br><span class="line">                    params.outSpatialReference = map.spatialReference;</span><br><span class="line">                    //执行分析处理结果</span><br><span class="line">                    geometryServices.buffer(params,function(result)&#123;</span><br><span class="line">                        //处理缓冲区分析得到的结果</span><br><span class="line">                        for(var idx in result)</span><br><span class="line">                        &#123;   </span><br><span class="line">                            //创建Graphic</span><br><span class="line">                            var graphic=new Graphic(result[idx],polygonSymbol)</span><br><span class="line">                            //将每一个结果都放在map中</span><br><span class="line">                            map.graphics.add(graphic)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                &#125;)</span><br><span class="line">               </span><br><span class="line">            &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=&quot;mapDiv&quot; class=&quot;MapClass&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;input id=&quot;point&quot; type=&quot;button&quot; value=&quot;点&quot;/&gt;</span><br><span class="line">    &lt;input id=&quot;Btn&quot; type=&quot;button&quot; value=&quot;缓冲区分析&quot; /&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="利用几何服务进行多边形求交"><a href="#利用几何服务进行多边形求交" class="headerlink" title="利用几何服务进行多边形求交"></a>利用几何服务进行多边形求交</h3><p>首先我们先看看求交这一个方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GeometryService.intersect(geometries, geometry, callback?, errback?)</span><br></pre></td></tr></table></figure></p>
<p>解释：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">此方法有四个参数，</span><br><span class="line">第一个参数是   形状的集合(多个形状)</span><br><span class="line">第二个参数是   一个形状</span><br><span class="line">第三个参数是   运行成功之后的结果</span><br><span class="line">第四个参数是   运行失败之后的结果</span><br></pre></td></tr></table></figure></p>
<p>方法的使用：用第二个参数的形状与第一个参数的多个形状进行求交，从而返回运行的结果</p>
<h4 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h4><p>加载地图（略）<br>创建三个按钮<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;button class=&quot;pbtn&quot; &gt;第一个参数&lt;/button&gt;</span><br><span class="line">&lt;button class=&quot;pbtn&quot; &gt;第二个参数&lt;/button&gt;</span><br><span class="line">&lt;input id=&quot;Btn&quot; type=&quot;button&quot; value=&quot;求交分析&quot; /&gt;</span><br></pre></td></tr></table></figure></p>
<p>创建相关对象（符号对象，绘图对象）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//一个标志位，用于记录是绘制第几个参数</span><br><span class="line">                //1代表第一个参数</span><br><span class="line">                //2代表第二个参数</span><br><span class="line">                var flag;</span><br><span class="line">                //第一个参数  注意第一个参数是多个形状</span><br><span class="line">                var geometries=[];</span><br><span class="line">                //第二个参数  注意第二个参数是一个形状</span><br><span class="line">                var paramGeometry;</span><br><span class="line">                //使用toolbar上的绘图工具</span><br><span class="line">                var toolBar = new Draw(map);</span><br><span class="line">                </span><br><span class="line">                //线符号</span><br><span class="line">                lineSymbol = new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new Color([255, 0, 0]), 3);</span><br><span class="line">                //第一个参数的面符号</span><br><span class="line">                polygonSymbol1 = new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol, new Color([255, 0, 0, 0.25]));</span><br><span class="line">                //第二个参数的面符号</span><br><span class="line">                polygonSymbol2 = new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol, new Color([0, 255, 0, 0.25]));</span><br><span class="line">                //求交之后的面符号</span><br><span class="line">                polygonSymbol3 = new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol, new Color([0, 0, 255, 0.25]));</span><br></pre></td></tr></table></figure></p>
<p>给画图形的按钮绑定事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">//给绘制polygon的按钮绑定事件</span><br><span class="line">                query(&quot;.pbtn&quot;).on(&quot;click&quot;,function(event)&#123;</span><br><span class="line">                    var value=this.innerHTML;</span><br><span class="line">                    switch(value)&#123;</span><br><span class="line">                        case &quot;第一个参数&quot;:&#123;</span><br><span class="line">                            flag=1;</span><br><span class="line">                            break;</span><br><span class="line">                            </span><br><span class="line">                        &#125;</span><br><span class="line">                        case &quot;第二个参数&quot;:&#123;</span><br><span class="line">                            flag=2;</span><br><span class="line">                            break;</span><br><span class="line">                        &#125;   </span><br><span class="line">                    &#125;</span><br><span class="line">                    //激活绘制多边形</span><br><span class="line">                    toolBar.activate(Draw.POLYGON, &#123;</span><br><span class="line">                        showTooltips:true</span><br><span class="line">                    &#125;)</span><br><span class="line">                    </span><br><span class="line">                &#125;)</span><br><span class="line">                //绘图结束绑定事件</span><br><span class="line">                on(toolBar,&quot;draw-end&quot;,function(result)&#123;</span><br><span class="line">                    //获得面形状</span><br><span class="line">                    var geometry=result.geometry;</span><br><span class="line">                    //创建Graphic</span><br><span class="line">                    var graphicpoint;</span><br><span class="line"></span><br><span class="line">                    //很重要！！！在这里构建参数对象</span><br><span class="line">                    if(flag==1)</span><br><span class="line">                    &#123;</span><br><span class="line">                        //创建Graphic</span><br><span class="line">                        graphicpoint = new Graphic(geometry, polygonSymbol1);</span><br><span class="line">                        geometries.push(geometry)</span><br><span class="line">                    &#125;</span><br><span class="line">                    else if(flag==2)</span><br><span class="line">                    &#123;</span><br><span class="line">                        //创建Graphic</span><br><span class="line">                        graphicpoint = new Graphic(geometry, polygonSymbol2);</span><br><span class="line">                        paramGeometry=geometry;</span><br><span class="line">                    &#125;   </span><br><span class="line">                    map.graphics.add(graphicpoint); </span><br><span class="line">                    //关闭绘图工具</span><br><span class="line">                    toolBar.deactivate();                   </span><br><span class="line">                &#125;)</span><br></pre></td></tr></table></figure></p>
<p>给求交按钮绑定事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//给求交按钮绑定事件</span><br><span class="line">                on(dom.byId(&quot;Btn&quot;),&quot;click&quot;,function()&#123;</span><br><span class="line">                    //在这里在说一边，第一个参数是图形集合，第二个参数是一个图形</span><br><span class="line">                    geometryServices.intersect(geometries,paramGeometry,function(result)&#123;</span><br><span class="line">                        for(var idx in result)</span><br><span class="line">                        &#123;</span><br><span class="line">                            //创建Graphic</span><br><span class="line">                            var graphic=new Graphic(result[idx],polygonSymbol3)</span><br><span class="line">                            //将每一个结果都放在map中</span><br><span class="line">                            map.graphics.add(graphic)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;)</span><br></pre></td></tr></table></figure></p>
<h4 id="运行结果-1"><a href="#运行结果-1" class="headerlink" title="运行结果"></a>运行结果</h4><p><img src="/2019/08/06/ArcGIS-API-for-JS22/05.png" alt="05.png"></p>
<h4 id="全部代码-1"><a href="#全部代码-1" class="headerlink" title="全部代码"></a>全部代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;/&gt;</span><br><span class="line">    &lt;title&gt;多边形求交&lt;/title&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script  type=&quot;text/Javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">        .MapClass&#123;</span><br><span class="line">            width:100%;</span><br><span class="line">            height:500px;</span><br><span class="line">            border:1px solid #000;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line"></span><br><span class="line">        require([&quot;esri/map&quot;,</span><br><span class="line">            &quot;dojo/dom&quot;,&quot;dojo/on&quot;,&quot;dojo/query&quot;,</span><br><span class="line">            &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleMarkerSymbol&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleLineSymbol&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleFillSymbol&quot;,</span><br><span class="line">            &quot;esri/toolbars/draw&quot;,</span><br><span class="line">            &quot;esri/graphic&quot;,</span><br><span class="line">            &quot;esri/tasks/GeometryService&quot;,</span><br><span class="line">            &quot;dojo/colors&quot;,</span><br><span class="line">            &quot;dojo/domReady!&quot;],</span><br><span class="line">            function (Map,dom,on,query,</span><br><span class="line">                ArcGISDynamicMapServiceLayer,</span><br><span class="line">                SimpleMarkerSymbol,</span><br><span class="line">                SimpleLineSymbol,</span><br><span class="line">                SimpleFillSymbol,</span><br><span class="line">                Draw,</span><br><span class="line">                Graphic,</span><br><span class="line">                GeometryService,</span><br><span class="line">                Color) &#123;</span><br><span class="line">                var map = new esri.Map(&quot;mapDiv&quot;);</span><br><span class="line">                var layer = new esri.layers.ArcGISDynamicMapServiceLayer</span><br><span class="line">                (&quot;http://localhost:6080/arcgis/rest/services/Test/ft/MapServer&quot;);</span><br><span class="line">                map.addLayer(layer);</span><br><span class="line">                //创建几何服务对象</span><br><span class="line">                var geometryServices = new GeometryService(&quot;http://localhost:6080/arcgis/rest/services/Utilities/Geometry/GeometryServer&quot;);</span><br><span class="line">                //一个标志位，用于记录是绘制第几个参数</span><br><span class="line">                //1代表第一个参数</span><br><span class="line">                //2代表第二个参数</span><br><span class="line">                var flag;</span><br><span class="line">                //第一个参数  注意第一个参数是多个形状</span><br><span class="line">                var geometries=[];</span><br><span class="line">                //第二个参数  注意第二个参数是一个形状</span><br><span class="line">                var paramGeometry;</span><br><span class="line">                //使用toolbar上的绘图工具</span><br><span class="line">                var toolBar = new Draw(map);</span><br><span class="line">                </span><br><span class="line">                //线符号</span><br><span class="line">                lineSymbol = new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new Color([255, 0, 0]), 3);</span><br><span class="line">                //第一个参数的面符号</span><br><span class="line">                polygonSymbol1 = new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol, new Color([255, 0, 0, 0.25]));</span><br><span class="line">                //第二个参数的面符号</span><br><span class="line">                polygonSymbol2 = new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol, new Color([0, 255, 0, 0.25]));</span><br><span class="line">                //求交之后的面符号</span><br><span class="line">                polygonSymbol3 = new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol, new Color([0, 0, 255, 0.25]));</span><br><span class="line">                //给绘制polygon的按钮绑定事件</span><br><span class="line">                query(&quot;.pbtn&quot;).on(&quot;click&quot;,function(event)&#123;</span><br><span class="line">                    var value=this.innerHTML;</span><br><span class="line">                    switch(value)&#123;</span><br><span class="line">                        case &quot;第一个参数&quot;:&#123;</span><br><span class="line">                            flag=1;</span><br><span class="line">                            break;</span><br><span class="line">                            </span><br><span class="line">                        &#125;</span><br><span class="line">                        case &quot;第二个参数&quot;:&#123;</span><br><span class="line">                            flag=2;</span><br><span class="line">                            break;</span><br><span class="line">                        &#125;   </span><br><span class="line">                    &#125;</span><br><span class="line">                    //激活绘制多边形</span><br><span class="line">                    toolBar.activate(Draw.POLYGON, &#123;</span><br><span class="line">                        showTooltips:true</span><br><span class="line">                    &#125;)</span><br><span class="line">                    </span><br><span class="line">                &#125;)</span><br><span class="line">                //绘图结束绑定事件</span><br><span class="line">                on(toolBar,&quot;draw-end&quot;,function(result)&#123;</span><br><span class="line">                    //获得面形状</span><br><span class="line">                    var geometry=result.geometry;</span><br><span class="line">                    //创建Graphic</span><br><span class="line">                    var graphicpoint;</span><br><span class="line"></span><br><span class="line">                    //很重要！！！在这里构建参数对象</span><br><span class="line">                    if(flag==1)</span><br><span class="line">                    &#123;</span><br><span class="line">                        //创建Graphic</span><br><span class="line">                        graphicpoint = new Graphic(geometry, polygonSymbol1);</span><br><span class="line">                        geometries.push(geometry)</span><br><span class="line">                    &#125;</span><br><span class="line">                    else if(flag==2)</span><br><span class="line">                    &#123;</span><br><span class="line">                        //创建Graphic</span><br><span class="line">                        graphicpoint = new Graphic(geometry, polygonSymbol2);</span><br><span class="line">                        paramGeometry=geometry;</span><br><span class="line">                    &#125;   </span><br><span class="line">                    map.graphics.add(graphicpoint); </span><br><span class="line">                    //关闭绘图工具</span><br><span class="line">                    toolBar.deactivate();                   </span><br><span class="line">                &#125;)</span><br><span class="line">                //给求交按钮绑定事件</span><br><span class="line">                on(dom.byId(&quot;Btn&quot;),&quot;click&quot;,function()&#123;</span><br><span class="line">                    //在这里在说一边，第一个参数是图形集合，第二个参数是一个图形</span><br><span class="line">                    geometryServices.intersect(geometries,paramGeometry,function(result)&#123;</span><br><span class="line">                        for(var idx in result)</span><br><span class="line">                        &#123;</span><br><span class="line">                            //创建Graphic</span><br><span class="line">                            var graphic=new Graphic(result[idx],polygonSymbol3)</span><br><span class="line">                            //将每一个结果都放在map中</span><br><span class="line">                            map.graphics.add(graphic)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;)</span><br><span class="line">               </span><br><span class="line">            &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=&quot;mapDiv&quot; class=&quot;MapClass&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;button class=&quot;pbtn&quot; &gt;第一个参数&lt;/button&gt;</span><br><span class="line">    &lt;button class=&quot;pbtn&quot; &gt;第二个参数&lt;/button&gt;</span><br><span class="line">    &lt;input id=&quot;Btn&quot; type=&quot;button&quot; value=&quot;求交分析&quot; /&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
                
                <div class="readmore">
                    <a href="/2019/08/06/ArcGIS-API-for-JS22/">
                        阅读更多
                    </a>
                </div>
            </div>
        
            <div class="post-item">
                <h1>
                    <a href="/2019/08/06/ArcGIS-API-for-JS21/">
                        ArcGIS API For Javascript之网络分析
                    </a>
                </h1>
                <div class="create">
                    <span>创建于</span>
                    
                        <time datetime="2019-08-06T09:27:59.000Z">
                            2019-08-06
                        </time>
                    
                    <ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/ArcGIS/">ArcGIS</a></li></ul>
                </div>
                
                    <p>在WebGIS中网络分析一直是比较常用的功能，比如：路径分析，服务点分析等等,在WebGIS中想要实现相应的功能需要将我们的服务发布为网络服务。</p>
<h3 id="路径分析"><a href="#路径分析" class="headerlink" title="路径分析"></a>路径分析</h3><p>在路径分析中，主要有两个比较关键的参数：</p>
<ul>
<li>停靠点</li>
<li>障碍点</li>
<li><p>总体来说，路径分析的步骤主要有以下几步：</p>
</li>
<li><p>发布网络分析服务</p>
</li>
<li>在Web端创建路径分析对象</li>
<li>构建路径分析参数。<br>（1）停靠点<br>（2）障碍点</li>
<li>获得结果，进行处理。</li>
</ul>
<p>####　代码实现<br>创建三个按钮（停靠点，障碍点，分析）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;input id=&quot;Stop&quot; type=&quot;button&quot; value=&quot;停靠点&quot; /&gt;</span><br><span class="line">&lt;input id=&quot;barriers&quot; type=&quot;button&quot; value=&quot;障碍点&quot; /&gt;</span><br><span class="line">&lt;input id=&quot;Analyse&quot; type=&quot;button&quot; value=&quot;分析&quot; /&gt;</span><br></pre></td></tr></table></figure></p>
<p>添加地图（步骤省略）<br>创建路径分析对象，创建路径分析参数对象（注意：还缺少两个重要的参数，停靠点，障碍点）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//创建路径分析对象</span><br><span class="line">                var shortestAnalyst = new RouteTask(&quot;http://localhost:6080/arcgis/rest/services/Test/mynet/NAServer/Route&quot;);</span><br><span class="line">                //创建路径参数对象</span><br><span class="line">                var routeParas = new RouteParameters();</span><br><span class="line">                //障碍点，但是此时障碍点为空</span><br><span class="line">                routeParas.barriers = new FeatureSet();</span><br><span class="line">                //停靠点，但是此时停靠点为空</span><br><span class="line">                routeParas.stops = new FeatureSet();</span><br><span class="line">                //路径是否有方向</span><br><span class="line">                routeParas.returnDirections = false;</span><br><span class="line">                //是否返回路径，此处必须返回</span><br><span class="line">                routeParas.returnRoutes = true;</span><br><span class="line">                //空间参考</span><br><span class="line">                routeParas.outSpatialReference = map.SpatialReference;</span><br></pre></td></tr></table></figure></p>
<p>给停靠点按钮和障碍点按钮绑定点击事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//定义一个标志</span><br><span class="line">                //selectPointID=0什么都不做</span><br><span class="line">                //selectPointID=1说明是添加停靠点</span><br><span class="line">                //selectPointID=2说明是添加障碍点</span><br><span class="line">                var selectPointID;</span><br><span class="line">                //给停靠点按钮添加点击事件</span><br><span class="line">                on(dom.byId(&quot;stop&quot;),&quot;click&quot;,function()&#123;</span><br><span class="line">                    selectPointID = 1;</span><br><span class="line">                &#125;)</span><br><span class="line">                //给障碍点按钮添加点击事件</span><br><span class="line">                on(dom.byId(&quot;barriers&quot;),&quot;click&quot;,function()&#123;</span><br><span class="line">                    selectPointID = 2;</span><br><span class="line">                &#125;)</span><br></pre></td></tr></table></figure></p>
<p>给地图绑定点击事件（为了获得点的坐标–&gt;构建停靠点或者障碍点）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">//定义停靠点的符号</span><br><span class="line">                var stopSymbol = new SimpleMarkerSymbol();</span><br><span class="line">                stopSymbol.style = SimpleMarkerSymbol.STYLE_CIRCLE;</span><br><span class="line">                stopSymbol.setSize(8);</span><br><span class="line">                stopSymbol.setColor(new Color(&quot;#FFFFCC&quot;));</span><br><span class="line">                //定义障碍点的符号</span><br><span class="line">                var barrierSymbol = new SimpleMarkerSymbol();</span><br><span class="line">                barrierSymbol.style = SimpleMarkerSymbol.STYLE_CIRCLE;</span><br><span class="line">                barrierSymbol.setSize(8);</span><br><span class="line">                barrierSymbol.setColor(new Color(&quot;#f1a340&quot;));</span><br><span class="line">                on(map, &quot;mouse-down&quot;, function(evt)&#123;</span><br><span class="line">                    //通过selectPointID判断是添加是停靠点还是障碍点</span><br><span class="line">                    switch (selectPointID) &#123;</span><br><span class="line">                        case 0:</span><br><span class="line">                            break;</span><br><span class="line">                        case 1:</span><br><span class="line">                            //获得停靠点的坐标</span><br><span class="line">                            var pointStop=evt.mapPoint;</span><br><span class="line">                            var gr=new Graphic(pointStop,stopSymbol);</span><br><span class="line">                            //构建停靠点的参数</span><br><span class="line">                            routeParas.stops.features.push(gr);</span><br><span class="line">                            break;</span><br><span class="line">                        case 2:</span><br><span class="line">                            //获得障碍点的坐标</span><br><span class="line">                            var pointBarrier=evt.mapPoint;</span><br><span class="line">                            var gr=new Graphic(pointBarrier,barrierSymbol);</span><br><span class="line">                            //构建障碍点的参数</span><br><span class="line">                            routeParas.barriers.features.push(gr);</span><br><span class="line">                            break;</span><br><span class="line">                    &#125;</span><br><span class="line">                    //如果selectPointID不等于0，将点的坐标在地图上显示出来</span><br><span class="line">                    if (selectPointID != 0) &#123;</span><br><span class="line">                        addTextPoint(&quot;停靠点&quot;, pointStop, stopSymbol);</span><br><span class="line">                        addTextPoint(&quot;障碍点&quot;, pointBarrier, barrierSymbol);</span><br><span class="line">                        selectPointID = 0;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                //文本符号：文本信息，点坐标，符号</span><br><span class="line">                function addTextPoint(text,point,symbol) &#123;</span><br><span class="line">                    var textSymbol = new TextSymbol(text);</span><br><span class="line">                    textSymbol.setColor(new Color([128, 0, 0]));              </span><br><span class="line">                    var graphicText = Graphic(point, textSymbol);</span><br><span class="line">                    var graphicpoint = new Graphic(point, symbol);</span><br><span class="line">                    //用默认的图层添加</span><br><span class="line">                    map.graphics.add(graphicpoint);</span><br><span class="line">                    //用默认的图层添加</span><br><span class="line">                    map.graphics.add(graphicText);</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure></p>
<p>给分析按钮绑定点击事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//给分析按钮添加点击事件</span><br><span class="line">                on(dom.byId(&quot;analyse&quot;),&quot;click&quot;,function()&#123;</span><br><span class="line">                    //如果障碍点或者停靠点的个数有一个为0，提示用户参数输入不对</span><br><span class="line">                    if  (routeParas.stops.features.length  ==  0  || routeParas.barriers.features.length==0)</span><br><span class="line">                    &#123;</span><br><span class="line">                        alert(&quot;输入参数不全，无法分析&quot;);</span><br><span class="line">                        return;</span><br><span class="line">                    &#125;</span><br><span class="line">                    //执行路径分析函数</span><br><span class="line">                    shortestAnalyst.solve(routeParas, showRoute)</span><br><span class="line">                &#125;)</span><br></pre></td></tr></table></figure></p>
<p>获得结果，处理路径分析返回的结果。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//处理路径分析返回的结果。</span><br><span class="line">                function showRoute(solveResult) &#123;</span><br><span class="line">                    //路径分析的结果</span><br><span class="line">                    var routeResults = solveResult.routeResults;</span><br><span class="line">                    //路径分析的长度</span><br><span class="line">                    var res = routeResults.length;</span><br><span class="line">                    //路径的符号</span><br><span class="line">                    routeSymbol  = new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new Color([255, 0, 0]), 3);</span><br><span class="line">                    if (res &gt; 0) &#123;</span><br><span class="line">                        for (var i = 0; i &lt; res; i++) &#123;</span><br><span class="line">                            var graphicroute = routeResults[i];</span><br><span class="line">                            var graphic = graphicroute.route;</span><br><span class="line">                            graphic.setSymbol(routeSymbol);</span><br><span class="line">                            map.graphics.add(graphic);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    else &#123;</span><br><span class="line">                        alert(&quot;没有返回结果&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h4><p>添加停靠点<br><img src="/2019/08/06/ArcGIS-API-for-JS21/01.png" alt="01.png"><br>添加障碍点<br><img src="/2019/08/06/ArcGIS-API-for-JS21/02.png" alt="02.png"><br>分析获得结果<br><img src="/2019/08/06/ArcGIS-API-for-JS21/03.png" alt="03.png"></p>
<h4 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;/&gt;</span><br><span class="line">    &lt;title&gt;Geometric _Network&lt;/title&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script  type=&quot;text/Javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">        .MapClass&#123;</span><br><span class="line">            width:100%;</span><br><span class="line">            height:600px;</span><br><span class="line">            border:1px solid #000;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line"></span><br><span class="line">        require([&quot;esri/map&quot;,</span><br><span class="line">            &quot;dojo/on&quot;,</span><br><span class="line">            &quot;dojo/dom&quot;,</span><br><span class="line">            &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">            &quot;esri/tasks/RouteTask&quot;,</span><br><span class="line">            &quot;esri/tasks/FeatureSet&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleMarkerSymbol&quot;,</span><br><span class="line">            &quot;esri/symbols/TextSymbol&quot;,</span><br><span class="line">            &quot;esri/toolbars/draw&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleLineSymbol&quot;,</span><br><span class="line">            &quot;esri/tasks/RouteParameters&quot;,</span><br><span class="line">            &quot;dojo/colors&quot;,</span><br><span class="line">            &quot;esri/graphic&quot;,</span><br><span class="line">            &quot;dojo/domReady!&quot;],</span><br><span class="line">            function (Map,on,dom,</span><br><span class="line">                ArcGISDynamicMapServiceLayer,</span><br><span class="line">                RouteTask,</span><br><span class="line">                FeatureSet,</span><br><span class="line">                SimpleMarkerSymbol,</span><br><span class="line">                TextSymbol,</span><br><span class="line">                Draw,</span><br><span class="line">                SimpleLineSymbol,</span><br><span class="line">                RouteParameters,</span><br><span class="line">                Color,</span><br><span class="line">                Graphic</span><br><span class="line">                ) &#123;</span><br><span class="line">                var map = new Map(&quot;MyMapDiv&quot;);</span><br><span class="line">                var layer = new ArcGISDynamicMapServiceLayer</span><br><span class="line">                (&quot;http://localhost:6080/arcgis/rest/services/Test/mynet/MapServer&quot;);</span><br><span class="line">                map.addLayer(layer)</span><br><span class="line">                //创建路径分析对象</span><br><span class="line">                var shortestAnalyst = new RouteTask(&quot;http://localhost:6080/arcgis/rest/services/Test/mynet/NAServer/Route&quot;);</span><br><span class="line">                //创建路径参数对象</span><br><span class="line">                var routeParas = new RouteParameters();</span><br><span class="line">                //障碍点，但是此时障碍点为空</span><br><span class="line">                routeParas.barriers = new FeatureSet();</span><br><span class="line">                //停靠点，但是此时停靠点为空</span><br><span class="line">                routeParas.stops = new FeatureSet();</span><br><span class="line">                //路径是否有方向</span><br><span class="line">                routeParas.returnDirections = false;</span><br><span class="line">                //是否返回路径，此处必须返回</span><br><span class="line">                routeParas.returnRoutes = true;</span><br><span class="line">                //空间参考</span><br><span class="line">                routeParas.outSpatialReference = map.SpatialReference;</span><br><span class="line">                //定义一个标志</span><br><span class="line">                //selectPointID=0什么都不做</span><br><span class="line">                //selectPointID=1说明是添加停靠点</span><br><span class="line">                //selectPointID=2说明是添加障碍点</span><br><span class="line">                var selectPointID;</span><br><span class="line">                //给停靠点按钮添加点击事件</span><br><span class="line">                on(dom.byId(&quot;stop&quot;),&quot;click&quot;,function()&#123;</span><br><span class="line">                    selectPointID = 1;</span><br><span class="line">                &#125;)</span><br><span class="line">                //给障碍点按钮添加点击事件</span><br><span class="line">                on(dom.byId(&quot;barriers&quot;),&quot;click&quot;,function()&#123;</span><br><span class="line">                    selectPointID = 2;</span><br><span class="line">                &#125;)</span><br><span class="line">                //定义停靠点的符号</span><br><span class="line">                var stopSymbol = new SimpleMarkerSymbol();</span><br><span class="line">                stopSymbol.style = SimpleMarkerSymbol.STYLE_CIRCLE;</span><br><span class="line">                stopSymbol.setSize(8);</span><br><span class="line">                stopSymbol.setColor(new Color(&quot;#FFFFCC&quot;));</span><br><span class="line">                //定义障碍点的符号</span><br><span class="line">                var barrierSymbol = new SimpleMarkerSymbol();</span><br><span class="line">                barrierSymbol.style = SimpleMarkerSymbol.STYLE_CIRCLE;</span><br><span class="line">                barrierSymbol.setSize(8);</span><br><span class="line">                barrierSymbol.setColor(new Color(&quot;#f1a340&quot;));</span><br><span class="line">                on(map, &quot;mouse-down&quot;, function(evt)&#123;</span><br><span class="line">                    //通过selectPointID判断是添加是停靠点还是障碍点</span><br><span class="line">                    switch (selectPointID) &#123;</span><br><span class="line">                        case 0:</span><br><span class="line">                            break;</span><br><span class="line">                        case 1:</span><br><span class="line">                            //获得停靠点的坐标</span><br><span class="line">                            var pointStop=evt.mapPoint;</span><br><span class="line">                            var gr=new Graphic(pointStop,stopSymbol);</span><br><span class="line">                            //构建停靠点的参数</span><br><span class="line">                            routeParas.stops.features.push(gr);</span><br><span class="line">                            break;</span><br><span class="line">                        case 2:</span><br><span class="line">                            //获得障碍点的坐标</span><br><span class="line">                            var pointBarrier=evt.mapPoint;</span><br><span class="line">                            var gr=new Graphic(pointBarrier,barrierSymbol);</span><br><span class="line">                            //构建障碍点的参数</span><br><span class="line">                            routeParas.barriers.features.push(gr);</span><br><span class="line">                            break;</span><br><span class="line">                    &#125;</span><br><span class="line">                    //如果selectPointID不等于0，将点的坐标在地图上显示出来</span><br><span class="line">                    if (selectPointID != 0) &#123;</span><br><span class="line">                        addTextPoint(&quot;停靠点&quot;, pointStop, stopSymbol);</span><br><span class="line">                        addTextPoint(&quot;障碍点&quot;, pointBarrier, barrierSymbol);</span><br><span class="line">                        selectPointID = 0;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                //文本符号：文本信息，点坐标，符号</span><br><span class="line">                function addTextPoint(text,point,symbol) &#123;</span><br><span class="line">                    var textSymbol = new TextSymbol(text);</span><br><span class="line">                    textSymbol.setColor(new Color([128, 0, 0]));              </span><br><span class="line">                    var graphicText = Graphic(point, textSymbol);</span><br><span class="line">                    var graphicpoint = new Graphic(point, symbol);</span><br><span class="line">                    //用默认的图层添加</span><br><span class="line">                    map.graphics.add(graphicpoint);</span><br><span class="line">                    map.graphics.add(graphicText);</span><br><span class="line">                &#125;</span><br><span class="line">                //给分析按钮添加点击事件</span><br><span class="line">                on(dom.byId(&quot;analyse&quot;),&quot;click&quot;,function()&#123;</span><br><span class="line">                    //如果障碍点或者停靠点的个数有一个为0，提示用户参数输入不对</span><br><span class="line">                    if  (routeParas.stops.features.length  ==  0  || routeParas.barriers.features.length==0)</span><br><span class="line">                    &#123;</span><br><span class="line">                        alert(&quot;输入参数不全，无法分析&quot;);</span><br><span class="line">                        return;</span><br><span class="line">                    &#125;</span><br><span class="line">                    //执行路径分析函数</span><br><span class="line">                    shortestAnalyst.solve(routeParas, showRoute)</span><br><span class="line">                &#125;)</span><br><span class="line">                //处理路径分析返回的结果。</span><br><span class="line">                function showRoute(solveResult) &#123;</span><br><span class="line">                    //路径分析的结果</span><br><span class="line">                    var routeResults = solveResult.routeResults;</span><br><span class="line">                    //路径分析的长度</span><br><span class="line">                    var res = routeResults.length;</span><br><span class="line">                    //路径的符号</span><br><span class="line">                    routeSymbol  = new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new Color([255, 0, 0]), 3);</span><br><span class="line">                    if (res &gt; 0) &#123;</span><br><span class="line">                        for (var i = 0; i &lt; res; i++) &#123;</span><br><span class="line">                            var graphicroute = routeResults[i];</span><br><span class="line">                            var graphic = graphicroute.route;</span><br><span class="line">                            graphic.setSymbol(routeSymbol);</span><br><span class="line">                            map.graphics.add(graphic);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    else &#123;</span><br><span class="line">                        alert(&quot;没有返回结果&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;               </span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=&quot;MyMapDiv&quot; class=&quot;MapClass&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;input id=&quot;stop&quot; type=&quot;button&quot; value=&quot;停靠点&quot; /&gt;</span><br><span class="line">    &lt;input id=&quot;barriers&quot; type=&quot;button&quot; value=&quot;障碍点&quot; /&gt;</span><br><span class="line">    &lt;input id=&quot;analyse&quot; type=&quot;button&quot; value=&quot;分析&quot; /&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
                
                <div class="readmore">
                    <a href="/2019/08/06/ArcGIS-API-for-JS21/">
                        阅读更多
                    </a>
                </div>
            </div>
        
            <div class="post-item">
                <h1>
                    <a href="/2019/08/06/ArcGIS-API-for-JS20/">
                        ArcGIS API For Javascript之编辑服务器端图层
                    </a>
                </h1>
                <div class="create">
                    <span>创建于</span>
                    
                        <time datetime="2019-08-06T09:19:00.000Z">
                            2019-08-06
                        </time>
                    
                    <ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/ArcGIS/">ArcGIS</a></li></ul>
                </div>
                
                    <p>在现实需求中，我们不仅仅需要编辑客户端图层，也有可能去编辑服务器端图层，要想编辑服务器端的图层，必须要将地图发布为：要素服务</p>
<h3 id="需求（服务器端图层编辑）"><a href="#需求（服务器端图层编辑）" class="headerlink" title="需求（服务器端图层编辑）"></a>需求（服务器端图层编辑）</h3><p>关于服务器端图层的操作,基本就是增删改查操作，要素服务的查询前面已经介绍过，在此篇博客中主要记录一下关于要素服务的增删改操作,在ArcGIS API for JS中给我们提供了三个类用于要素的增Add,删Delete,改Update,接下来就用这三个类来实现我们的功能。</p>
<ul>
<li>我们操作的是要素服务的sushelou图层</li>
<li>我们的服务：</li>
</ul>
<p><img src="/2019/08/06/ArcGIS-API-for-JS20/01.png" alt="01.png"><br>注意：宿舍楼图层编号为1</p>
<p>图层的属性信息<br><img src="/2019/08/06/ArcGIS-API-for-JS20/02.png" alt="02.png"></p>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p>首先在页面添加三个按钮(用于实现用户的增删改操作)</p>
<p><button class="btn">添加要素</button></p>
<p><button class="btn">删除要素</button></p>
<p><button class="btn">修改要素</button></p>
<p><button class="btn">查询要素</button><br>添加地图（省略）<br>创建通用的对象，例如Draw<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//用于操作的要素图层，注意我们是操作的宿舍楼图层</span><br><span class="line">var featureLayer = new FeatureLayer(&quot;http://localhost:6080/arcgis/rest/services/Test/ft/FeatureServer/1&quot;,</span><br><span class="line">                    &#123;</span><br><span class="line">                            mode:FeatureLayer.MODE_SNAPSHOT,</span><br><span class="line">                            outFields: [&quot;*&quot;]</span><br><span class="line">                    &#125;);</span><br><span class="line">                    //在添加要素时，利用Draw工具获得geometry对象</span><br><span class="line">                    var d = new Draw(map, &#123; showTooltips: true &#125;);</span><br><span class="line">                    //要操作的graphic</span><br><span class="line">                    var g;</span><br></pre></td></tr></table></figure></p>
<p>给相应的按钮添加绑定事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">query(&quot;button&quot;).on(&quot;click&quot;,function(event)&#123;</span><br><span class="line">                        //获得按钮的文本</span><br><span class="line">                        var value=this.innerHTML; </span><br><span class="line">                        //根据文本绑定不同的事件</span><br><span class="line">                        switch(value)&#123;</span><br><span class="line">                            case &quot;添加要素&quot;:</span><br><span class="line">                                d.activate(Draw.POLYGON);</span><br><span class="line">                                break;</span><br><span class="line">                            case &quot;删除要素&quot;:</span><br><span class="line">                                //创建Graphic对象，删除OBJECTID为34的元素，</span><br><span class="line">                                //因为OBJECTID是主键，所以只需要指定主键即可</span><br><span class="line">                                g=new Graphic(&quot;&quot;,&quot;&quot;,&#123;</span><br><span class="line">                                    &quot;OBJECTID&quot;:34</span><br><span class="line">                                &#125;);</span><br><span class="line">                                //创建删除对象</span><br><span class="line">                                var de=new Delete(&#123;</span><br><span class="line">                                    &quot;featureLayer&quot;:featureLayer,</span><br><span class="line">                                    &quot;deletedGraphics&quot;:[g]</span><br><span class="line">                                &#125;);</span><br><span class="line">                                //执行删除结果</span><br><span class="line">                                de.performRedo();</span><br><span class="line">                                //刷新图层</span><br><span class="line">                                layer.refresh();</span><br><span class="line">                                break;</span><br><span class="line">                            case &quot;修改要素&quot;:</span><br><span class="line">                                //用于修改要素的函数,查询更新为36的要素</span><br><span class="line">                                updateFeature(36);</span><br><span class="line">                                break;                          </span><br><span class="line">                            case &quot;查询要素&quot;:</span><br><span class="line">                                //用于查询要素的函数，查询主键为36的要素</span><br><span class="line">                                searchFeather(36);</span><br><span class="line">                                break;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br></pre></td></tr></table></figure></p>
<p>如果是添加操作（利用draw添加geometry属性）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//当画图完毕时，添加要素</span><br><span class="line">                    on(d, &quot;draw-complete&quot;, function (result) &#123;</span><br><span class="line">                        //要素只赋予了geometry，属性信息为空</span><br><span class="line">                        var graphic = new Graphic(result.geometry, null,&#123;&#125;);</span><br><span class="line">                        var add=new Add(&#123;</span><br><span class="line">                            &quot;featureLayer&quot;:featureLayer,//给哪一个要素图层添加要素</span><br><span class="line">                            &quot;addedGraphics&quot;:[graphic]//用于添加的要素</span><br><span class="line">                        &#125;)</span><br><span class="line">                        //执行添加函数</span><br><span class="line">                        add.performRedo();</span><br><span class="line">                        //刷新视图</span><br><span class="line">                        layer.refresh();</span><br><span class="line">                        //关闭绘图对象</span><br><span class="line">                        d.deactivate();</span><br><span class="line">                    &#125;);</span><br></pre></td></tr></table></figure></p>
<p>如果是查询操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">//根据id查询要素</span><br><span class="line">            function searchFeather(id,callback)&#123;</span><br><span class="line">                        //得到要素图层的主键属性</span><br><span class="line">                        var idProperty = featureLayer.objectIdField;</span><br><span class="line">                        //定义查询参数</span><br><span class="line">                        var query = new Query();</span><br><span class="line">                        //是否返回几何形状</span><br><span class="line">                        query.returnGeometry = false;</span><br><span class="line">                        //图层的主键名称（根据自己要求修改）</span><br><span class="line">                        query.objectIds = [id];</span><br><span class="line">                        //查询条件1=1意思是：只根据主键查询，忽略where子句</span><br><span class="line">                        query.where = &quot;1=1&quot;;</span><br><span class="line">                        //进行查询</span><br><span class="line">                        featureLayer.selectFeatures(query, FeatureLayer.SELECTION_NEW,function(result)&#123;</span><br><span class="line">                            //如果callback不存在，说明仅仅是查询操作</span><br><span class="line">                            if(!callback)&#123;</span><br><span class="line">                                //因为我们根据主键查询，一定只有一个元素</span><br><span class="line">                                var graphic=result[0];</span><br><span class="line">                                //获得属性</span><br><span class="line">                                var attributes=graphic.attributes;</span><br><span class="line">                                //得到该属性信息转换成字符串</span><br><span class="line">                                var result=jsonUtil.stringify(attributes)</span><br><span class="line">                                //将结果弹出一下</span><br><span class="line">                                alert(result);</span><br><span class="line">                            &#125;else//如果callback存在，说明是更新操作</span><br><span class="line">                            &#123;</span><br><span class="line">                                callback(result);</span><br><span class="line">                            &#125;</span><br><span class="line">                            </span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br></pre></td></tr></table></figure></p>
<p>如果是更新操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">//根据id修改要素</span><br><span class="line">                    function updateFeature(id)&#123;</span><br><span class="line">                        //注意:（第二个参数）这里传入一个回调函数，用于处理查询出来的数据</span><br><span class="line">                        searchFeather(id,function(result)&#123;</span><br><span class="line">                                //获得旧的要素</span><br><span class="line">                                var oldgraphic=result[0];</span><br><span class="line">                                //新的要素</span><br><span class="line">                                var newgraphic=new Graphic(oldgraphic.toJson());</span><br><span class="line">                                //将alias属性修改为:修改后的C区</span><br><span class="line">                                newgraphic.attributes.alias=&quot;修改后的C区&quot;;</span><br><span class="line">                                //创建更新对象</span><br><span class="line">                                var update=new Update(&#123;</span><br><span class="line">                                    &quot;featureLayer&quot;:featureLayer,</span><br><span class="line">                                    &quot;postUpdatedGraphics&quot;:[newgraphic],//修改之后的要素</span><br><span class="line">                                    &quot;preUpdatedGraphics&quot;:[oldgraphic]//修改之前的要素</span><br><span class="line">                                &#125;)</span><br><span class="line">                                //执行刷新操作</span><br><span class="line">                                update.performRedo();</span><br><span class="line">                                //刷新视图</span><br><span class="line">                                layer.refresh();</span><br><span class="line">                                alert(&quot;修改成功&quot;);</span><br><span class="line">                                </span><br><span class="line">                        &#125;)</span><br><span class="line">                        </span><br><span class="line">                    &#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="全部代码"><a href="#全部代码" class="headerlink" title="全部代码"></a>全部代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;/&gt;</span><br><span class="line">    &lt;title&gt;WebGIS&lt;/title&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script  type=&quot;text/Javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">        .MapClass&#123;</span><br><span class="line">            width:100%;</span><br><span class="line">            height:500px;</span><br><span class="line">            border:1px solid #000;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line"></span><br><span class="line">        require([&quot;esri/map&quot;,</span><br><span class="line">        &quot;dojo/on&quot;,</span><br><span class="line">        &quot;dojo/query&quot;,</span><br><span class="line">        &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">        &quot;esri/toolbars/draw&quot;,</span><br><span class="line">        &quot;esri/layers/FeatureLayer&quot;,</span><br><span class="line">        &quot;esri/graphic&quot;, &quot;esri/dijit/editing/Add&quot;,</span><br><span class="line">        &quot;esri/dijit/editing/Delete&quot;,&quot;esri/dijit/editing/Update&quot;,&quot;esri/tasks/query&quot;,&quot;dojo/json&quot;,</span><br><span class="line">        &quot;dojo/domReady!&quot;],</span><br><span class="line">                function (Map,on,query, ArcGISDynamicMapServiceLayer, Draw,FeatureLayer,Graphic,Add,Delete,Update,Query,jsonUtil) &#123;</span><br><span class="line"></span><br><span class="line">                    </span><br><span class="line">                    var map = new esri.Map(&quot;MyMapDiv&quot;);</span><br><span class="line">                    var layer = new ArcGISDynamicMapServiceLayer(&quot;http://localhost:6080/arcgis/rest/services/Test/ft/MapServer&quot;);</span><br><span class="line">                    map.addLayer(layer);</span><br><span class="line">                    //用于操作的要素图层，注意我们是操作的宿舍楼图层</span><br><span class="line">                    var featureLayer = new FeatureLayer(&quot;http://localhost:6080/arcgis/rest/services/Test/ft/FeatureServer/1&quot;,</span><br><span class="line">                         &#123;</span><br><span class="line">                            mode:FeatureLayer.MODE_SNAPSHOT,</span><br><span class="line">                            outFields: [&quot;*&quot;]</span><br><span class="line">                         &#125;);</span><br><span class="line">                    //在添加要素时，利用Draw工具获得geometry对象</span><br><span class="line">                    var d = new Draw(map, &#123; showTooltips: true &#125;);</span><br><span class="line">                    //要操作的graphic</span><br><span class="line">                    var g;</span><br><span class="line">                    query(&quot;button&quot;).on(&quot;click&quot;,function(event)&#123;</span><br><span class="line">                        var value=this.innerHTML;</span><br><span class="line">                        switch(value)&#123;</span><br><span class="line">                            case &quot;添加要素&quot;:</span><br><span class="line">                                d.activate(Draw.POLYGON);</span><br><span class="line">                                break;</span><br><span class="line">                            case &quot;删除要素&quot;:</span><br><span class="line">                                //创建Graphic对象，删除OBJECTID为34的元素，</span><br><span class="line">                                //因为OBJECTID是主键，所以只需要指定主键即可</span><br><span class="line">                                g=new Graphic(&quot;&quot;,&quot;&quot;,&#123;</span><br><span class="line">                                    &quot;OBJECTID&quot;:34</span><br><span class="line">                                &#125;);</span><br><span class="line">                                //创建删除对象</span><br><span class="line">                                var de=new Delete(&#123;</span><br><span class="line">                                    &quot;featureLayer&quot;:featureLayer,</span><br><span class="line">                                    &quot;deletedGraphics&quot;:[g]</span><br><span class="line">                                &#125;);</span><br><span class="line">                                //执行删除结果</span><br><span class="line">                                de.performRedo();</span><br><span class="line">                                //刷新图层</span><br><span class="line">                                layer.refresh();</span><br><span class="line">                                break;</span><br><span class="line">                            case &quot;修改要素&quot;:</span><br><span class="line">                                //用于修改要素的函数,查询更新为36的要素</span><br><span class="line">                                updateFeature(1);</span><br><span class="line">                                break;                          </span><br><span class="line">                            case &quot;查询要素&quot;:</span><br><span class="line">                                //用于查询要素的函数，查询主键为36的要素</span><br><span class="line">                                searchFeather(1);</span><br><span class="line">                                break;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    //当画图完毕时，添加要素</span><br><span class="line">                    on(d, &quot;draw-complete&quot;, function (result) &#123;</span><br><span class="line">                        //要素只赋予了geometry，属性信息为空</span><br><span class="line">                        var graphic = new Graphic(result.geometry, null,&#123;&#125;);</span><br><span class="line">                        var add=new Add(&#123;</span><br><span class="line">                            &quot;featureLayer&quot;:featureLayer,//给哪一个要素图层添加要素</span><br><span class="line">                            &quot;addedGraphics&quot;:[graphic]//用于添加的要素</span><br><span class="line">                        &#125;)</span><br><span class="line">                        //执行添加函数</span><br><span class="line">                        add.performRedo();</span><br><span class="line">                        //刷新视图</span><br><span class="line">                        layer.refresh();</span><br><span class="line">                        //关闭绘图对象</span><br><span class="line">                        d.deactivate();</span><br><span class="line">                    &#125;);</span><br><span class="line">                    //根据id修改要素</span><br><span class="line">                    function updateFeature(id)&#123;</span><br><span class="line">                        //注意:（第二个参数）这里传入一个回调函数，用于处理查询出来的数据</span><br><span class="line">                        searchFeather(id,function(result)&#123;</span><br><span class="line">                                //获得旧的要素</span><br><span class="line">                                var oldgraphic=result[0];</span><br><span class="line">                                //新的要素</span><br><span class="line">                                var newgraphic=new Graphic(oldgraphic.toJson());</span><br><span class="line">                                //将alias属性修改为:修改后的A区宿舍</span><br><span class="line">                                newgraphic.attributes.alias=&quot;修改后的A区宿舍&quot;;</span><br><span class="line">                                //创建更新对象</span><br><span class="line">                                var update=new Update(&#123;</span><br><span class="line">                                    &quot;featureLayer&quot;:featureLayer,</span><br><span class="line">                                    &quot;postUpdatedGraphics&quot;:[newgraphic],//修改之后的要素</span><br><span class="line">                                    &quot;preUpdatedGraphics&quot;:[oldgraphic]//修改之前的要素</span><br><span class="line">                                &#125;)</span><br><span class="line">                                //执行刷新操作</span><br><span class="line">                                update.performRedo();</span><br><span class="line">                                //刷新视图</span><br><span class="line">                                layer.refresh();</span><br><span class="line">                                alert(&quot;修改成功&quot;);</span><br><span class="line">                                </span><br><span class="line">                        &#125;)</span><br><span class="line">                        </span><br><span class="line">                    &#125;</span><br><span class="line">                    //根据id查询要素</span><br><span class="line">                    function searchFeather(id,callback)&#123;</span><br><span class="line">                        //得到要素图层的主键属性</span><br><span class="line">                        var idProperty = featureLayer.objectIdField;</span><br><span class="line">                        //定义查询参数</span><br><span class="line">                        var query = new Query();</span><br><span class="line">                        //是否返回几何形状</span><br><span class="line">                        query.returnGeometry = false;</span><br><span class="line">                        //图层的主键名称（根据自己要求修改）</span><br><span class="line">                        query.objectIds = [id];</span><br><span class="line">                        //查询条件1=1意思是：只根据主键查询，忽略where子句</span><br><span class="line">                        query.where = &quot;1=1&quot;;</span><br><span class="line">                        //进行查询</span><br><span class="line">                        featureLayer.selectFeatures(query, FeatureLayer.SELECTION_NEW,function(result)&#123;</span><br><span class="line">                            //如果callback不存在，说明仅仅是查询操作</span><br><span class="line">                            if(!callback)&#123;</span><br><span class="line">                                //因为我们根据主键查询，一定只有一个元素</span><br><span class="line">                                var graphic=result[0];</span><br><span class="line">                                //获得属性</span><br><span class="line">                                var attributes=graphic.attributes;</span><br><span class="line">                                //得到该属性信息转换成字符串</span><br><span class="line">                                var result=jsonUtil.stringify(attributes)</span><br><span class="line">                                //将结果弹出一下</span><br><span class="line">                                alert(result);</span><br><span class="line">                            &#125;else//如果callback存在，说明是更新操作</span><br><span class="line">                            &#123;</span><br><span class="line">                                callback(result);</span><br><span class="line">                            &#125;</span><br><span class="line">                            </span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;MyMapDiv&quot; class=&quot;MapClass&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;button class=&quot;btn&quot;&gt;添加要素&lt;/button&gt;</span><br><span class="line">&lt;button class=&quot;btn&quot;&gt;删除要素&lt;/button&gt;</span><br><span class="line">&lt;button class=&quot;btn&quot;&gt;修改要素&lt;/button&gt;</span><br><span class="line">&lt;button class=&quot;btn&quot;&gt;查询要素&lt;/button&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
                
                <div class="readmore">
                    <a href="/2019/08/06/ArcGIS-API-for-JS20/">
                        阅读更多
                    </a>
                </div>
            </div>
        
            <div class="post-item">
                <h1>
                    <a href="/2019/08/06/ArcGIS-API-for-JS19/">
                        ArcGIS API For Javacsript编辑客户端图形
                    </a>
                </h1>
                <div class="create">
                    <span>创建于</span>
                    
                        <time datetime="2019-08-06T09:07:56.000Z">
                            2019-08-06
                        </time>
                    
                    <ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/ArcGIS/">ArcGIS</a></li></ul>
                </div>
                
                    <p>在ArcGIS API当中，提供了一个工具叫做Edit，我们利用Edit可以交互的编辑客户端图形Graphic，这个功能在我们实际开发过程中非常有用，可以交互编辑已经存在的Graphic以达到我们的目的，Edit工具可以从以下方面编辑客户端图形：</p>
<ul>
<li>移动客户端图形</li>
<li>编辑结点（增加结点，删除结点）</li>
<li>拉伸客户端图形（是否保持长宽比例）</li>
<li>旋转客户端图形</li>
</ul>
<h3 id="Edit工具的使用"><a href="#Edit工具的使用" class="headerlink" title="Edit工具的使用"></a>Edit工具的使用</h3><p>使用Edit工具很简单，只需要以下几步即可：</p>
<ul>
<li>给地图添加Graphic，为了下面Edit交互操作做准备</li>
<li>创建Edit对象</li>
<li>激活Edit工具，此时需要制定Edit的一些参数</li>
<li>操作完Graphic将Edit工具关闭</li>
</ul>
<h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><p>添加地图（省略）<br>定义Edit对象，和graphic对象<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//声明一个客户端图形（为了以后的编辑）</span><br><span class="line">var graphic</span><br><span class="line">//定义一个Edit对象</span><br><span class="line">var edit = new Edit(map);</span><br></pre></td></tr></table></figure></p>
<p>首先创建几个按钮（用户实现相应的功能）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;button&quot;  id=&quot;add&quot; value=&quot;添加客户端图形&quot;&gt;</span><br><span class="line">&lt;input type=&quot;button&quot; class=&quot;btn&quot; value=&quot;移动客户端图形&quot;&gt;</span><br><span class="line">&lt;input type=&quot;button&quot; class=&quot;btn&quot; value=&quot;拉伸客户端图形&quot;&gt;</span><br><span class="line">&lt;input type=&quot;button&quot; class=&quot;btn&quot; value=&quot;旋转客户端图形&quot;&gt;</span><br><span class="line">&lt;input type=&quot;button&quot; class=&quot;btn&quot; value=&quot;编辑结点&quot;&gt;</span><br></pre></td></tr></table></figure></p>
<p>给添加客户端图形按钮添加绑定事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">on(dom.byId(&quot;add&quot;),&quot;click&quot;,function()&#123;</span><br><span class="line">                //定义线符号</span><br><span class="line">                var lineSymbol=new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new Color([255, 0, 0]), 3);</span><br><span class="line">                //定义面符号</span><br><span class="line">                var fill=SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol,  new Color([255, 0, 0]));</span><br><span class="line">                //点的坐标对</span><br><span class="line">                var ring=[];</span><br><span class="line">                ring[0]=[</span><br><span class="line">                    [510275, 3986100],</span><br><span class="line">                    [510508, 3986162],</span><br><span class="line">                    [510596, 3986032],</span><br><span class="line">                    [510271, 3985847],</span><br><span class="line">                    [510275, 3986100]</span><br><span class="line">                ];</span><br><span class="line">                var geometry=new Polygon(&#123;</span><br><span class="line">                    &quot;rings&quot;:ring,</span><br><span class="line">                    &quot;spatialReference&quot;:map.spatialReference</span><br><span class="line">                &#125;);</span><br><span class="line">                graphic=new Graphic(geometry,fill);</span><br><span class="line">                map.graphics.add(graphic);</span><br><span class="line">            &#125;)</span><br></pre></td></tr></table></figure></p>
<p>给剩余四个按钮添加绑定事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">//给剩余四个按钮绑定事件</span><br><span class="line">            query(&quot;.btn&quot;).on(&quot;click&quot;,function(event)&#123;</span><br><span class="line">                var value=event.currentTarget.defaultValue;</span><br><span class="line">                switch(value)&#123;</span><br><span class="line">                    case &quot;移动客户端图形&quot;:</span><br><span class="line">                        //激活Edit工具（移动）</span><br><span class="line">                        edit.activate(Edit.MOVE,graphic);</span><br><span class="line">                        break;</span><br><span class="line">                    case &quot;拉伸客户端图形&quot;:</span><br><span class="line">                        //构建Edit参数 注：拉伸的时候，可以指定是否保持长宽比例</span><br><span class="line">                        var options = &#123;</span><br><span class="line">                            uniformScaling:true</span><br><span class="line">                        &#125;;</span><br><span class="line">                        //激活Edit工具（拉伸客户端图形）</span><br><span class="line">                        edit.activate(Edit.SCALE,graphic,options)</span><br><span class="line">                        break;</span><br><span class="line">                    case &quot;旋转客户端图形&quot;:</span><br><span class="line">                        //激活Edit工具（旋转客户端图形）</span><br><span class="line">                        edit.activate(Edit.ROTATE,graphic)</span><br><span class="line">                        break;</span><br><span class="line">                    case &quot;编辑结点&quot;:</span><br><span class="line">                        //构建Edit参数 注：编辑折点的时候，要指定是否能添加或者删除结点。</span><br><span class="line">                        var options = &#123;</span><br><span class="line">                            allowAddVertices:true,//能添加结点</span><br><span class="line">                            allowDeleteVertices: true,//能删除结点</span><br><span class="line">                        &#125;;</span><br><span class="line">                        edit.activate(Edit.EDIT_VERTICES, graphic, options);</span><br><span class="line">                        break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br></pre></td></tr></table></figure></p>
<p>关闭Edit工具<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//用完Edit工具，将工具关闭，点击地图（没有点击到Graphic时结束）</span><br><span class="line">            map.on(&quot;click&quot;, function () &#123;</span><br><span class="line">                edit.deactivate();</span><br><span class="line">            &#125;)</span><br></pre></td></tr></table></figure></p>
<h4 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h4><p><img src="/2019/08/06/ArcGIS-API-for-JS19/1.png" alt="1.png"><br><img src="/2019/08/06/ArcGIS-API-for-JS19/2.png" alt="2.png"><br><img src="/2019/08/06/ArcGIS-API-for-JS19/3.png" alt="3.png"><br><img src="/2019/08/06/ArcGIS-API-for-JS19/4.png" alt="4.png"><br><img src="/2019/08/06/ArcGIS-API-for-JS19/5.png" alt="5.png"><br><img src="/2019/08/06/ArcGIS-API-for-JS19/6.png" alt="6.png"></p>
<h4 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Graphic&lt;/title&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script  type=&quot;text/Javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        .MapClass&#123;</span><br><span class="line">            width:100%;</span><br><span class="line">            height:500px;</span><br><span class="line">            border:1px solid #000;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        require([&quot;esri/map&quot;,&quot;dojo/dom&quot;,&quot;dojo/on&quot;,&quot;esri/toolbars/edit&quot;,&quot;esri/geometry/Polygon&quot;,</span><br><span class="line">            &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;, &quot;esri/graphic&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleLineSymbol&quot;, &quot;esri/symbols/SimpleFillSymbol&quot;,&quot;dojo/colors&quot;,&quot;dojo/query&quot;,</span><br><span class="line">             &quot;dojo/domReady!&quot;</span><br><span class="line">        ], function (</span><br><span class="line">                Map,dom,on, Edit,Polygon, ArcGISDynamicMapServiceLayer, Graphic,</span><br><span class="line">                SimpleLineSymbol, SimpleFillSymbol,Color,query</span><br><span class="line">        ) &#123;</span><br><span class="line">            var map = new Map(&quot;mapDiv&quot;);</span><br><span class="line">            var url = &quot;http://localhost:6080/arcgis/rest/services/Test/MyService/MapServer&quot;;</span><br><span class="line">            var layer = new ArcGISDynamicMapServiceLayer(url);</span><br><span class="line">            map.addLayer(layer);</span><br><span class="line">            //定义一个Edit对象</span><br><span class="line">            var edit = new Edit(map);</span><br><span class="line">            //定义一个graphic，为了后来的交互编辑</span><br><span class="line">            var graphic;</span><br><span class="line">            //给`添加客户端图形`按钮添加绑定事件</span><br><span class="line">            on(dom.byId(&quot;add&quot;),&quot;click&quot;,function()&#123;</span><br><span class="line">                //定义线符号</span><br><span class="line">                var lineSymbol=new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new Color([255, 0, 0]), 3);</span><br><span class="line">                //定义面符号</span><br><span class="line">                var fill=SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol,  new Color([255, 0, 0]));</span><br><span class="line">                //点的坐标对</span><br><span class="line">                var ring=[];</span><br><span class="line">                ring[0]=[</span><br><span class="line">                    [510275, 3986100],</span><br><span class="line">                    [510508, 3986162],</span><br><span class="line">                    [510596, 3986032],</span><br><span class="line">                    [510271, 3985847],</span><br><span class="line">                    [510275, 3986100]</span><br><span class="line">                ];</span><br><span class="line">                var geometry=new Polygon(&#123;</span><br><span class="line">                    &quot;rings&quot;:ring,</span><br><span class="line">                    &quot;spatialReference&quot;:map.spatialReference</span><br><span class="line">                &#125;);</span><br><span class="line">                graphic=new Graphic(geometry,fill);</span><br><span class="line">                map.graphics.add(graphic);</span><br><span class="line">            &#125;)</span><br><span class="line">            //给按钮绑定事件</span><br><span class="line">            query(&quot;.btn&quot;).on(&quot;click&quot;,function(event)&#123;</span><br><span class="line">                var value=event.currentTarget.defaultValue;</span><br><span class="line">                switch(value)&#123;</span><br><span class="line">                    case &quot;移动客户端图形&quot;:</span><br><span class="line">                        //激活Edit工具（移动）</span><br><span class="line">                        edit.activate(Edit.MOVE,graphic);</span><br><span class="line">                        break;</span><br><span class="line">                    case &quot;拉伸客户端图形&quot;:</span><br><span class="line">                        //构建Edit参数 注：拉伸的时候，可以指定是否保持长宽比例</span><br><span class="line">                        var options = &#123;</span><br><span class="line">                            uniformScaling:true</span><br><span class="line">                        &#125;;</span><br><span class="line">                        //激活Edit工具（拉伸客户端图形）</span><br><span class="line">                        edit.activate(Edit.SCALE,graphic,options)</span><br><span class="line">                        break;</span><br><span class="line">                    case &quot;旋转客户端图形&quot;:</span><br><span class="line">                        //激活Edit工具（旋转客户端图形）</span><br><span class="line">                        edit.activate(Edit.ROTATE,graphic)</span><br><span class="line">                        break;</span><br><span class="line">                    case &quot;编辑结点&quot;:</span><br><span class="line">                        //构建Edit参数 注：编辑折点的时候，要指定是否能添加或者删除结点。</span><br><span class="line">                        var options = &#123;</span><br><span class="line">                            allowAddVertices:true,//能添加结点</span><br><span class="line">                            allowDeleteVertices: true,//能删除结点</span><br><span class="line">                        &#125;;</span><br><span class="line">                        edit.activate(Edit.EDIT_VERTICES, graphic, options);</span><br><span class="line">                        break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            //用完Edit工具，将工具关闭，点击地图（没有点击到Graphic时结束）</span><br><span class="line">            map.on(&quot;click&quot;, function () &#123;</span><br><span class="line">                edit.deactivate();</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=&quot;mapDiv&quot; class=&quot;MapClass&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;input type=&quot;button&quot;  id=&quot;add&quot; value=&quot;添加客户端图形&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;button&quot; class=&quot;btn&quot; value=&quot;移动客户端图形&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;button&quot; class=&quot;btn&quot; value=&quot;拉伸客户端图形&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;button&quot; class=&quot;btn&quot; value=&quot;旋转客户端图形&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;button&quot; class=&quot;btn&quot; value=&quot;编辑结点&quot;&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
                
                <div class="readmore">
                    <a href="/2019/08/06/ArcGIS-API-for-JS19/">
                        阅读更多
                    </a>
                </div>
            </div>
        
            <div class="post-item">
                <h1>
                    <a href="/2019/08/06/ArcGIS-API-for-JS18/">
                        ArcGIS API For Javascript之动态图层
                    </a>
                </h1>
                <div class="create">
                    <span>创建于</span>
                    
                        <time datetime="2019-08-06T08:42:34.000Z">
                            2019-08-06
                        </time>
                    
                    <ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/ArcGIS/">ArcGIS</a></li></ul>
                </div>
                
                    <p>动态图层主要特点：</p>
<ul>
<li>改变地图服务的现有图层</li>
<li>动态图层适用于海量图层的情况</li>
<li>不需要将shp文件发布为服务，服务器可以直接读取shp文件在前端显示</li>
</ul>
<h3 id="调用动态图层"><a href="#调用动态图层" class="headerlink" title="调用动态图层"></a>调用动态图层</h3><p>在前面已经说过动态图层并不是一种新的服务类型，而是地图服务的一种扩展，因此我们不需要发布服务，只需要对地图服务添加动态图层功能即可。启用地图服务的步骤为：</p>
<ul>
<li>给相应的地图服务启用动态工作空间</li>
<li>选择服务器相应的硬盘地址并赋予其id</li>
<li>将相应位置注册到ArcGIS Server服务器（保证ArcGIS Server可以访问数据）</li>
<li>在Web端进行调用</li>
</ul>
<h4 id="启用动态图层"><a href="#启用动态图层" class="headerlink" title="启用动态图层"></a>启用动态图层</h4><p>我们打开Manager-&gt;登录，找到该服务，点击功能，选择允许每次请求修改图层顺序和符号-&gt;添加<br><img src="/2019/08/06/ArcGIS-API-for-JS18/01.png" alt="01.png"><br>硬盘上的数据<br><img src="/2019/08/06/ArcGIS-API-for-JS18/02.png" alt="02.png"><br>注:D:\myshp文件夹下面有一个shp文件：lunkuoxian.shp<br>因此我们选择工作空间类型为：shpfile文件夹，工作空间id在此处取名为my，硬盘路径：D：\myshp<br><img src="/2019/08/06/ArcGIS-API-for-JS18/03.png" alt="03.png"><br>点击确定，重新启动服务<br><img src="/2019/08/06/ArcGIS-API-for-JS18/04.png" alt="04.png"><br><img src="/2019/08/06/ArcGIS-API-for-JS18/05.png" alt="05.png"><br>注册文件夹到服务器<br>点击站点-&gt;数据存储-&gt;注册文件夹（因为我们是文件夹，所以是注册文件夹，如果是数据库，那么就要注册数据库）<br><img src="/2019/08/06/ArcGIS-API-for-JS18/06.png" alt="06.png"><br><img src="/2019/08/06/ArcGIS-API-for-JS18/07.png" alt="07.png"><br><img src="/2019/08/06/ArcGIS-API-for-JS18/08.png" alt="08.png"><br>在Services Directory 查看动态图层是否启用<br><img src="/2019/08/06/ArcGIS-API-for-JS18/09.png" alt="09.png"></p>
<h4 id="Web端调用"><a href="#Web端调用" class="headerlink" title="Web端调用"></a>Web端调用</h4><h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><p>首先我们加载地图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">require([&quot;esri/map&quot;,</span><br><span class="line">            &quot;dojo/dom&quot;,</span><br><span class="line">            &quot;dojo/on&quot;,</span><br><span class="line">            &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">            &quot;esri/layers/FeatureLayer&quot;,</span><br><span class="line">            &quot;esri/layers/TableDataSource&quot;,</span><br><span class="line">            &quot;esri/layers/LayerDataSource&quot;,</span><br><span class="line">            &quot;esri/renderers/SimpleRenderer&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleMarkerSymbol&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleLineSymbol&quot;,</span><br><span class="line">            &quot;dojo/domReady!&quot;], function (</span><br><span class="line">                Map,dom,on, ArcGISDynamicMapServiceLayer, FeatureLayer, TableDataSource, LayerDataSource, SimpleRenderer, SimpleMarkerSymbol,SimpleLineSymbol) &#123;</span><br><span class="line">            var map = new Map(&quot;mapDiv&quot;);</span><br><span class="line">            var layer1 = new ArcGISDynamicMapServiceLayer(&quot;http://localhost:6080/arcgis/rest/services//Test/MyService/MapServer&quot;);</span><br><span class="line">            map.addLayer(layer1);</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure></p>
<p>添加一个按钮（用于添加动态图层）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button id=&quot;btn&quot;&gt;添加动态图层&lt;/button&gt;</span><br></pre></td></tr></table></figure></p>
<p>给按钮添加事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">on(dom.byId(&quot;btn&quot;),&quot;click&quot;,function(e)&#123;</span><br><span class="line">                //定义一个数据源</span><br><span class="line">                var dataSource = new TableDataSource();</span><br><span class="line">                //此处为我们设置的命名空间</span><br><span class="line">                dataSource.workspaceId = &quot;my&quot;;</span><br><span class="line">                //命名空间下面的shp</span><br><span class="line">                dataSource.dataSourceName = &quot;lunkuoxian.shp&quot;;</span><br><span class="line">                //定义一个图层数据源</span><br><span class="line">                var layerSource = new LayerDataSource();</span><br><span class="line">                //给图层数据源赋值</span><br><span class="line">                layerSource.dataSource = dataSource;</span><br><span class="line">                //定义一个要素图层:注意链接为动态图层的地址</span><br><span class="line">                var layer2 = new FeatureLayer(&quot;http://localhost:6080/arcgis/rest/services/Test/MyService/MapServer/dynamicLayer&quot;, &#123;</span><br><span class="line">                    mode: FeatureLayer.MODE_ONDEMAND,</span><br><span class="line">                    outFields: [&quot;*&quot;],</span><br><span class="line">                    source: layerSource</span><br><span class="line">                &#125;);</span><br><span class="line">                //定义线符号</span><br><span class="line">                var lineSymbol = new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new dojo.Color([255, 0, 0]), 3);</span><br><span class="line">                //定义渲染器</span><br><span class="line">                var renderer = new esri.renderer.SimpleRenderer(lineSymbol);</span><br><span class="line">                //定义渲染器</span><br><span class="line">                layer2.setRenderer(renderer);</span><br><span class="line">                layer2.refresh();</span><br><span class="line">                map.addLayer(layer2);</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure></p>
<h5 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head lang=&quot;en&quot;&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script  type=&quot;text/Javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">        require([&quot;esri/map&quot;,</span><br><span class="line">            &quot;dojo/dom&quot;,</span><br><span class="line">            &quot;dojo/on&quot;,</span><br><span class="line">            &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">            &quot;esri/layers/FeatureLayer&quot;,</span><br><span class="line">            &quot;esri/layers/TableDataSource&quot;,</span><br><span class="line">            &quot;esri/layers/LayerDataSource&quot;,</span><br><span class="line">            &quot;esri/renderers/SimpleRenderer&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleLineSymbol&quot;,</span><br><span class="line">            &quot;dojo/domReady!&quot;], function (</span><br><span class="line">                Map,dom,on, ArcGISDynamicMapServiceLayer, FeatureLayer, TableDataSource, LayerDataSource, SimpleRenderer,SimpleLineSymbol) &#123;</span><br><span class="line">            var map = new Map(&quot;mapDiv&quot;);</span><br><span class="line">            var layer1 = new ArcGISDynamicMapServiceLayer(&quot;http://localhost:6080/arcgis/rest/services//Test/MyService/MapServer&quot;);</span><br><span class="line">            map.addLayer(layer1);</span><br><span class="line"></span><br><span class="line">            on(dom.byId(&quot;btn&quot;),&quot;click&quot;,function(e)&#123;</span><br><span class="line">                //定义一个数据源</span><br><span class="line">                var dataSource = new TableDataSource();</span><br><span class="line">                //此处为我们设置的命名空间</span><br><span class="line">                dataSource.workspaceId = &quot;my&quot;;</span><br><span class="line">                //命名空间下面的shp</span><br><span class="line">                dataSource.dataSourceName = &quot;lunkuoxian.shp&quot;;</span><br><span class="line">                //定义一个图层数据源</span><br><span class="line">                var layerSource = new LayerDataSource();</span><br><span class="line">                //给图层数据源赋值</span><br><span class="line">                layerSource.dataSource = dataSource;</span><br><span class="line">                //定义一个要素图层:注意链接为动态图层的地址</span><br><span class="line">                var layer2 = new FeatureLayer(&quot;http://localhost:6080/arcgis/rest/services/Test/MyService/MapServer/dynamicLayer&quot;, &#123;</span><br><span class="line">                    mode: FeatureLayer.MODE_ONDEMAND,</span><br><span class="line">                    outFields: [&quot;*&quot;],</span><br><span class="line">                    source: layerSource</span><br><span class="line">                &#125;);</span><br><span class="line">                //定义线符号</span><br><span class="line">                var lineSymbol = new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new dojo.Color([255, 0, 0]), 3);</span><br><span class="line">                //定义渲染器</span><br><span class="line">                var renderer = new esri.renderer.SimpleRenderer(lineSymbol);</span><br><span class="line">                //定义渲染器</span><br><span class="line">                layer2.setRenderer(renderer);</span><br><span class="line">                layer2.refresh();</span><br><span class="line">                map.addLayer(layer2);</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">        &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;mapDiv&quot; style=&quot;height:600px;&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;button id=&quot;btn&quot;&gt;添加动态图层&lt;/button&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>运行结果之后：<br><img src="/2019/08/06/ArcGIS-API-for-JS18/10.png" alt="10.png"></p>
<h3 id="动态图层的属性查询"><a href="#动态图层的属性查询" class="headerlink" title="动态图层的属性查询"></a>动态图层的属性查询</h3><p>在真实需求中,我们不仅仅是将shp在地图中显示那么简单，我们往往要查询该图层的属性信息,我们在前面代码的基础上添加上属性查询。</p>
<h4 id="方法1（通过click直接获取）"><a href="#方法1（通过click直接获取）" class="headerlink" title="方法1（通过click直接获取）"></a>方法1（通过click直接获取）</h4><h5 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h5><p>给要素图层添加点击事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">layer2.on(&quot;click&quot;, function(evt) &#123;</span><br><span class="line">                    //得到点击的graphics</span><br><span class="line">                    var graphic=evt.graphic;</span><br><span class="line">                    //得到该属性信息</span><br><span class="line">                    var attributes=graphic.attributes;</span><br><span class="line">                    //得到该属性信息转换成字符串</span><br><span class="line">                    var result=jsonUtil.stringify(attributes)</span><br><span class="line">                    //将结果弹出一下</span><br><span class="line">                    alert(result);</span><br><span class="line">                    //获得要素图层的主键名称</span><br><span class="line">                    </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h5 id="全部代码"><a href="#全部代码" class="headerlink" title="全部代码"></a>全部代码</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head lang=&quot;en&quot;&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script  type=&quot;text/Javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">        require([&quot;esri/map&quot;,</span><br><span class="line">            &quot;dojo/dom&quot;,</span><br><span class="line">            &quot;dojo/on&quot;,</span><br><span class="line">            &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">            &quot;esri/layers/FeatureLayer&quot;,</span><br><span class="line">            &quot;esri/layers/TableDataSource&quot;,</span><br><span class="line">            &quot;esri/layers/LayerDataSource&quot;,</span><br><span class="line">            &quot;esri/renderers/SimpleRenderer&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleLineSymbol&quot;,&quot;dojo/json&quot;,</span><br><span class="line">            &quot;dojo/domReady!&quot;], function (</span><br><span class="line">                Map,dom,on, ArcGISDynamicMapServiceLayer, FeatureLayer, TableDataSource, LayerDataSource, SimpleRenderer,SimpleLineSymbol,jsonUtil) &#123;</span><br><span class="line">            var map = new Map(&quot;mapDiv&quot;);</span><br><span class="line">            var layer1 = new ArcGISDynamicMapServiceLayer(&quot;http://localhost:6080/arcgis/rest/services//Test/MyService/MapServer&quot;);</span><br><span class="line">            map.addLayer(layer1);</span><br><span class="line"></span><br><span class="line">            on(dom.byId(&quot;btn&quot;),&quot;click&quot;,function(e)&#123;</span><br><span class="line">                //定义一个数据源</span><br><span class="line">                var dataSource = new TableDataSource();</span><br><span class="line">                //此处为我们设置的命名空间</span><br><span class="line">                dataSource.workspaceId = &quot;my&quot;;</span><br><span class="line">                //命名空间下面的shp</span><br><span class="line">                dataSource.dataSourceName = &quot;lunkuoxian.shp&quot;;</span><br><span class="line">                //定义一个图层数据源</span><br><span class="line">                var layerSource = new LayerDataSource();</span><br><span class="line">                //给图层数据源赋值</span><br><span class="line">                layerSource.dataSource = dataSource;</span><br><span class="line">                //定义一个要素图层:注意链接为动态图层的地址</span><br><span class="line">                var layer2 = new FeatureLayer(&quot;http://localhost:6080/arcgis/rest/services/Test/MyService/MapServer/dynamicLayer&quot;, &#123;</span><br><span class="line">                    mode: FeatureLayer.MODE_ONDEMAND,</span><br><span class="line">                    outFields: [&quot;*&quot;],</span><br><span class="line">                    source: layerSource</span><br><span class="line">                &#125;);</span><br><span class="line">                //定义线符号</span><br><span class="line">                var lineSymbol = new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new dojo.Color([255, 0, 0]), 3);</span><br><span class="line">                //定义渲染器</span><br><span class="line">                var renderer = new esri.renderer.SimpleRenderer(lineSymbol);</span><br><span class="line">                //定义渲染器</span><br><span class="line">                layer2.setRenderer(renderer);</span><br><span class="line">                layer2.refresh();</span><br><span class="line">                map.addLayer(layer2);</span><br><span class="line">                layer2.on(&quot;click&quot;, function(evt) &#123;</span><br><span class="line">                    //得到点击的graphics</span><br><span class="line">                    var graphic=evt.graphic;</span><br><span class="line">                    //得到该属性信息</span><br><span class="line">                    var attributes=graphic.attributes;</span><br><span class="line">                    //得到该属性信息转换成字符串</span><br><span class="line">                    var result=jsonUtil.stringify(attributes)</span><br><span class="line">                    //将结果弹出一下</span><br><span class="line">                    alert(result);</span><br><span class="line">                    //获得要素图层的主键名称</span><br><span class="line"></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">        &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;mapDiv&quot; style=&quot;height:600px;&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;button id=&quot;btn&quot;&gt;添加动态图层&lt;/button&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>运行结果:<br><img src="/2019/08/06/ArcGIS-API-for-JS18/11.png" alt="11.png"></p>
<h4 id="通过查询获得属性"><a href="#通过查询获得属性" class="headerlink" title="通过查询获得属性"></a>通过查询获得属性</h4><h5 id="代码实现-2"><a href="#代码实现-2" class="headerlink" title="代码实现"></a>代码实现</h5><p>定义一个按钮（用户获得属性）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button id=&quot;attr&quot;&gt;用户弹出属性&lt;/button&gt;</span><br></pre></td></tr></table></figure></p>
<p>给相应的按钮绑定事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">on(dom.byId(&quot;attr&quot;),&quot;click&quot;,function()&#123;</span><br><span class="line">                    //得到要素图层的主键属性</span><br><span class="line">                    var idProperty = layer2.objectIdField;</span><br><span class="line">                    //定义查询参数</span><br><span class="line">                    var query = new Query();</span><br><span class="line">                    //是否返回几何形状</span><br><span class="line">                    query.returnGeometry = false;</span><br><span class="line">                    //图层的主键名称（根据自己要求修改）</span><br><span class="line">                    query.objectIds = [247];</span><br><span class="line">                    //查询条件1=1意思是：只根据主键查询，忽略where子句</span><br><span class="line">                    query.where = &quot;1=1&quot;;</span><br><span class="line">                    //进行查询</span><br><span class="line">                    layer2.selectFeatures(query, FeatureLayer.SELECTION_NEW,function(result)&#123;</span><br><span class="line">                        //因为我们根据主键查询，一定只有一个元素</span><br><span class="line">                        var graphic=result[0];</span><br><span class="line">                        //获得属性</span><br><span class="line">                        var attributes=graphic.attributes;</span><br><span class="line">                        //得到该属性信息转换成字符串</span><br><span class="line">                        var result=jsonUtil.stringify(attributes)</span><br><span class="line">                        //将结果弹出一下</span><br><span class="line">                        alert(result);</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line">                &#125;)</span><br></pre></td></tr></table></figure></p>
<h5 id="全部代码-1"><a href="#全部代码-1" class="headerlink" title="全部代码"></a>全部代码</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head lang=&quot;en&quot;&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script  type=&quot;text/Javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">        require([&quot;esri/map&quot;,</span><br><span class="line">            &quot;dojo/dom&quot;,</span><br><span class="line">            &quot;dojo/on&quot;,</span><br><span class="line">            &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">            &quot;esri/layers/FeatureLayer&quot;,</span><br><span class="line">            &quot;esri/layers/TableDataSource&quot;,</span><br><span class="line">            &quot;esri/layers/LayerDataSource&quot;,</span><br><span class="line">            &quot;esri/renderers/SimpleRenderer&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleLineSymbol&quot;,&quot;dojo/json&quot;,&quot;esri/tasks/query&quot;,</span><br><span class="line">            &quot;dojo/domReady!&quot;], function (</span><br><span class="line">                Map,dom,on, ArcGISDynamicMapServiceLayer, FeatureLayer, TableDataSource, LayerDataSource, SimpleRenderer,SimpleLineSymbol,jsonUtil,Query) &#123;</span><br><span class="line">            var map = new Map(&quot;mapDiv&quot;);</span><br><span class="line">            var layer1 = new ArcGISDynamicMapServiceLayer(&quot;http://localhost:6080/arcgis/rest/services//Test/MyService/MapServer&quot;);</span><br><span class="line">            map.addLayer(layer1);</span><br><span class="line"></span><br><span class="line">            on(dom.byId(&quot;btn&quot;),&quot;click&quot;,function(e)&#123;</span><br><span class="line">                //定义一个数据源</span><br><span class="line">                var dataSource = new TableDataSource();</span><br><span class="line">                //此处为我们设置的命名空间</span><br><span class="line">                dataSource.workspaceId = &quot;my&quot;;</span><br><span class="line">                //命名空间下面的shp</span><br><span class="line">                dataSource.dataSourceName = &quot;lunkuoxian.shp&quot;;</span><br><span class="line">                //定义一个图层数据源</span><br><span class="line">                var layerSource = new LayerDataSource();</span><br><span class="line">                //给图层数据源赋值</span><br><span class="line">                layerSource.dataSource = dataSource;</span><br><span class="line">                //定义一个要素图层:注意链接为动态图层的地址</span><br><span class="line">                var layer2 = new FeatureLayer(&quot;http://localhost:6080/arcgis/rest/services/Test/MyService/MapServer/dynamicLayer&quot;, &#123;</span><br><span class="line">                    mode: FeatureLayer.MODE_ONDEMAND,</span><br><span class="line">                    outFields: [&quot;*&quot;],</span><br><span class="line">                    source: layerSource</span><br><span class="line">                &#125;);</span><br><span class="line">                //定义线符号</span><br><span class="line">                var lineSymbol = new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new dojo.Color([255, 0, 0]), 3);</span><br><span class="line">                //定义渲染器</span><br><span class="line">                var renderer = new esri.renderer.SimpleRenderer(lineSymbol);</span><br><span class="line">                //定义渲染器</span><br><span class="line">                layer2.setRenderer(renderer);</span><br><span class="line">                layer2.refresh();</span><br><span class="line">                map.addLayer(layer2);</span><br><span class="line">                on(dom.byId(&quot;attr&quot;),&quot;click&quot;,function()&#123;</span><br><span class="line">                    //得到要素图层的主键属性</span><br><span class="line">                    var idProperty = layer2.objectIdField;</span><br><span class="line">                    //定义查询参数</span><br><span class="line">                    var query = new Query();</span><br><span class="line">                    //是否返回几何形状</span><br><span class="line">                    query.returnGeometry = false;</span><br><span class="line">                    //图层的主键名称（根据自己要求修改）</span><br><span class="line">                    query.objectIds = [247];</span><br><span class="line">                    //查询条件1=1意思是：只根据主键查询，忽略where子句</span><br><span class="line">                    query.where = &quot;1=1&quot;;</span><br><span class="line">                    //进行查询</span><br><span class="line">                    layer2.selectFeatures(query, FeatureLayer.SELECTION_NEW,function(result)&#123;</span><br><span class="line">                        //因为我们根据主键查询，一定只有一个元素</span><br><span class="line">                        var graphic=result[0];</span><br><span class="line">                        //获得属性</span><br><span class="line">                        var attributes=graphic.attributes;</span><br><span class="line">                        //得到该属性信息转换成字符串</span><br><span class="line">                        var result=jsonUtil.stringify(attributes)</span><br><span class="line">                        //将结果弹出一下</span><br><span class="line">                        alert(result);</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">        &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;mapDiv&quot; style=&quot;height:600px;&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;button id=&quot;btn&quot;&gt;添加动态图层&lt;/button&gt;</span><br><span class="line">&lt;button id=&quot;attr&quot;&gt;用户弹出属性&lt;/button&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><h4 id="启用文件地理数据库三点不同"><a href="#启用文件地理数据库三点不同" class="headerlink" title="启用文件地理数据库三点不同"></a>启用文件地理数据库三点不同</h4><p>文件的目录<br><img src="/2019/08/06/ArcGIS-API-for-JS18/12.png" alt="12.png"><br>命名空间配置<br><img src="/2019/08/06/ArcGIS-API-for-JS18/13.png" alt="13.png"><br>注册文件夹配置<br><img src="/2019/08/06/ArcGIS-API-for-JS18/14.png" alt="14.png"><br>代码调用差别<br><img src="/2019/08/06/ArcGIS-API-for-JS18/15.png" alt="15.png"><br>注意：忽略了要素集的存在，即调用是lunkuoxian，而不是vector.lunkuoxian，调用的时候后面没有*.shp</p>

                
                <div class="readmore">
                    <a href="/2019/08/06/ArcGIS-API-for-JS18/">
                        阅读更多
                    </a>
                </div>
            </div>
        
            <div class="post-item">
                <h1>
                    <a href="/2019/08/06/ArcGIS-API-for-JS17/">
                        ArcGIS API For Javascript调用结果地图服务
                    </a>
                </h1>
                <div class="create">
                    <span>创建于</span>
                    
                        <time datetime="2019-08-06T08:07:59.000Z">
                            2019-08-06
                        </time>
                    
                    <ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/ArcGIS/">ArcGIS</a></li></ul>
                </div>
                
                    <p>结果地图服务也是GP服务的一种，当GP服务的结果返回栅格数据时，我们往往使用结果地图服务来对生成的栅格数据进行渲染，本实例是：克里金差值</p>
<h3 id="ArcGIS-API调用结果地图服务"><a href="#ArcGIS-API调用结果地图服务" class="headerlink" title="ArcGIS API调用结果地图服务"></a>ArcGIS API调用结果地图服务</h3><p>首先我们查看一下服务的定义：<br><img src="/2019/08/06/ArcGIS-API-for-JS17/01.png" alt="01.png"><br><img src="/2019/08/06/ArcGIS-API-for-JS17/02.png" alt="02.png"></p>
<p>####代码实现<br>在页面添加地图（略）<br>创建两个按钮（一个是画点，一个是进行插值运算）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;input id=&quot;Btn&quot; type=&quot;button&quot; value=&quot;画点&quot; /&gt;</span><br><span class="line">&lt;input id=&quot;king&quot; type=&quot;button&quot; value=&quot;插值分析&quot; /&gt;</span><br></pre></td></tr></table></figure></p>
<p>定义点集合对象<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//定义点集合</span><br><span class="line">var pointSet = new FeatureSet();</span><br><span class="line">//定义点符号</span><br><span class="line">var psymbol = new SimpleMarkerSymbol(SimpleMarkerSymbol.STYLE_CROSS, 12,</span><br><span class="line">new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID,</span><br><span class="line">new dojo.Color([255, 0, 0]), 2),</span><br><span class="line">new dojo.Color([0, 255, 0, 0.25]));</span><br></pre></td></tr></table></figure></p>
<p>给画点的按钮绑定事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//绑定画点的事件</span><br><span class="line">on(dom.byId(&quot;Btn&quot;),&quot;click&quot;,function(e)&#123;</span><br><span class="line">    //定义绘图工具</span><br><span class="line">            var toolBar = new Draw(MyMap, &#123; showTooltips: true &#125;);</span><br><span class="line">            //激活绘图工具</span><br><span class="line">            toolBar.activate(Draw.POINT);</span><br><span class="line">            //定义一个i，为了给graphic赋予属性，为差值做准备。</span><br><span class="line">            var i=20;</span><br><span class="line">            //给绘图工具绑定绘图完成事件</span><br><span class="line">            on(toolBar, &quot;draw-complete&quot;, function(result)&#123;</span><br><span class="line">                //保证每一次i的值都不一样，如果所有点的属性都一样，是不可以差值的。</span><br><span class="line">                i=i+40;</span><br><span class="line">                //获得几何形状</span><br><span class="line">                var geometry = result.geometry;</span><br><span class="line">                //给图形一个m属性，我们后面对m进行差值</span><br><span class="line">                var graphicpoint = new Graphic(geometry, psymbol,&#123;&quot;m&quot;:i&#125;);</span><br><span class="line">                pointSet.features.push(graphicpoint);   </span><br><span class="line">                MyMap.graphics.add(graphicpoint);</span><br><span class="line">            &#125;); </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>给插值按钮绑定事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//声明gp对象</span><br><span class="line">var gp;</span><br><span class="line">on(dom.byId(&quot;king&quot;),&quot;click&quot;,function(e)&#123;</span><br><span class="line">                    //定义gp服务对象</span><br><span class="line">                    gp= new Geoprocessor(&quot;http://localhost:6080/arcgis/rest/services/Test/myKing/GPServer/king&quot;);</span><br><span class="line">                    //定义GP服务参数对象</span><br><span class="line">                    var gpParams=&#123;&#125;;</span><br><span class="line">                    //添加点集合的字段信息</span><br><span class="line">                    pointSet.fields=[&#123;</span><br><span class="line">                    &quot;name&quot;:&quot;m&quot;,</span><br><span class="line">                    &quot;type&quot;:&quot;esriFieldTypeSmallInteger&quot;,</span><br><span class="line">                    &quot;alias&quot;:&quot;m&quot;</span><br><span class="line">                    &#125;];</span><br><span class="line">                    //添加Input参数</span><br><span class="line">                    gpParams.Input=pointSet;</span><br><span class="line">                    //添加Z属性：即差值的属性</span><br><span class="line">                    gpParams.Z=&quot;m&quot;;</span><br><span class="line">                    gp.submitJob(gpParams,completeCallback);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>回掉函数处理结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function completeCallback(jobInfo)</span><br><span class="line">                &#123;</span><br><span class="line">                    gp.on(&quot;get-result-image-layer-complete&quot;,function(gpLayer)&#123;</span><br><span class="line">                        MyMap.addLayer(gpLayer[&quot;layer&quot;])</span><br><span class="line">                    &#125;)</span><br><span class="line">                    gp.getResultImageLayer(jobInfo.jobId,&quot;out&quot;);</span><br><span class="line">                    </span><br><span class="line">                    </span><br><span class="line">                    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="全部代码"><a href="#全部代码" class="headerlink" title="全部代码"></a>全部代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;/&gt;</span><br><span class="line">    &lt;title&gt;GP&lt;/title&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script  type=&quot;text/Javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">        .MapClass&#123;</span><br><span class="line">            width:100%;</span><br><span class="line">            height:600px;</span><br><span class="line">            border:1px solid #000;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;</span><br><span class="line"></span><br><span class="line">        require([&quot;esri/map&quot;,</span><br><span class="line">            &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">            &quot;dojo/dom&quot;,</span><br><span class="line">            &quot;esri/tasks/Geoprocessor&quot;,</span><br><span class="line">            &quot;esri/tasks/FeatureSet&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleMarkerSymbol&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleLineSymbol&quot;,</span><br><span class="line">            &quot;esri/toolbars/draw&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleFillSymbol&quot;,</span><br><span class="line">             &quot;dojo/on&quot;,&quot;esri/graphic&quot;,</span><br><span class="line">            &quot;esri/layers/ImageParameters&quot;,</span><br><span class="line">            &quot;dojo/domReady!&quot;],</span><br><span class="line">            function (Map,</span><br><span class="line">                ArcGISDynamicMapServiceLayer,</span><br><span class="line">                dom,</span><br><span class="line">                Geoprocessor,</span><br><span class="line">                FeatureSet,</span><br><span class="line">                SimpleMarkerSymbol,</span><br><span class="line">                SimpleLineSymbol,</span><br><span class="line">                Draw,</span><br><span class="line">                SimpleFillSymbol,on,Graphic,ImageParameters) &#123;</span><br><span class="line">                var MyMap = new Map(&quot;MyMapDiv&quot;);</span><br><span class="line">                var layer = new ArcGISDynamicMapServiceLayer</span><br><span class="line">                (&quot;http://localhost:6080/arcgis/rest/services/Test/ft/MapServer&quot;);</span><br><span class="line">                MyMap.addLayer(layer)               </span><br><span class="line">                </span><br><span class="line">                //定义点集合对象</span><br><span class="line">                var pointSet = new FeatureSet();</span><br><span class="line">                //定义点符号</span><br><span class="line">                var psymbol = new SimpleMarkerSymbol(SimpleMarkerSymbol.STYLE_CROSS, 12,</span><br><span class="line">                new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID,</span><br><span class="line">                new dojo.Color([255, 0, 0]), 2),</span><br><span class="line">                new dojo.Color([0, 255, 0, 0.25]));</span><br><span class="line">                //绑定画点的事件</span><br><span class="line">                on(dom.byId(&quot;Btn&quot;),&quot;click&quot;,function(e)&#123;</span><br><span class="line">                    //定义绘图工具</span><br><span class="line">                    var toolBar = new Draw(MyMap, &#123; showTooltips: true &#125;);</span><br><span class="line">                    //激活绘图工具</span><br><span class="line">                    toolBar.activate(Draw.POINT);</span><br><span class="line">                    //定义一个i，为了给graphic赋予属性，为差值做准备。</span><br><span class="line">                    var i=20;</span><br><span class="line">                    //给绘图工具绑定绘图完成事件</span><br><span class="line">                    on(toolBar, &quot;draw-complete&quot;, function(result)&#123;</span><br><span class="line">                        //保证每一次i的值都不一样，如果所有点的属性都一样，是不可以差值的。</span><br><span class="line">                        i=i+40;</span><br><span class="line">                        //获得几何形状</span><br><span class="line">                        var geometry = result.geometry;</span><br><span class="line">                        //给图形一个m属性，我们后面对m进行差值</span><br><span class="line">                        var graphicpoint = new Graphic(geometry, psymbol,&#123;&quot;m&quot;:i&#125;);</span><br><span class="line">                        pointSet.features.push(graphicpoint);   </span><br><span class="line">                        MyMap.graphics.add(graphicpoint);</span><br><span class="line">                    &#125;); </span><br><span class="line">                &#125;);</span><br><span class="line">                var gp;</span><br><span class="line">                on(dom.byId(&quot;king&quot;),&quot;click&quot;,function(e)&#123;</span><br><span class="line">                    //定义gp服务对象</span><br><span class="line">                    gp= new Geoprocessor(&quot;http://localhost:6080/arcgis/rest/services/Test/myKing/GPServer/king&quot;);</span><br><span class="line">                    //定义GP服务参数对象</span><br><span class="line">                    var gpParams=&#123;&#125;;</span><br><span class="line">                    //添加点集合的字段信息</span><br><span class="line">                    pointSet.fields=[&#123;</span><br><span class="line">                    &quot;name&quot;:&quot;m&quot;,</span><br><span class="line">                    &quot;type&quot;:&quot;esriFieldTypeSmallInteger&quot;,</span><br><span class="line">                    &quot;alias&quot;:&quot;m&quot;</span><br><span class="line">                    &#125;];</span><br><span class="line">                    //添加Input参数</span><br><span class="line">                    gpParams.Input=pointSet;</span><br><span class="line">                    //添加Z属性：即差值的属性</span><br><span class="line">                    gpParams.Z=&quot;m&quot;;</span><br><span class="line">                    //执行gp服务，注意这里是执行submitJob，因为是同步的gp服务</span><br><span class="line">                    gp.submitJob(gpParams,completeCallback);</span><br><span class="line">                &#125;)          </span><br><span class="line">                function completeCallback(jobInfo)</span><br><span class="line">                &#123;</span><br><span class="line">                    //给gp服务绑定获得图层事件</span><br><span class="line">                    gp.on(&quot;get-result-image-layer-complete&quot;,function(gpLayer)&#123;</span><br><span class="line">                        //将图层添加到地图中</span><br><span class="line">                        MyMap.addLayer(gpLayer[&quot;layer&quot;])</span><br><span class="line">                    &#125;)</span><br><span class="line">                    //注意out是服务定义的参数</span><br><span class="line">                    gp.getResultImageLayer(jobInfo.jobId,&quot;out&quot;);</span><br><span class="line">                                                           </span><br><span class="line">                &#125;   </span><br><span class="line"></span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=&quot;MyMapDiv&quot; class=&quot;MapClass&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;input id=&quot;Btn&quot; type=&quot;button&quot; value=&quot;画点&quot; /&gt;</span><br><span class="line">    &lt;input id=&quot;king&quot; type=&quot;button&quot; value=&quot;插值分析&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/2019/08/06/ArcGIS-API-for-JS17/03.png" alt="03.png"></p>

                
                <div class="readmore">
                    <a href="/2019/08/06/ArcGIS-API-for-JS17/">
                        阅读更多
                    </a>
                </div>
            </div>
        
            <div class="post-item">
                <h1>
                    <a href="/2019/08/06/ArcGIS-API-for-JS16/">
                        ArcGIS API For Javascript调用GP服务
                    </a>
                </h1>
                <div class="create">
                    <span>创建于</span>
                    
                        <time datetime="2019-08-06T07:59:51.000Z">
                            2019-08-06
                        </time>
                    
                    <ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/ArcGIS/">ArcGIS</a></li></ul>
                </div>
                
                    <p>ArcGIS API中关于GP服务的调用是比较容易出错的，出错的大部分原因便是Web API调用GP服务的时候参数不对应导致的</p>
<h3 id="ArcGIS-API调用GP服务"><a href="#ArcGIS-API调用GP服务" class="headerlink" title="ArcGIS API调用GP服务"></a>ArcGIS API调用GP服务</h3><p><img src="/2019/08/06/ArcGIS-API-for-JS16/01.png" alt="01.png"><br>然后接下来我们将在Web中调用我们的GP服务</p>
<h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><p>在页面加入地图（略）<br>在页面添加两个按钮（第一个按钮用于画点，第二个按钮用于缓冲区分析）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;input id=&quot;Btn&quot; type=&quot;button&quot; value=&quot;画点&quot; /&gt;</span><br><span class="line">&lt;input id=&quot;buffer&quot; type=&quot;button&quot; value=&quot;缓冲区分析&quot; /&gt;</span><br></pre></td></tr></table></figure></p>
<p>定义一个点几何对象（与服务定义的类型对应）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//定义点几何对象</span><br><span class="line">var pointSet = new FeatureSet();</span><br></pre></td></tr></table></figure></p>
<p>定义点符号对象<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var psymbol = new SimpleMarkerSymbol(SimpleMarkerSymbol.STYLE_CROSS, 12,</span><br><span class="line">new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID,</span><br><span class="line">new dojo.Color([255, 0, 0]), 2),</span><br><span class="line">new dojo.Color([0, 255, 0, 0.25]));</span><br></pre></td></tr></table></figure></p>
<p>给画点按钮绑定点击事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">on(dom.byId(&quot;Btn&quot;),&quot;click&quot;,function(e)&#123;</span><br><span class="line">                    //定义绘图对象</span><br><span class="line">                    var toolBar= new Draw(MyMap, &#123; showTooltips: true &#125;);</span><br><span class="line">                    //激活绘图对象</span><br><span class="line">                    toolBar.activate(Draw.POINT);</span><br><span class="line">                    on(toolBar, &quot;draw-complete&quot;, function(result)&#123;</span><br><span class="line">                        //获得绘图结束的点对象</span><br><span class="line">                        var geometry = result.geometry;</span><br><span class="line">                        //根据点对象生成相应的图形</span><br><span class="line">                        var graphic = new Graphic(geometry, psymbol);</span><br><span class="line">                        //将点对象存储在点几何中</span><br><span class="line">                        pointSet.features.push(graphic);</span><br><span class="line">                        //将图形存放在地图中，然后得以显示</span><br><span class="line">                        MyMap.graphics.add(graphic);</span><br><span class="line"></span><br><span class="line">                    &#125;); </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>给缓冲区分析按钮添加绑定事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">on(dom.byId(&quot;buffer&quot;),&quot;click&quot;,function(e)&#123;</span><br><span class="line">                    //定义GP服务对象</span><br><span class="line">                    var buffer = new Geoprocessor(&quot;http://localhost:6080/arcgis/rest/services/Test/MyBuffer/GPServer/Mybuffer&quot;);</span><br><span class="line">                    //构建GP服务参数</span><br><span class="line">                    var gpParams=&#123;&#125;;</span><br><span class="line">                    //GP服务的Input参数</span><br><span class="line">                    gpParams.Input=pointSet;</span><br><span class="line">                    //GP服务的dis参数</span><br><span class="line">                    var dis=new LinearUnit(&#123;</span><br><span class="line">                        &quot;distance&quot;: 100,</span><br><span class="line">                        &quot;units&quot;: &quot;esriMeters&quot;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    gpParams.dis=dis;</span><br><span class="line">                    //执行GP服务</span><br><span class="line">                    buffer.execute(gpParams, showResult);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>处理GP服务返回的结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function showResult(results, messages)&#123;</span><br><span class="line">                    var features = results[0].value.features;</span><br><span class="line">                    for (var i = 0; i &lt; features.length; i++) &#123;</span><br><span class="line">                        var graphic = features[i];</span><br><span class="line">                        //定义线符号</span><br><span class="line">                        var lineSymbol=new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASHDOT, new dojo.Color([255, 0, 0]), 1);</span><br><span class="line">                        //定义面符号</span><br><span class="line">                        var PolygonSymbol = new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol, new dojo.Color([255, 255, 0, 0.25]));</span><br><span class="line">                        //设置面符号</span><br><span class="line">                        graphic.setSymbol(PolygonSymbol);</span><br><span class="line">                        MyMap.graphics.add(graphic);</span><br><span class="line">                    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p>运行代码发现错误<br><img src="/2019/08/06/ArcGIS-API-for-JS16/02.png" alt="02.png"><br>此时我们观察前台传给后台的参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Input:&#123;</span><br><span class="line">            &quot;geometryType&quot;:&quot;esriGeometryPoint&quot;,</span><br><span class="line">            &quot;features&quot;:[&#123;&quot;geometry&quot;:&#123;&quot;x&quot;:21264961.8441914,&quot;y&quot;:3997922.462940743,&quot;spatialReference&quot;:&#123;&quot;wkid&quot;:2334,&quot;latestWkid&quot;:2334&#125;&#125;&#125;],</span><br><span class="line">            &quot;sr&quot;:&#123;&quot;wkid&quot;:2334,&quot;latestWkid&quot;:2334&#125;</span><br><span class="line">    &#125;</span><br><span class="line">dis: &#123;&quot;distance&quot;:100,&quot;units&quot;:&quot;esriMeters&quot;&#125;</span><br></pre></td></tr></table></figure></p>
<p>传给后台的参数和GP服务的参数对比，发现Input参数，缺少fields字段：<br><img src="/2019/08/06/ArcGIS-API-for-JS16/03.png" alt="03.png"><br>修改错误<br>我们给运行GP服务之前给Input参数添加上Fields字段:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">on(dom.byId(&quot;buffer&quot;),&quot;click&quot;,function(e)&#123;</span><br><span class="line">                    //定义GP服务对象</span><br><span class="line">                    var buffer = new Geoprocessor(&quot;http://localhost:6080/arcgis/rest/services/Test/MyBuffer/GPServer/Mybuffer&quot;);</span><br><span class="line">                    //构建GP服务参数</span><br><span class="line">                    var gpParams=&#123;&#125;;</span><br><span class="line">                    //添加fields字段，为了和后台服务字段匹配</span><br><span class="line">                    pointSet.fields=[];</span><br><span class="line">                    //GP服务的Input参数</span><br><span class="line">                    gpParams.Input=pointSet;</span><br><span class="line">                    //GP服务的dis参数</span><br><span class="line">                    var dis=new LinearUnit(&#123;</span><br><span class="line">                        &quot;distance&quot;: 100,</span><br><span class="line">                        &quot;units&quot;: &quot;esriMeters&quot;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    gpParams.dis=dis;</span><br><span class="line">                    //执行GP服务</span><br><span class="line">                    buffer.execute(gpParams, showResult);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h4 id="全部代码"><a href="#全部代码" class="headerlink" title="全部代码"></a>全部代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;/&gt;</span><br><span class="line">    &lt;title&gt;GP&lt;/title&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script  type=&quot;text/Javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">        .MapClass&#123;</span><br><span class="line">            width:100%;</span><br><span class="line">            height:600px;</span><br><span class="line">            border:1px solid #000;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;</span><br><span class="line"></span><br><span class="line">        require([&quot;esri/map&quot;,</span><br><span class="line">            &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">            &quot;dojo/dom&quot;,</span><br><span class="line">            &quot;esri/tasks/Geoprocessor&quot;,</span><br><span class="line">            &quot;esri/tasks/FeatureSet&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleMarkerSymbol&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleLineSymbol&quot;,</span><br><span class="line">            &quot;esri/toolbars/draw&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleFillSymbol&quot;,</span><br><span class="line">            &quot;dojo/on&quot;,&quot;esri/graphic&quot;,</span><br><span class="line">            &quot;esri/tasks/LinearUnit&quot;,</span><br><span class="line">            &quot;dojo/domReady!&quot;],</span><br><span class="line">            function (Map,</span><br><span class="line">                ArcGISDynamicMapServiceLayer,</span><br><span class="line">                dom,</span><br><span class="line">                Geoprocessor,</span><br><span class="line">                FeatureSet,</span><br><span class="line">                SimpleMarkerSymbol,</span><br><span class="line">                SimpleLineSymbol,</span><br><span class="line">                Draw,</span><br><span class="line">                SimpleFillSymbol,on,Graphic,LinearUnit) &#123;</span><br><span class="line">                var MyMap = new Map(&quot;MyMapDiv&quot;);</span><br><span class="line">                </span><br><span class="line">                var layer = new ArcGISDynamicMapServiceLayer</span><br><span class="line">                (&quot;http://localhost:6080/arcgis/rest/services/Test/ft/MapServer&quot;);</span><br><span class="line">                MyMap.addLayer(layer);</span><br><span class="line">                //定义点几何对象</span><br><span class="line">                var pointSet = new FeatureSet();</span><br><span class="line">                var psymbol = new SimpleMarkerSymbol(SimpleMarkerSymbol.STYLE_CROSS, 12,</span><br><span class="line">                new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID,</span><br><span class="line">                new dojo.Color([255, 0, 0]), 2),</span><br><span class="line">                new dojo.Color([0, 255, 0, 0.25]));</span><br><span class="line">                on(dom.byId(&quot;Btn&quot;),&quot;click&quot;,function(e)&#123;</span><br><span class="line">                    //定义绘图对象</span><br><span class="line">                    var toolBar= new Draw(MyMap, &#123; showTooltips: true &#125;);</span><br><span class="line">                    //激活绘图对象</span><br><span class="line">                    toolBar.activate(Draw.POINT);</span><br><span class="line">                    on(toolBar, &quot;draw-complete&quot;, function(result)&#123;</span><br><span class="line">                        //获得绘图结束的点对象</span><br><span class="line">                        var geometry = result.geometry;</span><br><span class="line">                        //根据点对象生成相应的图形</span><br><span class="line">                        var graphic = new Graphic(geometry,psymbol);</span><br><span class="line">                        //将点对象存储在点几何中</span><br><span class="line">                        pointSet.features.push(graphic);</span><br><span class="line">                        //将图形存放在地图中，然后得以显示</span><br><span class="line">                        MyMap.graphics.add(graphic);</span><br><span class="line"></span><br><span class="line">                    &#125;); </span><br><span class="line">                &#125;);</span><br><span class="line">                </span><br><span class="line">                on(dom.byId(&quot;buffer&quot;),&quot;click&quot;,function(e)&#123;</span><br><span class="line">                    //定义GP服务对象</span><br><span class="line">                    var buffer = new Geoprocessor(&quot;http://localhost:6080/arcgis/rest/services/Test/MyBuffer/GPServer/Mybuffer&quot;);</span><br><span class="line">                    //构建GP服务参数</span><br><span class="line">                    var gpParams=&#123;&#125;;</span><br><span class="line">                    //添加fields字段，为了和后台服务字段匹配</span><br><span class="line">                    pointSet.fields=[];</span><br><span class="line">                    //GP服务的Input参数</span><br><span class="line">                    gpParams.Input=pointSet;</span><br><span class="line">                    //GP服务的dis参数</span><br><span class="line">                    var dis=new LinearUnit(&#123;</span><br><span class="line">                        &quot;distance&quot;: 100,</span><br><span class="line">                        &quot;units&quot;: &quot;esriMeters&quot;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    gpParams.dis=dis;</span><br><span class="line">                    //执行GP服务</span><br><span class="line">                    buffer.execute(gpParams, showResult);</span><br><span class="line">                &#125;);</span><br><span class="line">                function showResult(results, messages)</span><br><span class="line">                &#123;</span><br><span class="line">                    var features = results[0].value.features;</span><br><span class="line">                    for (var i = 0; i &lt; features.length; i++) &#123;</span><br><span class="line">                        var graphic = features[i];</span><br><span class="line">                        //定义线符号</span><br><span class="line">                        var lineSymbol=new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASHDOT, new dojo.Color([255, 0, 0]), 1);</span><br><span class="line">                        //定义面符号</span><br><span class="line">                        var PolygonSymbol = new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol, new dojo.Color([255, 255, 0, 0.25]));</span><br><span class="line">                        //设置面符号</span><br><span class="line">                        graphic.setSymbol(PolygonSymbol);</span><br><span class="line">                        MyMap.graphics.add(graphic);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=&quot;MyMapDiv&quot; class=&quot;MapClass&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;input id=&quot;Btn&quot; type=&quot;button&quot; value=&quot;画点&quot; /&gt;</span><br><span class="line">    &lt;input id=&quot;buffer&quot; type=&quot;button&quot; value=&quot;缓冲区分析&quot; /&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/2019/08/06/ArcGIS-API-for-JS16/04.png" alt="04.png"></p>

                
                <div class="readmore">
                    <a href="/2019/08/06/ArcGIS-API-for-JS16/">
                        阅读更多
                    </a>
                </div>
            </div>
        
            <div class="post-item">
                <h1>
                    <a href="/2019/08/06/ArcGIS-API-for-JS15/">
                        ArcGIS API For Javascript之渲染实现
                    </a>
                </h1>
                <div class="create">
                    <span>创建于</span>
                    
                        <time datetime="2019-08-06T07:43:25.000Z">
                            2019-08-06
                        </time>
                    
                    <ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/ArcGIS/">ArcGIS</a></li></ul>
                </div>
                
                    <p>在 GIS当中，总要时不时的制作几张专题图，制作专题图的过程中，不可避免的就要涉及到图层的渲染问题（即改变图层的颜色信息），渲染分为客户端渲染，服务器渲染，客户端渲染要求我们的服务必须是要素服务，或者是可以使用FeatureLayer接收的服务图层</p>
<h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>首先我们查看一下数据（宿舍楼信息）<br><img src="/2019/08/06/ArcGIS-API-for-JS15/01.png" alt="01.png"></p>
<h4 id="需求一（唯一值渲染）"><a href="#需求一（唯一值渲染）" class="headerlink" title="需求一（唯一值渲染）"></a>需求一（唯一值渲染）</h4><p>根据alias属性进行唯一值渲染</p>
<h5 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h5><p>首先我们先将地图加载进来<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var map = new esri.Map(&quot;MyMapDiv&quot;);</span><br><span class="line">var layer = new ArcGISDynamicMapServiceLayer(&quot;http://localhost:6080/arcgis/rest/services/my/fea/MapServer&quot;);</span><br><span class="line">map.addLayer(layer);</span><br></pre></td></tr></table></figure></p>
<p>定义一个渲染按钮<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button id=&quot;btn&quot;&gt;渲染&lt;/button&gt;</span><br></pre></td></tr></table></figure></p>
<p>给按钮绑定相应的事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">on(btn,&quot;click&quot;,function()&#123;</span><br><span class="line">                        //定义一个要素图层</span><br><span class="line">                        var featureLayer = new FeatureLayer(</span><br><span class="line">                        &quot;http://localhost:6080/arcgis/rest/services/Test/ft/MapServer/1&quot;,</span><br><span class="line">                         &#123;</span><br><span class="line">                            mode:FeatureLayer.MODE_SNAPSHOT,</span><br><span class="line">                            outFields: [&quot;*&quot;]</span><br><span class="line">                         &#125;);</span><br><span class="line">                        //定义线符号</span><br><span class="line">                        var lineSymbol=new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new Color([255, 0, 0]), 3);</span><br><span class="line">                        //定义面符号</span><br><span class="line">                        var fill=new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol,new Color(&quot;#FFFFCC&quot;));</span><br><span class="line">                        //定义唯一值渲染器，对字段alias进行渲染，fill是默认的渲染符号</span><br><span class="line">                        var renderer = new UniqueValueRenderer(fill, &quot;alias&quot;);</span><br><span class="line">                        //设置渲染的方式</span><br><span class="line">                        renderer.addValue(&quot;C区宿舍&quot;, new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol,new Color([0, 255, 0, 0.5])));</span><br><span class="line">                        renderer.addValue(&quot;B区宿舍&quot;, new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol,new Color([0, 0, 255, 0.5])));</span><br><span class="line">                        renderer.addValue(&quot;A区宿舍&quot;,new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol,new Color([255, 0, 255, 0.5])));</span><br><span class="line">                        renderer.addValue(&quot;公共出口&quot;, new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol,new Color([255, 255, 255, 0.75])));</span><br><span class="line">                        featureLayer.setRenderer(renderer);</span><br><span class="line">                        map.addLayer(featureLayer);              </span><br><span class="line">                    &#125;)</span><br></pre></td></tr></table></figure></p>
<h5 id="全部代码"><a href="#全部代码" class="headerlink" title="全部代码"></a>全部代码</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;/&gt;</span><br><span class="line">    &lt;title&gt;UniqueValueRenderer&lt;/title&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script  type=&quot;text/Javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">        .MapClass&#123;</span><br><span class="line">            width:100%;</span><br><span class="line">            height:600px;</span><br><span class="line">            border:1px solid #000;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line"></span><br><span class="line">        require([&quot;esri/map&quot;,</span><br><span class="line">                    &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">                    &quot;dojo/on&quot;,</span><br><span class="line">                    &quot;dojo/dom&quot;,</span><br><span class="line">                    &quot;dojo/colors&quot;,</span><br><span class="line">                    &quot;esri/symbols/SimpleFillSymbol&quot;,</span><br><span class="line">                    &quot;esri/layers/FeatureLayer&quot;,</span><br><span class="line">                    &quot;esri/symbols/SimpleLineSymbol&quot;,</span><br><span class="line">                    &quot;esri/renderers/UniqueValueRenderer&quot;,</span><br><span class="line">                    &quot;dojo/domReady!&quot;],</span><br><span class="line">                function (Map, ArcGISDynamicMapServiceLayer,on,dom,Color,SimpleFillSymbol, FeatureLayer, SimpleLineSymbol,UniqueValueRenderer) &#123;</span><br><span class="line">                    var map = new esri.Map(&quot;MyMapDiv&quot;);</span><br><span class="line">                    var layer = new ArcGISDynamicMapServiceLayer(&quot;http://localhost:6080/arcgis/rest/services/Test/ft/MapServer&quot;);</span><br><span class="line">                    map.addLayer(layer);</span><br><span class="line">                    //获得id为btn的DOM元素</span><br><span class="line">                    var btn=dom.byId(&quot;btn&quot;);</span><br><span class="line">                    //绑定相应的事件</span><br><span class="line">                    on(btn,&quot;click&quot;,function()&#123;</span><br><span class="line">                        //定义一个要素图层</span><br><span class="line">                        var featureLayer = new FeatureLayer(</span><br><span class="line">                        &quot;http://localhost:6080/arcgis/rest/services/Test/ft/MapServer/1&quot;,</span><br><span class="line">                         &#123;</span><br><span class="line">                            mode:FeatureLayer.MODE_SNAPSHOT,</span><br><span class="line">                            outFields: [&quot;*&quot;]</span><br><span class="line">                         &#125;);</span><br><span class="line">                        //定义线符号</span><br><span class="line">                        var lineSymbol=new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new Color([255, 0, 0]), 3);</span><br><span class="line">                        //定义面符号</span><br><span class="line">                        var fill=new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol,new Color(&quot;#FFFFCC&quot;));</span><br><span class="line">                        //定义唯一值渲染器，对字段alias进行渲染，fill是默认的渲染符号</span><br><span class="line">                        var renderer = new UniqueValueRenderer(fill, &quot;alias&quot;);</span><br><span class="line">                        //设置渲染的方式</span><br><span class="line">                        renderer.addValue(&quot;C区宿舍&quot;, new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol,new Color([0, 255, 0, 0.5])));</span><br><span class="line">                        renderer.addValue(&quot;B区宿舍&quot;, new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol,new Color([0, 0, 255, 0.5])));</span><br><span class="line">                        renderer.addValue(&quot;A区宿舍&quot;,new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol,new Color([255, 0, 255, 0.5])));</span><br><span class="line">                        renderer.addValue(&quot;公共出口&quot;, new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol,new Color([255, 255, 255, 0.75])));</span><br><span class="line">                        featureLayer.setRenderer(renderer);</span><br><span class="line">                        map.addLayer(featureLayer);              </span><br><span class="line">                    &#125;)  </span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;MyMapDiv&quot; class=&quot;MapClass&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;button id=&quot;btn&quot;&gt;渲染&lt;/button&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>运行结果之后：<br><img src="/2019/08/06/ArcGIS-API-for-JS15/02.png" alt="02.png"></p>
<h4 id="需求二（分类渲染）"><a href="#需求二（分类渲染）" class="headerlink" title="需求二（分类渲染）"></a>需求二（分类渲染）</h4><p>根据面积字段实现分类渲染，由于代码只是修改了渲染器，所以直接将代码贴出来</p>
<h5 id="全部代码-1"><a href="#全部代码-1" class="headerlink" title="全部代码"></a>全部代码</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;/&gt;</span><br><span class="line">    &lt;title&gt;UniqueValueRenderer&lt;/title&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script  type=&quot;text/Javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">        .MapClass&#123;</span><br><span class="line">            width:100%;</span><br><span class="line">            height:600px;</span><br><span class="line">            border:1px solid #000;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line"></span><br><span class="line">        require([&quot;esri/map&quot;,</span><br><span class="line">                    &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">                    &quot;dojo/on&quot;,</span><br><span class="line">                    &quot;dojo/dom&quot;,</span><br><span class="line">                    &quot;dojo/colors&quot;,</span><br><span class="line">                    &quot;esri/symbols/SimpleFillSymbol&quot;,</span><br><span class="line">                    &quot;esri/layers/FeatureLayer&quot;,</span><br><span class="line">                    &quot;esri/symbols/SimpleLineSymbol&quot;,</span><br><span class="line">                    &quot;esri/renderers/ClassBreaksRenderer&quot;,</span><br><span class="line">                    &quot;dojo/domReady!&quot;],</span><br><span class="line">                function (Map, ArcGISDynamicMapServiceLayer,on,dom,Color,SimpleFillSymbol, FeatureLayer, SimpleLineSymbol,ClassBreaksRenderer) &#123;</span><br><span class="line">                    var map = new esri.Map(&quot;MyMapDiv&quot;);</span><br><span class="line">                    var layer = new ArcGISDynamicMapServiceLayer(&quot;http://localhost:6080/arcgis/rest/services/Test/ft/MapServer&quot;);</span><br><span class="line">                    map.addLayer(layer);</span><br><span class="line">                    //获得id为btn的DOM元素</span><br><span class="line">                    var btn=dom.byId(&quot;btn&quot;);</span><br><span class="line">                    //绑定相应的事件</span><br><span class="line">                    on(btn,&quot;click&quot;,function()&#123;</span><br><span class="line">                        //定义一个要素图层</span><br><span class="line">                        var featureLayer = new FeatureLayer(</span><br><span class="line">                        &quot;http://localhost:6080/arcgis/rest/services/Test/ft/MapServer/1&quot;,</span><br><span class="line">                         &#123;</span><br><span class="line">                            mode:FeatureLayer.MODE_SNAPSHOT,</span><br><span class="line">                            outFields: [&quot;*&quot;]</span><br><span class="line">                         &#125;);</span><br><span class="line">                        //定义线符号</span><br><span class="line">                        var lineSymbol=new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new Color([255, 0, 0]), 3);</span><br><span class="line">                        //定义面符号</span><br><span class="line">                        var fill=new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol,new Color(&quot;#FFFFCC&quot;));</span><br><span class="line">                        //定义唯一值渲染器，对字段alias进行渲染，fill是默认的渲染符号</span><br><span class="line">                        var renderer = new ClassBreaksRenderer(fill, &quot;OBJECTID&quot;);</span><br><span class="line">                        //设置渲染间隔</span><br><span class="line">                        renderer.addBreak(0,20, new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol,new Color([0, 255, 0, 0.5])));</span><br><span class="line">                        renderer.addBreak(20,30, new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol,new Color([0, 0, 255, 0.5])));</span><br><span class="line">                        renderer.addBreak(30,40,new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol,new Color([255, 0, 255, 0.5])));</span><br><span class="line">                        renderer.addBreak(40,60, new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol,new Color([255, 255, 255, 0.75])));</span><br><span class="line">                        featureLayer.setRenderer(renderer);</span><br><span class="line">                        map.addLayer(featureLayer);              </span><br><span class="line">                    &#125;)  </span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;MyMapDiv&quot; class=&quot;MapClass&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;button id=&quot;btn&quot;&gt;渲染&lt;/button&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>运行结果后：<br><img src="/2019/08/06/ArcGIS-API-for-JS15/03.png" alt="03.png"></p>
<h4 id="需求三（服务器渲染）"><a href="#需求三（服务器渲染）" class="headerlink" title="需求三（服务器渲染）"></a>需求三（服务器渲染）</h4><p>当数据量过大时，客户端渲染变显得有些慢了，此时可以使用服务器渲染，服务器渲染提供了两种渲染的方式：唯一值渲染，分类渲染，在此处我们用到的为分类渲染。</p>
<p>注意：服务器渲染不需要要素服务。</p>
<p>创建一个按钮（用于触发服务器渲染）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;button&quot; id=&quot;Btn&quot; value=&quot;服务器渲染&quot; /&gt;</span><br></pre></td></tr></table></figure></p>
<p>给按钮绑定点击事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">on(btn,&quot;click&quot;,function(e)&#123;</span><br><span class="line">                //定义线符号</span><br><span class="line">                var lineSymbol=new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new dojo.Color([255, 0, 0]), 3);</span><br><span class="line">                //定义面符号</span><br><span class="line">                var fill=new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol,new dojo.Color(&quot;#FFFFCC&quot;));</span><br><span class="line">                //创建服务器渲染对象</span><br><span class="line">                var RenderAnalyst = new GenerateRendererTask(&quot;http://localhost:6080/arcgis/rest/services/Test/ft/MapServer/1&quot;);</span><br><span class="line">                //创建服务器渲染参数对象</span><br><span class="line">                var params = new GenerateRendererParameters();   </span><br><span class="line">                //创建颜色坡道对象</span><br><span class="line">                var colorRamp = new AlgorithmicColorRamp();</span><br><span class="line">                //颜色的起始位置</span><br><span class="line">                colorRamp.fromColor = dojo.colorFromHex(&quot;#998ec3&quot;);</span><br><span class="line">                //颜色的终止位置</span><br><span class="line">                colorRamp.toColor = dojo.colorFromHex(&quot;#f1a340&quot;);</span><br><span class="line">                //颜色的类型</span><br><span class="line">                colorRamp.algorithm = &quot;hsv&quot;;</span><br><span class="line">                //告诉服务器我们需要什么样子的渲染器</span><br><span class="line">                var unidef = new ClassBreaksDefinition();</span><br><span class="line">                //分类的字段</span><br><span class="line">                unidef.classificationField = &quot;Shape.STArea()&quot;;</span><br><span class="line">                //如何分类</span><br><span class="line">                unidef.classificationMethod=&quot;natural-breaks&quot;;</span><br><span class="line">                //分为几类？</span><br><span class="line">                unidef.breakCount = 3;</span><br><span class="line">                //默认的符号</span><br><span class="line">                unidef.baseSymbol=fill;</span><br><span class="line">                //将自定义的颜色坡道告诉服务器</span><br><span class="line">                unidef.colorRamp=colorRamp;</span><br><span class="line">                //给渲染参数对象赋值</span><br><span class="line">                params.classificationDefinition = unidef;</span><br><span class="line">                //进行服务器渲染</span><br><span class="line">                RenderAnalyst.execute(params, showRender);</span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line">            &#125;);</span><br></pre></td></tr></table></figure></p>
<p>处理服务器返回的结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//处理服务器返回来的结果</span><br><span class="line">            function showRender(renderer) &#123;</span><br><span class="line">                </span><br><span class="line">                if (renderer != null) &#123;</span><br><span class="line">                    //定义要素图层，注意：这个地方我们用到并不是要素服务，而是地图服务</span><br><span class="line">                    var featureLayer = new FeatureLayer(&quot;http://localhost:6080/arcgis/rest/services/Test/ft/MapServer/1&quot;,&#123;</span><br><span class="line">                        mode:  FeatureLayer.MODE_SNAPSHOT,</span><br><span class="line">                        outFields: [&quot;*&quot;]</span><br><span class="line">                    &#125;);     </span><br><span class="line">                    //赋予渲染器</span><br><span class="line">                    featureLayer.setRenderer(renderer);</span><br><span class="line">                    featureLayer.refresh();</span><br><span class="line">                    MyMap.addLayer(featureLayer);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="全部代码-2"><a href="#全部代码-2" class="headerlink" title="全部代码"></a>全部代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;/&gt;</span><br><span class="line">    &lt;title&gt;GenerateRendererTask&lt;/title&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script  type=&quot;text/Javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">        .MapClass&#123;</span><br><span class="line">            width:100%;</span><br><span class="line">            height:500px;</span><br><span class="line">            border:1px solid #000;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line"></span><br><span class="line">        require([&quot;esri/map&quot;,</span><br><span class="line">            &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">            &quot;dojo/dom&quot;,</span><br><span class="line">            &quot;dojo/on&quot;,</span><br><span class="line">            &quot;esri/tasks/GenerateRendererTask&quot;,</span><br><span class="line">            &quot;esri/layers/FeatureLayer&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleFillSymbol&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleLineSymbol&quot;,</span><br><span class="line">            &quot;esri/tasks/GenerateRendererParameters&quot;,</span><br><span class="line">            &quot;esri/tasks/ClassBreaksDefinition&quot;,</span><br><span class="line">            &quot;esri/tasks/AlgorithmicColorRamp&quot;,</span><br><span class="line">            &quot;dojo/domReady!&quot;], function</span><br><span class="line">                (Map,</span><br><span class="line">                 ArcGISDynamicMapServiceLayer,</span><br><span class="line">                 dom,on,</span><br><span class="line">                 GenerateRendererTask,</span><br><span class="line">                 FeatureLayer,</span><br><span class="line">                 SimpleFillSymbol,</span><br><span class="line">                 SimpleLineSymbol,</span><br><span class="line">                 GenerateRendererParameters,</span><br><span class="line">                 ClassBreaksDefinition,</span><br><span class="line">                 AlgorithmicColorRamp</span><br><span class="line">                ) &#123;</span><br><span class="line">            //服务器端渲染</span><br><span class="line">            var MyMap = new Map(&quot;MyMapDiv&quot;);</span><br><span class="line">            var layer = new ArcGISDynamicMapServiceLayer</span><br><span class="line">            (&quot;http://localhost:6080/arcgis/rest/services/Test/ft/MapServer/&quot;);</span><br><span class="line">            MyMap.addLayer(layer)</span><br><span class="line">            //获得id为Btn的DOM对象</span><br><span class="line">            var btn=dom.byId(&quot;Btn&quot;);</span><br><span class="line">            //给btn绑定点击事件</span><br><span class="line">            on(btn,&quot;click&quot;,function(e)&#123;</span><br><span class="line">                //定义线符号</span><br><span class="line">                var lineSymbol=new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new dojo.Color([255, 0, 0]), 3);</span><br><span class="line">                //定义面符号</span><br><span class="line">                var fill=new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol,new dojo.Color(&quot;#FFFFCC&quot;));</span><br><span class="line">                //创建服务器渲染对象</span><br><span class="line">                var RenderAnalyst = new GenerateRendererTask(&quot;http://localhost:6080/arcgis/rest/services/Test/ft/MapServer/1&quot;);</span><br><span class="line">                //创建服务器渲染参数对象</span><br><span class="line">                var params = new GenerateRendererParameters();   </span><br><span class="line">                //创建颜色坡道对象</span><br><span class="line">                var colorRamp = new AlgorithmicColorRamp();</span><br><span class="line">                //颜色的起始位置</span><br><span class="line">                colorRamp.fromColor = dojo.colorFromHex(&quot;#998ec3&quot;);</span><br><span class="line">                //颜色的终止位置</span><br><span class="line">                colorRamp.toColor = dojo.colorFromHex(&quot;#f1a340&quot;);</span><br><span class="line">                //颜色的类型</span><br><span class="line">                colorRamp.algorithm = &quot;hsv&quot;;</span><br><span class="line">                //告诉服务器我们需要什么样子的渲染器</span><br><span class="line">                var unidef = new ClassBreaksDefinition();</span><br><span class="line">                //分类的字段</span><br><span class="line">                unidef.classificationField = &quot;Shape.STArea()&quot;;</span><br><span class="line">                //如何分类</span><br><span class="line">                unidef.classificationMethod=&quot;natural-breaks&quot;;</span><br><span class="line">                //分为几类？</span><br><span class="line">                unidef.breakCount = 3;</span><br><span class="line">                //默认的符号</span><br><span class="line">                unidef.baseSymbol=fill;</span><br><span class="line">                //将自定义的颜色坡道告诉服务器</span><br><span class="line">                unidef.colorRamp=colorRamp;</span><br><span class="line">                //给渲染参数对象赋值</span><br><span class="line">                params.classificationDefinition = unidef;</span><br><span class="line">                //进行服务器渲染</span><br><span class="line">                RenderAnalyst.execute(params, showRender);</span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line">            &#125;);</span><br><span class="line">            //处理服务器返回来的结果</span><br><span class="line">            function showRender(renderer) &#123;</span><br><span class="line">                </span><br><span class="line">                if (renderer != null) &#123;</span><br><span class="line">                    //定义要素图层，注意：这个地方我们用到并不是要素服务，而是地图服务</span><br><span class="line">                    var featureLayer = new FeatureLayer(&quot;http://localhost:6080/arcgis/rest/services/Test/ft/MapServer/1&quot;,&#123;</span><br><span class="line">                        mode:  FeatureLayer.MODE_SNAPSHOT,</span><br><span class="line">                        outFields: [&quot;*&quot;]</span><br><span class="line">                    &#125;);     </span><br><span class="line">                    //赋予渲染器</span><br><span class="line">                    featureLayer.setRenderer(renderer);</span><br><span class="line">                    featureLayer.refresh();</span><br><span class="line">                    MyMap.addLayer(featureLayer);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;MyMapDiv&quot; class=&quot;MapClass&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;input type=&quot;button&quot; id=&quot;Btn&quot; value=&quot;服务器渲染&quot; /&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/2019/08/06/ArcGIS-API-for-JS15/04.png" alt="04.png"></p>

                
                <div class="readmore">
                    <a href="/2019/08/06/ArcGIS-API-for-JS15/">
                        阅读更多
                    </a>
                </div>
            </div>
        
            <div class="post-item">
                <h1>
                    <a href="/2019/08/06/ArcGIS-API-for-JS14/">
                        ArcGIS API For Javascript之查询功能
                    </a>
                </h1>
                <div class="create">
                    <span>创建于</span>
                    
                        <time datetime="2019-08-06T07:26:24.000Z">
                            2019-08-06
                        </time>
                    
                    <ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/ArcGIS/">ArcGIS</a></li></ul>
                </div>
                
                    <p>在ArcGIS API中查询功能是非常常用的，Esri给我们提供了三个类用于实现矢量数据查询功能。FindTask,QueryTask,IdentifyTask，他们之间的区别为：</p>
<ul>
<li>FindTask只能进行属性查询，QueryTask,IdentifyTask两个类既可以进行属性查询也可以进行空间查询。</li>
<li>对于QueryTask,IdentifyTask两个类，QueryTask只可应用于一个单独的图层，IdentifyTask可应用于地图服务和多个图层</li>
<li>QueryTask可以进行简单的统计功能。</li>
</ul>
<h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><h4 id="利用FindTask实现简单的属性查询"><a href="#利用FindTask实现简单的属性查询" class="headerlink" title="利用FindTask实现简单的属性查询"></a>利用FindTask实现简单的属性查询</h4><p><img src="/2019/08/06/ArcGIS-API-for-JS14/01.png" alt="01.png"><br>我们将name属性为J4的教学楼查询出来，在页面上显示J4是哪一个学院？（机电学院），并且将J4的楼高亮显示<br>代码实现</p>
<p>在页面加入一个地图（略）<br>在页面添加一个button和一个div（button用于属性查询，div用于显示楼层的名字）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;button&quot; value=&quot;属性查询&quot; id=&quot;Btn&quot;/&gt;</span><br><span class="line">&lt;div id=&quot;divShowResult&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<p>创建属性查询对象并给button绑定点击事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//地图服务的URL</span><br><span class="line">                var MapServer = &quot;http://localhost:6080/arcgis/rest/services/Test/MyService/MapServer&quot;;</span><br><span class="line">                //创建属性查询对象</span><br><span class="line">                var findTask = new FindTask(MapServer);</span><br><span class="line">                //创建属性查询参数</span><br><span class="line">                var findParams = new FindParameters();</span><br><span class="line">                on(dom.byId(&quot;Btn&quot;),&quot;click&quot;,function()&#123;</span><br><span class="line">                    //是否返回给我们几何信息</span><br><span class="line">                    findParams.returnGeometry = true;</span><br><span class="line">                    //对哪一个图层进行属性查询</span><br><span class="line">                    findParams.layerIds = [1];</span><br><span class="line">                    //查询的字段</span><br><span class="line">                    findParams.searchFields = [&quot;name&quot;];</span><br><span class="line">                    //searchText和searchFields结合使用，即查询name=J4</span><br><span class="line">                    findParams.searchText = &quot;J4&quot;;</span><br><span class="line">                    //执行查询对象</span><br><span class="line">                    findTask.execute(findParams, ShowFindResult);</span><br><span class="line">                &#125;)</span><br></pre></td></tr></table></figure></p>
<p>处理属性查询返回给我们的数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">function ShowFindResult(queryResult) &#123;</span><br><span class="line">                    //创建线符号</span><br><span class="line">                    var lineSymbol=new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new dojo.Color([255, 0, 0]), 3);</span><br><span class="line">                    //创建面符号</span><br><span class="line">                    var fill=new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol);</span><br><span class="line">                    if (queryResult.length == 0) &#123;</span><br><span class="line">                        dom.byId(&quot;divShowResult&quot;).innerHTML = &quot;&quot;;</span><br><span class="line">                        return;</span><br><span class="line">                    &#125;</span><br><span class="line">                    var htmls = &quot;&quot;;</span><br><span class="line">                    if (queryResult.length &gt;= 1) &#123;</span><br><span class="line">                        htmls = htmls + &quot;&lt;table style=\&quot;width: 100%\&quot;&gt;&quot;;</span><br><span class="line">                        htmls = htmls + &quot;&lt;tr&gt;&lt;td&gt;名称&lt;/td&gt;&lt;/tr&gt;&quot;;</span><br><span class="line">                        for (var i = 0; i &lt; queryResult.length; i++) &#123;</span><br><span class="line">                            //获得图形graphic</span><br><span class="line">                            var graphic = queryResult[i].feature;</span><br><span class="line">                            //赋予相应的符号</span><br><span class="line">                            graphic.setSymbol(fill);</span><br><span class="line">                            //将graphic添加到地图中，从而实现高亮效果</span><br><span class="line">                            map.graphics.add(graphic);</span><br><span class="line">                            //获得教学楼名称（此处是和shp属性表对应的）</span><br><span class="line">                            var ptName = graphic.attributes[&quot;alias&quot;];</span><br><span class="line">                            if (i % 2 == 0)</span><br><span class="line">                                htmls = htmls + &quot;&lt;tr&gt;&quot;;</span><br><span class="line">                            else</span><br><span class="line">                                htmls = htmls + &quot;&lt;tr bgcolor=\&quot;#F0F0F0\&quot;&gt;&quot;;</span><br><span class="line">                            htmls = htmls + &quot;&lt;td&gt;&lt;a href=\&quot;#\&quot; \&quot;&gt;&quot; + ptName + &quot;&lt;/a&gt;&lt;/td&gt;&quot;;</span><br><span class="line">                            htmls = htmls + &quot;&lt;/tr&gt;&quot;;</span><br><span class="line">                        &#125;</span><br><span class="line">                        htmls = htmls + &quot;&lt;/table&gt;&quot;;</span><br><span class="line">                        //将属性绑定在divShowResult上面</span><br><span class="line">                        dom.byId(&quot;divShowResult&quot;).innerHTML = htmls;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure></p>
<h5 id="全部代码"><a href="#全部代码" class="headerlink" title="全部代码"></a>全部代码</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;/&gt;</span><br><span class="line">    &lt;title&gt;FindTask&lt;/title&gt;</span><br><span class="line">     &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script  type=&quot;text/Javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">        .MapClass&#123;</span><br><span class="line">            width:100%;</span><br><span class="line">            height:600px;</span><br><span class="line">            border:1px solid #000;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line"></span><br><span class="line">        require([&quot;esri/map&quot;,</span><br><span class="line">            &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">            &quot;dojo/on&quot;,</span><br><span class="line">            &quot;dojo/dom&quot;,</span><br><span class="line">            &quot;esri/tasks/FindTask&quot;,</span><br><span class="line">            &quot;esri/tasks/FindParameters&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleLineSymbol&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleFillSymbol&quot;, </span><br><span class="line">            &quot;esri/graphic&quot;,</span><br><span class="line">            &quot;dojo/domReady!&quot;],</span><br><span class="line">            function (Map, ArcGISDynamicMapServiceLayer,on,dom,</span><br><span class="line">            FindTask, FindParameters, </span><br><span class="line">            SimpleLineSymbol,SimpleFillSymbol,Graphic) &#123;   </span><br><span class="line">                var map = new esri.Map(&quot;mapDiv&quot;);</span><br><span class="line">                //地图服务的URL</span><br><span class="line">                var MapServer = &quot;http://localhost:6080/arcgis/rest/services/Test/MyService/MapServer&quot;;</span><br><span class="line">                var layer = new esri.layers.ArcGISDynamicMapServiceLayer(MapServer);</span><br><span class="line">                map.addLayer(layer)</span><br><span class="line">                //创建属性查询对象</span><br><span class="line">                var findTask = new FindTask(MapServer);</span><br><span class="line">                //创建属性查询参数</span><br><span class="line">                var findParams = new FindParameters();</span><br><span class="line">                on(dom.byId(&quot;Btn&quot;),&quot;click&quot;,function()&#123;</span><br><span class="line">                    //是否返回给我们几何信息</span><br><span class="line">                    findParams.returnGeometry = true;</span><br><span class="line">                    //对哪一个图层进行属性查询</span><br><span class="line">                    findParams.layerIds = [1];</span><br><span class="line">                    //查询的字段</span><br><span class="line">                    findParams.searchFields = [&quot;name&quot;];</span><br><span class="line">                    //searchText和searchFields结合使用，即查询name=J4</span><br><span class="line">                    findParams.searchText = &quot;J4&quot;;</span><br><span class="line">                    //执行查询对象</span><br><span class="line">                    findTask.execute(findParams, ShowFindResult);</span><br><span class="line">                &#125;)</span><br><span class="line">                function ShowFindResult(queryResult) &#123;</span><br><span class="line">                    //创建线符号</span><br><span class="line">                    var lineSymbol=new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new dojo.Color([255, 0, 0]), 3);</span><br><span class="line">                    //创建面符号</span><br><span class="line">                    var fill=new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol);</span><br><span class="line">                    if (queryResult.length == 0) &#123;</span><br><span class="line">                        dom.byId(&quot;divShowResult&quot;).innerHTML = &quot;&quot;;</span><br><span class="line">                        return;</span><br><span class="line">                    &#125;</span><br><span class="line">                    var htmls = &quot;&quot;;</span><br><span class="line">                    if (queryResult.length &gt;= 1) &#123;</span><br><span class="line">                        htmls = htmls + &quot;&lt;table style=\&quot;width: 100%\&quot;&gt;&quot;;</span><br><span class="line">                        htmls = htmls + &quot;&lt;tr&gt;&lt;td&gt;名称&lt;/td&gt;&lt;/tr&gt;&quot;;</span><br><span class="line">                        for (var i = 0; i &lt; queryResult.length; i++) &#123;</span><br><span class="line">                            //获得图形graphic</span><br><span class="line">                            var graphic = queryResult[i].feature;</span><br><span class="line">                            //赋予相应的符号</span><br><span class="line">                            graphic.setSymbol(fill);</span><br><span class="line">                            //将graphic添加到地图中，从而实现高亮效果</span><br><span class="line">                            map.graphics.add(graphic);</span><br><span class="line">                            //获得教学楼名称（此处是和shp属性表对应的）</span><br><span class="line">                            var ptName = graphic.attributes[&quot;alias&quot;];</span><br><span class="line">                            if (i % 2 == 0)</span><br><span class="line">                                htmls = htmls + &quot;&lt;tr&gt;&quot;;</span><br><span class="line">                            else</span><br><span class="line">                                htmls = htmls + &quot;&lt;tr bgcolor=\&quot;#F0F0F0\&quot;&gt;&quot;;</span><br><span class="line">                            htmls = htmls + &quot;&lt;td&gt;&lt;a href=\&quot;#\&quot; \&quot;&gt;&quot; + ptName + &quot;&lt;/a&gt;&lt;/td&gt;&quot;;</span><br><span class="line">                            htmls = htmls + &quot;&lt;/tr&gt;&quot;;</span><br><span class="line">                        &#125;</span><br><span class="line">                        htmls = htmls + &quot;&lt;/table&gt;&quot;;</span><br><span class="line">                        //将属性绑定在divShowResult上面</span><br><span class="line">                        dom.byId(&quot;divShowResult&quot;).innerHTML = htmls;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=&quot;mapDiv&quot; class=&quot;MapClass&quot;&gt;&lt;/div&gt; </span><br><span class="line">    &lt;input type=&quot;button&quot; value=&quot;属性查询&quot; id=&quot;Btn&quot;/&gt;</span><br><span class="line">    &lt;div id=&quot;divShowResult&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>运行之后的结果为：<br><img src="/2019/08/06/ArcGIS-API-for-JS14/01.png" alt="01.png"></p>
<h4 id="利用QueryTask实现空间查询"><a href="#利用QueryTask实现空间查询" class="headerlink" title="利用QueryTask实现空间查询"></a>利用QueryTask实现空间查询</h4><p>此时的的需求是：我们在地图上画一个图形，然后和图形相交的教学楼选择出来。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.使用draw交互绘制几何形状</span><br><span class="line">2.根据geometry形状构建空间查询参数</span><br><span class="line">3.执行空间分析对象</span><br><span class="line">4.处理空间分析的结果</span><br></pre></td></tr></table></figure></p>
<p>创建一个button和一个div（button用于激活绘图工具，div用户显示用户选择的教学楼的名称）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;button&quot; value=&quot;空间查询&quot; id=&quot;Btn&quot;/&gt;</span><br><span class="line">&lt;div id=&quot;divShowResult&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<p>给button绑定事件（激活绘图工具）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//定义一个绘图工具</span><br><span class="line">var toolBar = new Draw(map);</span><br><span class="line">//给button绑定事件</span><br><span class="line">on(dom.byId(&quot;Btn&quot;),&quot;click&quot;,function()&#123;  </span><br><span class="line">    //激活绘图工具，我要绘制一个面图形</span><br><span class="line">    toolBar.activate(Draw.POLYGON);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>给绘图工具绑定绘图完成事件，绘图完成执行queryGraphic函数,并将绘制的geometry传入函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">on(toolBar, &quot;draw-complete&quot;, function (result) &#123;</span><br><span class="line">        //获得绘图得到的面</span><br><span class="line">        var geometry=result.geometry;</span><br><span class="line">        //关闭绘图工具</span><br><span class="line">        toolBar.deactivate();</span><br><span class="line">        queryGraphic(geometry);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></p>
<p>编写queryGraphic函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function queryGraphic(geometry) &#123;</span><br><span class="line">                //创建查询对象，注意：服务的后面有一个编号，代表对那一个图层进行查询</span><br><span class="line">                var queryTask = new QueryTask(&quot;http://localhost:6080/arcgis/rest/services/Test/MyService/MapServer/1&quot;);</span><br><span class="line">                //创建查询参数对象</span><br><span class="line">                var query = new Query();</span><br><span class="line">                //空间查询的几何对象</span><br><span class="line">                query.geometry = geometry;</span><br><span class="line">                //服务器给我们返回的字段信息，*代表返回所有字段</span><br><span class="line">                query.outFields = [&quot;*&quot;];</span><br><span class="line">                //空间参考信息</span><br><span class="line">                query.outSpatialReference = map.spatialReference;</span><br><span class="line">                //查询的标准，此处代表和geometry相交的图形都要返回</span><br><span class="line">                query.spatialRelationship = Query.SPATIAL_REL_INTERSECTS;</span><br><span class="line">                //是否返回几何信息</span><br><span class="line">                query.returnGeometry = true;</span><br><span class="line">                //执行空间查询</span><br><span class="line">                queryTask.execute(query, showQueryResult);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure></p>
<p>处理返回的结果信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">function showQueryResult(queryResult) &#123;</span><br><span class="line">                //创建线符号</span><br><span class="line">                var lineSymbol=new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new dojo.Color([255, 0, 0]), 3);</span><br><span class="line">                //创建面符号</span><br><span class="line">                var fill=new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol);</span><br><span class="line">                if (queryResult.features.length == 0) &#123;</span><br><span class="line">                    dom.byId(&quot;divShowResult&quot;).innerHTML = &quot;&quot;;</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">                var htmls = &quot;&quot;;</span><br><span class="line">                if (queryResult.features.length &gt;= 1) &#123;</span><br><span class="line">                    htmls = htmls + &quot;&lt;table style=\&quot;width: 100%\&quot;&gt;&quot;;</span><br><span class="line">                    htmls = htmls + &quot;&lt;tr&gt;&lt;td&gt;名称&lt;/td&gt;&lt;/tr&gt;&quot;;</span><br><span class="line">                    for (var i = 0; i &lt; queryResult.features.length; i++) &#123;</span><br><span class="line">                        //得到graphic</span><br><span class="line">                        var graphic = queryResult.features[i];</span><br><span class="line">                        //给图形赋予符号</span><br><span class="line">                        graphic.setSymbol(fill);</span><br><span class="line">                        //添加到地图从而实现高亮效果</span><br><span class="line">                        map.graphics.add(graphic);</span><br><span class="line">                        //获得教学楼的名称信息，此处应和shp的属性表对应</span><br><span class="line">                        var ptName = graphic.attributes[&quot;alias&quot;];</span><br><span class="line">                        if (i % 2 == 0)</span><br><span class="line">                            htmls = htmls + &quot;&lt;tr&gt;&quot;;</span><br><span class="line">                        else</span><br><span class="line">                            htmls = htmls + &quot;&lt;tr bgcolor=\&quot;#F0F0F0\&quot;&gt;&quot;;</span><br><span class="line">                        htmls = htmls + &quot;&lt;td&gt;&lt;a href=\&quot;#\&quot;\&quot;&gt;&quot; + ptName + &quot;&lt;/a&gt;&lt;/td&gt;&quot;;</span><br><span class="line">                        htmls = htmls + &quot;&lt;/tr&gt;&quot;;</span><br><span class="line">                    &#125;</span><br><span class="line">                    htmls = htmls + &quot;&lt;/table&gt;&quot;;</span><br><span class="line">                    //将教学楼的名称信息和divShowResult绑定</span><br><span class="line">                    dom.byId(&quot;divShowResult&quot;).innerHTML = htmls;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure></p>
<h5 id="全部代码-1"><a href="#全部代码-1" class="headerlink" title="全部代码"></a>全部代码</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;/&gt;</span><br><span class="line">    &lt;title&gt;QueryTask&lt;/title&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script  type=&quot;text/Javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">        .MapClass&#123;</span><br><span class="line">            width:100%;</span><br><span class="line">            height:600px;</span><br><span class="line">            border:1px solid #000;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line"></span><br><span class="line">        require([&quot;esri/map&quot;,</span><br><span class="line">            &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">            &quot;dojo/dom&quot;,</span><br><span class="line">            &quot;dojo/on&quot;,</span><br><span class="line">            &quot;esri/tasks/QueryTask&quot;,</span><br><span class="line">            &quot;esri/toolbars/draw&quot;,</span><br><span class="line">            &quot;esri/tasks/query&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleLineSymbol&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleFillSymbol&quot;, </span><br><span class="line">            &quot;esri/graphic&quot;,</span><br><span class="line">            &quot;dojo/domReady!&quot;],</span><br><span class="line">            function (Map, ArcGISDynamicMapServiceLayer,dom, on,</span><br><span class="line">            QueryTask, Draw, Query,</span><br><span class="line">            SimpleLineSymbol,SimpleFillSymbol,Graphic) &#123;</span><br><span class="line">            var map = new Map(&quot;mapdiv&quot;);</span><br><span class="line">            var layer = new ArcGISDynamicMapServiceLayer</span><br><span class="line">            (&quot;http://localhost:6080/arcgis/rest/services/Test/MyService/MapServer&quot;);</span><br><span class="line">            map.addLayer(layer)</span><br><span class="line">            //定义一个绘图工具</span><br><span class="line">            var toolBar = new Draw(map);</span><br><span class="line">            //给button绑定事件</span><br><span class="line">            on(dom.byId(&quot;Btn&quot;),&quot;click&quot;,function()&#123;  </span><br><span class="line">                //激活绘图工具，我要绘制一个面图形</span><br><span class="line">                toolBar.activate(Draw.POLYGON);</span><br><span class="line">            &#125;)</span><br><span class="line">            on(toolBar, &quot;draw-complete&quot;, function (result) &#123;</span><br><span class="line">                //获得绘图得到的面</span><br><span class="line">                var geometry=result.geometry;</span><br><span class="line">                //关闭绘图工具</span><br><span class="line">                toolBar.deactivate();</span><br><span class="line">                queryGraphic(geometry);</span><br><span class="line">            &#125;);</span><br><span class="line">            </span><br><span class="line">            function queryGraphic(geometry) &#123;</span><br><span class="line">                //创建查询对象，注意：服务的后面有一个编号，代表对那一个图层进行查询</span><br><span class="line">                var queryTask = new QueryTask(&quot;http://localhost:6080/arcgis/rest/services/Test/MyService/MapServer/1&quot;);</span><br><span class="line">                //创建查询参数对象</span><br><span class="line">                var query = new Query();</span><br><span class="line">                //空间查询的几何对象</span><br><span class="line">                query.geometry = geometry;</span><br><span class="line">                //服务器给我们返回的字段信息，*代表返回所有字段</span><br><span class="line">                query.outFields = [&quot;*&quot;];</span><br><span class="line">                //空间参考信息</span><br><span class="line">                query.outSpatialReference = map.spatialReference;</span><br><span class="line">                //查询的标准，此处代表和geometry相交的图形都要返回</span><br><span class="line">                query.spatialRelationship = Query.SPATIAL_REL_INTERSECTS;</span><br><span class="line">                //是否返回几何信息</span><br><span class="line">                query.returnGeometry = true;</span><br><span class="line">                //执行空间查询</span><br><span class="line">                queryTask.execute(query, showQueryResult);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            function showQueryResult(queryResult) &#123;</span><br><span class="line">                //创建线符号</span><br><span class="line">                var lineSymbol=new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new dojo.Color([255, 0, 0]), 3);</span><br><span class="line">                //创建面符号</span><br><span class="line">                var fill=new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol);</span><br><span class="line">                if (queryResult.features.length == 0) &#123;</span><br><span class="line">                    dom.byId(&quot;divShowResult&quot;).innerHTML = &quot;&quot;;</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">                var htmls = &quot;&quot;;</span><br><span class="line">                if (queryResult.features.length &gt;= 1) &#123;</span><br><span class="line">                    htmls = htmls + &quot;&lt;table style=\&quot;width: 100%\&quot;&gt;&quot;;</span><br><span class="line">                    htmls = htmls + &quot;&lt;tr&gt;&lt;td&gt;名称&lt;/td&gt;&lt;/tr&gt;&quot;;</span><br><span class="line">                    for (var i = 0; i &lt; queryResult.features.length; i++) &#123;</span><br><span class="line">                        //得到graphic</span><br><span class="line">                        var graphic = queryResult.features[i];</span><br><span class="line">                        //给图形赋予符号</span><br><span class="line">                        graphic.setSymbol(fill);</span><br><span class="line">                        //添加到地图从而实现高亮效果</span><br><span class="line">                        map.graphics.add(graphic);</span><br><span class="line">                        //获得教学楼的名称信息，此处应和shp的属性表对应</span><br><span class="line">                        var ptName = graphic.attributes[&quot;alias&quot;];</span><br><span class="line">                        if (i % 2 == 0)</span><br><span class="line">                            htmls = htmls + &quot;&lt;tr&gt;&quot;;</span><br><span class="line">                        else</span><br><span class="line">                            htmls = htmls + &quot;&lt;tr bgcolor=\&quot;#F0F0F0\&quot;&gt;&quot;;</span><br><span class="line">                        htmls = htmls + &quot;&lt;td&gt;&lt;a href=\&quot;#\&quot;\&quot;&gt;&quot; + ptName + &quot;&lt;/a&gt;&lt;/td&gt;&quot;;</span><br><span class="line">                        htmls = htmls + &quot;&lt;/tr&gt;&quot;;</span><br><span class="line">                    &#125;</span><br><span class="line">                    htmls = htmls + &quot;&lt;/table&gt;&quot;;</span><br><span class="line">                    //将教学楼的名称信息和divShowResult绑定</span><br><span class="line">                    dom.byId(&quot;divShowResult&quot;).innerHTML = htmls;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">           </span><br><span class="line"></span><br><span class="line">            </span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=&quot;mapdiv&quot; class=&quot;MapClass&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;input type=&quot;button&quot; value=&quot;空间查询&quot; id=&quot;Btn&quot;/&gt;</span><br><span class="line">    &lt;div id=&quot;divShowResult&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>运行之后的结果为：<br><img src="/2019/08/06/ArcGIS-API-for-JS14/03.png" alt="03.png"></p>
<h4 id="利用QueryTask进行属性查询"><a href="#利用QueryTask进行属性查询" class="headerlink" title="利用QueryTask进行属性查询"></a>利用QueryTask进行属性查询</h4><p>利用QueryTask进行属性查询和空间查询代码差不多。</p>
<p>#####全部代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;/&gt;</span><br><span class="line">    &lt;title&gt;QueryTask&lt;/title&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script  type=&quot;text/Javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">        .MapClass&#123;</span><br><span class="line">            width:100%;</span><br><span class="line">            height:600px;</span><br><span class="line">            border:1px solid #000;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line"></span><br><span class="line">        require([&quot;esri/map&quot;,</span><br><span class="line">            &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">            &quot;dojo/dom&quot;,</span><br><span class="line">            &quot;dojo/on&quot;,</span><br><span class="line">            &quot;esri/tasks/QueryTask&quot;,</span><br><span class="line">            &quot;esri/tasks/query&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleLineSymbol&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleFillSymbol&quot;, </span><br><span class="line">            &quot;esri/graphic&quot;,</span><br><span class="line">            &quot;dojo/domReady!&quot;],</span><br><span class="line">            function (Map, ArcGISDynamicMapServiceLayer,dom, on,</span><br><span class="line">            QueryTask, Query,</span><br><span class="line">            SimpleLineSymbol,SimpleFillSymbol,Graphic) &#123;</span><br><span class="line">                //根据div的id属性创建地图</span><br><span class="line">                var map = new Map(&quot;mapDiv&quot;);</span><br><span class="line">                //定义一个动态地图服务</span><br><span class="line">                var layer = new ArcGISDynamicMapServiceLayer</span><br><span class="line">                (&quot;http://localhost:6080/arcgis/rest/services/Test/MyService/MapServer&quot;);</span><br><span class="line">                //将图层添加到地图</span><br><span class="line">                map.addLayer(layer)</span><br><span class="line">                //给属性查询按钮添加click事件</span><br><span class="line">                on(dom.byId(&quot;Btn&quot;),&quot;click&quot;,function(e)&#123;</span><br><span class="line">                    //定义查询对象</span><br><span class="line">                    var queryTask = new QueryTask</span><br><span class="line">                    (&quot;http://localhost:6080/arcgis/rest/services/Test/MyService/MapServer/1&quot;);</span><br><span class="line">                    //定义查询参数对象</span><br><span class="line">                    var query = new Query();</span><br><span class="line">                    //查询条件，类似于sql语句的where子句</span><br><span class="line">                    query.where = &quot;name = &apos;J4&apos;&quot;;;</span><br><span class="line">                    //返回的字段信息：*代表返回全部字段</span><br><span class="line">                    query.outFields = [&quot;*&quot;];</span><br><span class="line">                    //是否返回几何形状</span><br><span class="line">                    query.returnGeometry = true;</span><br><span class="line">                    //执行属性查询</span><br><span class="line">                    queryTask.execute(query, showQueryResult);</span><br><span class="line">                &#125;)</span><br><span class="line">                //属性查询完成之后，用showQueryResult来处理返回的结果</span><br><span class="line">                function showQueryResult(queryResult)</span><br><span class="line">                &#123;</span><br><span class="line">                    //创建线符号</span><br><span class="line">                    var lineSymbol=new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new dojo.Color([255, 0, 0]), 3);</span><br><span class="line">                    //创建面符号</span><br><span class="line">                    var fill=new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol);</span><br><span class="line">                    if (queryResult.features.length == 0) &#123;</span><br><span class="line">                        dom.byId(&quot;divShowResult&quot;).innerHTML = &quot;&quot;;</span><br><span class="line">                        return;</span><br><span class="line">                    &#125;</span><br><span class="line">                    var htmls = &quot;&quot;;</span><br><span class="line">                    if (queryResult.features.length &gt;= 1) &#123;</span><br><span class="line">                        htmls = htmls + &quot;&lt;table style=\&quot;width: 100%\&quot;&gt;&quot;;</span><br><span class="line">                        htmls = htmls + &quot;&lt;tr&gt;&lt;td&gt;名称&lt;/td&gt;&lt;/tr&gt;&quot;;</span><br><span class="line">                        for (var i = 0; i &lt; queryResult.features.length; i++) &#123;</span><br><span class="line">                            //获得图形graphic</span><br><span class="line">                            var graphic = queryResult.features[i];</span><br><span class="line">                            //赋予相应的符号</span><br><span class="line">                            graphic.setSymbol(fill);</span><br><span class="line">                            //将graphic添加到地图中，从而实现高亮效果</span><br><span class="line">                            map.graphics.add(graphic);</span><br><span class="line">                            //获得教学楼名称（此处是和shp属性表对应的）</span><br><span class="line">                            var ptName = graphic.attributes[&quot;alias&quot;];</span><br><span class="line">                            if (i % 2 == 0)</span><br><span class="line">                                htmls = htmls + &quot;&lt;tr&gt;&quot;;</span><br><span class="line">                            else</span><br><span class="line">                                htmls = htmls + &quot;&lt;tr bgcolor=\&quot;#F0F0F0\&quot;&gt;&quot;;</span><br><span class="line">                            htmls = htmls + &quot;&lt;td&gt;&lt;a href=\&quot;#\&quot; \&quot;&gt;&quot; + ptName + &quot;&lt;/a&gt;&lt;/td&gt;&quot;;</span><br><span class="line">                            htmls = htmls + &quot;&lt;/tr&gt;&quot;;</span><br><span class="line">                        &#125;</span><br><span class="line">                        htmls = htmls + &quot;&lt;/table&gt;&quot;;</span><br><span class="line">                        //将属性绑定在divShowResult上面</span><br><span class="line">                        dom.byId(&quot;divShowResult&quot;).innerHTML = htmls;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">              </span><br><span class="line">         </span><br><span class="line"></span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=&quot;mapDiv&quot; class=&quot;MapClass&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;input type=&quot;button&quot; value=&quot;属性查询&quot; id=&quot;Btn&quot;/&gt;</span><br><span class="line">    &lt;div id=&quot;divShowResult&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p>运行之后的结果：<br><img src="/2019/08/06/ArcGIS-API-for-JS14/04.png" alt="04.png"></p>
<h4 id="利用IdentifyTask实现空间查询"><a href="#利用IdentifyTask实现空间查询" class="headerlink" title="利用IdentifyTask实现空间查询"></a>利用IdentifyTask实现空间查询</h4><p>IdentifyTask的使用与QueryTask十分类似，唯一不同的是IdentifyTask可以作用于多个图层，而QueryTask是作用于一个图层的。</p>
<h5 id="全部代码-2"><a href="#全部代码-2" class="headerlink" title="全部代码"></a>全部代码</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;/&gt;</span><br><span class="line">    &lt;title&gt;WebGIS&lt;/title&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script  type=&quot;text/Javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">        .MapClass&#123;</span><br><span class="line">            width:100%;</span><br><span class="line">            height:600px;</span><br><span class="line">            border:1px solid #000;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line"></span><br><span class="line">        require([&quot;esri/map&quot;,</span><br><span class="line">            &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">            &quot;dojo/on&quot;,</span><br><span class="line">            &quot;dojo/dom&quot;,</span><br><span class="line">            &quot;esri/tasks/IdentifyTask&quot;,</span><br><span class="line">            &quot;esri/tasks/IdentifyParameters&quot;,</span><br><span class="line">            &quot;esri/toolbars/draw&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleFillSymbol&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleLineSymbol&quot;,</span><br><span class="line">            &quot;esri/graphic&quot;,</span><br><span class="line">            &quot;dojo/domReady!&quot;],</span><br><span class="line">            function (Map,</span><br><span class="line">                ArcGISDynamicMapServiceLayer,</span><br><span class="line">                on,</span><br><span class="line">                dom,</span><br><span class="line">                IdentifyTask,</span><br><span class="line">                IdentifyParameters,</span><br><span class="line">                Draw,</span><br><span class="line">                SimpleFillSymbol,</span><br><span class="line">                SimpleLineSymbol,</span><br><span class="line">                Graphic</span><br><span class="line">                ) &#123;</span><br><span class="line">                    var map = new Map(&quot;mapDiv&quot;);</span><br><span class="line">                    //地图服务的url</span><br><span class="line">                    MapServer = &quot;http://localhost:6080/arcgis/rest/services/Test/MyService/MapServer&quot;;</span><br><span class="line">                    //定义一个动态地图服务</span><br><span class="line">                    var layer = new ArcGISDynamicMapServiceLayer(MapServer);    </span><br><span class="line">                    map.addLayer(layer)</span><br><span class="line">                    //定义绘图对象</span><br><span class="line">                    var toolBar = new Draw(map);</span><br><span class="line">                    //绑定点击事件</span><br><span class="line">                    on(dom.byId(&quot;Btn&quot;),&quot;click&quot;,function(e)&#123;</span><br><span class="line">                        //激活绘图工具：绘制面</span><br><span class="line">                        toolBar.activate(esri.toolbars.Draw.POLYGON);</span><br><span class="line">                        </span><br><span class="line">                    &#125;)</span><br><span class="line">                    //给绘图工具绑定绘图完成事件</span><br><span class="line">                    on(toolBar, &quot;draw-complete&quot;, function (result)</span><br><span class="line">                    &#123;</span><br><span class="line">                        //获得绘图得到的面</span><br><span class="line">                        var geometry=result.geometry;</span><br><span class="line">                        //关闭绘图工具</span><br><span class="line">                        toolBar.deactivate();</span><br><span class="line">                        //执行空间查询</span><br><span class="line">                        identifyQuery(geometry);</span><br><span class="line">                    &#125;);                   </span><br><span class="line">                    function identifyQuery(geometry) &#123;</span><br><span class="line">                        //定义空间查询对象，注意他的参数是整个地图服务，而不是单个图层</span><br><span class="line">                        var identifyTask = new IdentifyTask(MapServer);</span><br><span class="line">                        //定义空间查询参数对象</span><br><span class="line">                        var params = new IdentifyParameters();</span><br><span class="line">                        //容差</span><br><span class="line">                        params.tolerance = 5;</span><br><span class="line">                        //是否返回几何信息</span><br><span class="line">                        params.returnGeometry = true;</span><br><span class="line">                        //空间查询的图层，此时是两个图层</span><br><span class="line">                        params.layerIds = [1,3];</span><br><span class="line">                        //空间查询的条件</span><br><span class="line">                        params.layerOption = IdentifyParameters.LAYER_OPTION_ALL;</span><br><span class="line">                        params.width = map.width;</span><br><span class="line">                        params.height = map.height;</span><br><span class="line">                        //空间查询的几何对象</span><br><span class="line">                        params.geometry = geometry;</span><br><span class="line">                        params.mapExtent = map.extent;</span><br><span class="line">                        //执行空间查询</span><br><span class="line">                        identifyTask.execute(params,showQueryResult);</span><br><span class="line">                    &#125;</span><br><span class="line">                    //通过此函数处理查询之后的信息</span><br><span class="line">                    function showQueryResult(idResults) &#123;</span><br><span class="line">                        //创建线符号</span><br><span class="line">                        var lineSymbol=new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new dojo.Color([255, 0, 0]), 3);</span><br><span class="line">                        //创建面符号</span><br><span class="line">                        var fill=new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, lineSymbol);</span><br><span class="line">                        if (idResults.length &gt; 0) &#123;</span><br><span class="line">                                var htmls = &quot;&lt;table style=\&quot;width: 100%\&quot;&gt;&quot;;</span><br><span class="line">                                htmls = htmls + &quot;&lt;tr bgcolor=\&quot;#E0E0E0\&quot;&gt;&lt;td&gt; 图层 &lt;/td&gt;&lt;td&gt; 名 称&lt;/td&gt;&lt;/tr&gt;&quot;;</span><br><span class="line">                                for (var i = 0; i &lt; idResults.length; i++) &#123;</span><br><span class="line">                                    var result = idResults[i];</span><br><span class="line">                                    //获得图形graphic</span><br><span class="line">                                    var graphic = result.feature;</span><br><span class="line">                                    //设置图形的符号</span><br><span class="line">                                    graphic.setSymbol(fill);</span><br><span class="line">                                    //获得教学楼的名称信息</span><br><span class="line">                                    var namevalue = result.feature.attributes.alias;</span><br><span class="line">                                    if (i % 2 == 1) &#123;</span><br><span class="line">                                        htmls = htmls + &quot;&lt;tr  bgcolor=\&quot;#E0E0E0\&quot;&gt;&lt;td&gt;&quot; +</span><br><span class="line">                                        result.layerName + &quot;&lt;/td&gt;&lt;td&gt;&quot; + namevalue + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                    else &#123;</span><br><span class="line">                                        htmls = htmls + &quot;&lt;tr&gt;&lt;td&gt;&quot; + result.layerName + &quot;&lt;/td&gt;&lt;td&gt;&quot;</span><br><span class="line">                                        + namevalue + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                    </span><br><span class="line">                                    map.graphics.add(graphic);</span><br><span class="line">                                &#125;</span><br><span class="line">                                htmls = htmls + &quot;&lt;/table&gt;&quot;;</span><br><span class="line">                                document.getElementById(&quot;divShowResult&quot;).innerHTML = htmls;</span><br><span class="line">                            &#125;</span><br><span class="line">                            else &#123;</span><br><span class="line">                                document.getElementById(&quot;divShowResult&quot;).innerHTML = &quot;&quot;;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        </span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=&quot;mapDiv&quot; class=&quot;MapClass&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;input type=&quot;button&quot; value=&quot;空间查询---多边形&quot; id=&quot;Btn&quot;/&gt;</span><br><span class="line">    &lt;div id=&quot;divShowResult&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>运行之后的结果：<br><img src="/2019/08/06/ArcGIS-API-for-JS14/05.png" alt="05.png"></p>

                
                <div class="readmore">
                    <a href="/2019/08/06/ArcGIS-API-for-JS14/">
                        阅读更多
                    </a>
                </div>
            </div>
        
    </div>


    <div id="content-aside">
    <div class="content-aside-owner">
        <div id="owner">
    <div class="avatar-bg">
        <div class="index-page">
            <div class="banner">
                <div class="slide slide1">
                    <div class="bg-wrapper">
                        <div class="bg" id="container_left">
                            <div id="canvas_left"></div>
                        </div>
                    </div>
                </div>
                <div class="slide slide2">
                    <div class="bg-wrapper">
                        <div class="bg" id="container_right">
                            <div id="canvas_right"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <a href="/"><img class="avatar" src="/images/avatar.jpg" alt=""></a>
    <a href="/"><h3 class="author">I&#39;m xiedandan</h3></a>
    <h4>^_^</h4>
    <div class="social">
        
            
              <a href="https://github.com/xdd7130" title="github" class="fa fa-github" target="_blank"></a>
            
        
            
              <a href="#" title="weibo" class="fa fa-weibo" target="_blank"></a>
            
        
    </div>
</div>
    </div>
    
        <div class="content-aside-about">
            <h2>
                <a href="/about">关于</a>
            </h2>
        </div>
    
    <div class="content-aside-tags">
        <h2>
            <a href="/tags">
                标签
                <sup style="font-size: 12px">
                    [25]
                </sup>
            </a>
        </h2>
    </div>
    
<aside id="categories">
    <h2>分类</h2>
    
        <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ArcGIS/">ArcGIS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Node/">Node</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/React/">React</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/VUE/">VUE</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/其他前端技术/">其他前端技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/基础前端技术/">基础前端技术</a></li></ul>
    
</aside>

    
<aside id="acchives">
    <h2>归档</h2>
    
    <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li></ul>
    
</aside>

</div>

</div>
<nav id="pagination" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; 上一页</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/4/">下一页 &raquo;</a>
</nav>

    </div>
</div>
<footer id="footer">
     <div id="copyright">&copy; I&#39;m xiedandan  2020</div>
     
             <!-- 不蒜子统计 -->
             <span id="busuanzi_container_site_pv">
                     本站总访问量<span id="busuanzi_value_site_pv" style='color:#17a167'></span>次
             </span>
             <span class="post-meta-divider">|</span>
             <span id="busuanzi_container_site_uv">
                     本站访客数<span id="busuanzi_value_site_uv"  style='color:#17a167'></span>人
             </span>
             <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
       
    <div id="theme">
        Powered by <a href="http://hexo.io">Hexo</a>. Theme by <a href="https://github.com/markyong/hexo-theme-stage">Stage</a>
    </div>
</footer>
<script src="/lib/js/waterrippleeffect.min.js"></script>
<script src="/js/header-bg.main.js"></script>

    <script src="/lib/js/cav.js"></script>
    <script src="/js/avatar-bg.main.js"></script>

</body>
</html>
