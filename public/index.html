
<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <title>DD_XIE的学习笔记</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="">
    <meta name="description" content="前端学习">
    
        <link rel="icon" href="/favicon.ico">
    
    
        
            <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
        
            <link rel="stylesheet" href="/css/stage.css">
        
            <link rel="stylesheet" href="/css/avatar-bg.css">
        
    
</head>
</html>
<body>
<header id="header">
    <div class="menu">
        <i class="fa fa-bars"></i>
    </div>
    <div class="header-main">
        <h1><a href="/">DD_XIE的学习笔记</a></h1>
    </div>
    <div id="nav">
        <div class="nav-img" id="nav-img"></div>
        <div class="sentences">
            云里写诗，泥里生活，岁月里洒脱。
        </div>
    </div>
</header>

<div id="content-outer">
    <div id="content-inner">
        <div class="clearfix">
    
    <div id="recent-posts">
        
            <div class="post-item">
                <h1>
                    <a href="/2019/09/11/node7/">
                        MySQL
                    </a>
                </h1>
                <div class="create">
                    <span>创建于</span>
                    
                        <time datetime="2019-09-11T07:11:01.000Z">
                            2019-09-11
                        </time>
                    
                    <ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Node/">Node</a></li></ul>
                </div>
                
                    <h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><h4 id="mysql安装"><a href="#mysql安装" class="headerlink" title="mysql安装"></a>mysql安装</h4><p>参考：<a href="https://www.cnblogs.com/laumians-notes/p/9069498.html" target="_blank" rel="noopener">https://www.cnblogs.com/laumians-notes/p/9069498.html</a></p>
<p>Navicat数据库管理工具:<a href="https://blog.csdn.net/a599174211/article/details/82795658" target="_blank" rel="noopener">https://blog.csdn.net/a599174211/article/details/82795658</a></p>
<h3 id="nodeJS操作MySQL"><a href="#nodeJS操作MySQL" class="headerlink" title="nodeJS操作MySQL"></a>nodeJS操作MySQL</h3><p>nodeJS默认不支持MySQL,需要第三方工具来驱动，这里用mysql驱动。</p>
<ul>
<li>npm install mysql</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const mysql = require(<span class="string">'mysql'</span>);</span><br><span class="line"></span><br><span class="line">1.连接</span><br><span class="line">//createConnection(哪台服务器，用户名，密码，库)</span><br><span class="line">var db = mysql.createConnection(host:<span class="string">'localhost'</span>,port:<span class="string">'3306'</span>,user:<span class="string">'root'</span>,password:<span class="string">'123456'</span>,database:<span class="string">'my_db'</span>,)；</span><br><span class="line"></span><br><span class="line">2.查询</span><br><span class="line">//query(干啥，回调函数)</span><br><span class="line">db.query(<span class="string">"SELECT * FROM `user_table`;"</span>,(err,data)=&gt;&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)</span><br><span class="line">        console.log(<span class="string">'出错了'</span>，err)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        console.log(<span class="string">'成功了'</span>，data)</span><br><span class="line">        console.log(JSON.stringify(data))</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="SQL标准写法："><a href="#SQL标准写法：" class="headerlink" title="SQL标准写法："></a>SQL标准写法：</h3><p>1.关键字大写<br>2.库、表、字段需加上饭单引号<code></code><br>SQL四大语句：增删改查<br>增：INSERT<br>INSERT INTO 表（字段列表） VALUES (值列表)<br>INSERT INTO <code>user_table</code>（<code>ID</code>,<code>username</code>,<code>password</code>）VALUES (<code>0</code>,<code>blue2</code>,<code>987654</code>) VALUES (值列表)<br>删：DELETE<br>改：UPDATE<br>查：SELECT</p>

                
                <div class="readmore">
                    <a href="/2019/09/11/node7/">
                        阅读更多
                    </a>
                </div>
            </div>
        
            <div class="post-item">
                <h1>
                    <a href="/2019/09/10/node6/">
                        jade、ejs模板库
                    </a>
                </h1>
                <div class="create">
                    <span>创建于</span>
                    
                        <time datetime="2019-09-10T08:36:44.000Z">
                            2019-09-10
                        </time>
                    
                    <ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Node/">Node</a></li></ul>
                </div>
                
                    <p>模板引擎：生成页面</p>
<p>主要的：</p>
<blockquote>
<p>jade-破坏式、侵入式、强依赖<br>ejs-温和式、非侵入式、 弱依赖</p>
</blockquote>
<h3 id="安装jade插件"><a href="#安装jade插件" class="headerlink" title="安装jade插件"></a>安装jade插件</h3><p>npm install jade</p>
<p>jade写法:</p>
<ul>
<li>根据缩进，规定层级</li>
<li>属性放在()里面，逗号分隔</li>
<li>a标签文本内容前有一个空格</li>
<li>style两种写法：普通属性写法;用json。</li>
<li>class两种写法:普通属性写法;用数组。</li>
<li>&amp;attribute</li>
</ul>
<p>jade1.js<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const jade = require(<span class="string">'jade'</span>);</span><br><span class="line">//字符串：var str = jade.render(<span class="string">'njfnejrfbjreknve'</span>);</span><br><span class="line">//文件：</span><br><span class="line">var str = jade.renderfile(<span class="string">'./views/1.jade'</span>,&#123;pertty:<span class="literal">true</span>&#125;);</span><br><span class="line">console.log(str);</span><br></pre></td></tr></table></figure></p>
<p>1.jade<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">html</span><br><span class="line">    head</span><br><span class="line">        style</span><br><span class="line">        script(src=<span class="string">"a.js"</span>)</span><br><span class="line">        link(href=<span class="string">'a.css'</span>,rel=<span class="string">'stylesheet'</span>)</span><br><span class="line">    body</span><br><span class="line">        div.box</span><br><span class="line">        div<span class="comment">#div1</span></span><br><span class="line">        div(style=<span class="string">"width:200px;height:200px;"</span>,class=<span class="string">"aaa bbb"</span>)</span><br><span class="line">            ul</span><br><span class="line">                li</span><br><span class="line">                    input(<span class="built_in">type</span>=<span class="string">'text'</span>,id=<span class="string">"test1"</span>)</span><br><span class="line">                li</span><br><span class="line">                    a(href=<span class="string">'http://baidu.com'</span>) 百度</span><br><span class="line">                li</span><br><span class="line">            div(style=&#123;width:<span class="string">'200px'</span>,height:<span class="string">'200px'</span>;&#125;,class=[<span class="string">'aaa'</span>,<span class="string">'bbb'</span>])</span><br></pre></td></tr></table></figure></p>
<h3 id="jade模板库高级语法"><a href="#jade模板库高级语法" class="headerlink" title="jade模板库高级语法"></a>jade模板库高级语法</h3><ul>
<li>识别单双标签，自定义标签默认为双标签。<br><img src="/2019/09/10/node6/01.png" alt="01.png"></li>
<li>“|”或”.”用来原样输出东西。<br><img src="/2019/09/10/node6/02.png" alt="02.png"><br><img src="/2019/09/10/node6/03.png" alt="03.png"></li>
<li>include引入文件<br><img src="/2019/09/10/node6/04.png" alt="04.png"></li>
<li><p>使用变量：#{}  或”=”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1.js</span><br><span class="line">    const jade= require(<span class="string">'jade'</span>);</span><br><span class="line">    console.log(jade.renderfile(<span class="string">'./view/1.jade'</span>,&#123;pretty:<span class="literal">true</span>,name:<span class="string">'blue'</span>&#125;))</span><br><span class="line"></span><br><span class="line">1.jade</span><br><span class="line">    div 我的名字<span class="comment">#&#123;name&#125;</span></span><br><span class="line">    div=name</span><br></pre></td></tr></table></figure>
</li>
<li><p>“-“代表：我是一段代码<br><img src="/2019/09/10/node6/05.png" alt="05.png"></p>
</li>
<li><p>循环：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1.jade</span><br><span class="line">html </span><br><span class="line">    head</span><br><span class="line">        body</span><br><span class="line">            .<span class="keyword">for</span>(var i=0;i&lt;arr.length;i++)</span><br><span class="line">            div=arr[i]</span><br><span class="line"></span><br><span class="line">1.js</span><br><span class="line">console.log(jade.renderfile(<span class="string">'./view/1.jade'</span>,&#123;pretty:<span class="literal">true</span>,</span><br><span class="line">    arr:[<span class="string">'aaa'</span>,<span class="string">'bbb'</span>,<span class="string">'ccc'</span>]</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>
</li>
<li><p>非转义：标签原样输出：！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1.jade</span><br><span class="line">html </span><br><span class="line">    head</span><br><span class="line">        body</span><br><span class="line">            div!=content</span><br><span class="line"></span><br><span class="line">1.js</span><br><span class="line">console.log(jade.renderfile(<span class="string">'./view/1.jade'</span>,&#123;pretty:<span class="literal">true</span>,</span><br><span class="line">    content:<span class="string">'&lt;h2&gt;mwenfoirefwo&lt;/h2&gt;'</span></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>
</li>
<li><p>生成html文件<br><img src="/2019/09/10/node6/06.png" alt="06.png"></p>
</li>
</ul>
<h3 id="安装ejs插件"><a href="#安装ejs插件" class="headerlink" title="安装ejs插件"></a>安装ejs插件</h3><p>npm install ejs</p>
<p>ejs1.js<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const ejs = require(<span class="string">'ejs'</span>);</span><br><span class="line">var str = ejs.renderfile(<span class="string">'./views/1.ejs'</span>,&#123;name:<span class="string">'blue'</span>&#125;,<span class="keyword">function</span>(err,data)&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)</span><br><span class="line">        console.log(<span class="string">'编译失败'</span>)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        console.log(data)</span><br><span class="line">&#125;);</span><br><span class="line">console.log(str);</span><br></pre></td></tr></table></figure></p>
<p>1.ejs<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    我的名字叫：&lt;%= name %&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="ejs模板库高级语法"><a href="#ejs模板库高级语法" class="headerlink" title="ejs模板库高级语法"></a>ejs模板库高级语法</h3><ul>
<li>灵活，支持各类型数据<br><img src="/2019/09/10/node6/07.png" alt="07.png"></li>
<li>循环<br><img src="/2019/09/10/node6/08.png" alt="08.png"></li>
<li>“=”转义输出,”-“非转义输出</li>
<li>&lt;% include ./a.txt %&gt;<br><img src="/2019/09/10/node6/09.png" alt="09.png"></li>
</ul>

                
                <div class="readmore">
                    <a href="/2019/09/10/node6/">
                        阅读更多
                    </a>
                </div>
            </div>
        
            <div class="post-item">
                <h1>
                    <a href="/2019/08/23/时序动画/">
                        时序动画
                    </a>
                </h1>
                <div class="create">
                    <span>创建于</span>
                    
                        <time datetime="2019-08-23T08:39:42.000Z">
                            2019-08-23
                        </time>
                    
                    <ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/ArcGIS/">ArcGIS</a></li></ul>
                </div>
                
                    <h4 id="补充1-2019-08-29"><a href="#补充1-2019-08-29" class="headerlink" title="补充1:2019-08-29"></a>补充1:2019-08-29</h4><blockquote>
<p>发布服务前，设置时区</p>
</blockquote>
<p><img src="/2019/08/23/时序动画/02.png" alt="02.png"></p>
<p>效果图：<br><img src="/2019/08/23/时序动画/01.png" alt="01.png"></p>
<h4 id="步骤一：数据准备"><a href="#步骤一：数据准备" class="headerlink" title="步骤一：数据准备"></a>步骤一：数据准备</h4><p>拖拉机数据：时间2019/6/7 7:59:00-2019/6/713:52:00<br>目标数据：时间2019/6/7 8:00:00-2019/6/713:52:00 </p>
<p>注意：所有的数据需放在地理数据库里，否则日期后的时分秒被自动截去删除。</p>
<h4 id="步骤二：制图表达"><a href="#步骤二：制图表达" class="headerlink" title="步骤二：制图表达"></a>步骤二：制图表达</h4><p>将拖拉机数据转为制图表达，重新为RULEID赋值，这里我全赋值为6，不能赋值为0哦。<br>目标数据线分为五个等级，再转为制图表达，RULEID是否重新赋值视情况而定。(能够满足步骤四的分级)</p>
<h4 id="步骤三：合并merge"><a href="#步骤三：合并merge" class="headerlink" title="步骤三：合并merge"></a>步骤三：合并merge</h4><p>将两个制图表达数据合并。</p>
<h4 id="步骤四：分级"><a href="#步骤四：分级" class="headerlink" title="步骤四：分级"></a>步骤四：分级</h4><p>将步骤三合并的文件进行分级，这里分为六级（包括整个图层），其中第六级用来渲染拖拉机符号。</p>
<h4 id="步骤五：再次制图表达"><a href="#步骤五：再次制图表达" class="headerlink" title="步骤五：再次制图表达"></a>步骤五：再次制图表达</h4><p>将分级后的文件再次制作制图表达，对第六级进行符号渲染。</p>
<h4 id="步骤六：将文件导入到数据库"><a href="#步骤六：将文件导入到数据库" class="headerlink" title="步骤六：将文件导入到数据库"></a>步骤六：将文件导入到数据库</h4><h4 id="步骤七：从数据库拉去数据设置timeslider属性，发布服务"><a href="#步骤七：从数据库拉去数据设置timeslider属性，发布服务" class="headerlink" title="步骤七：从数据库拉去数据设置timeslider属性，发布服务"></a>步骤七：从数据库拉去数据设置timeslider属性，发布服务</h4><h4 id="步骤八：调用服务"><a href="#步骤八：调用服务" class="headerlink" title="步骤八：调用服务"></a>步骤八：调用服务</h4><p>使用动态图层，要素服务调用，符号不渲染。</p>
<h4 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=utf-8"</span>&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"initial-scale=1, maximum-scale=1,user-scalable=no"</span>&gt;</span><br><span class="line">    &lt;title&gt;Recent Earthquakes&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">    &lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"https://js.arcgis.com/3.29/dijit/themes/claro/claro.css"</span>&gt;</span><br><span class="line">    &lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"https://js.arcgis.com/3.29/esri/css/esri.css"</span>&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;style&gt;</span><br><span class="line">      html, body &#123;</span><br><span class="line">        height: 100%;</span><br><span class="line">        width: 100%;</span><br><span class="line">        margin: 0;</span><br><span class="line">        padding: 0;</span><br><span class="line">      &#125;</span><br><span class="line">      .dijitBorders&#123;</span><br><span class="line">        margin:5px 5px 5px 5px; </span><br><span class="line">        border:solid thin <span class="comment">#9CAA9C;</span></span><br><span class="line">       -moz-border-radius: 4px;</span><br><span class="line">      &#125;</span><br><span class="line">      .labelText&#123;</span><br><span class="line">        color:<span class="comment">#9CAA9C;</span></span><br><span class="line">        font-size:12pt;  </span><br><span class="line">        font-family:<span class="string">"Tahoma"</span>;</span><br><span class="line">        margin:5px;</span><br><span class="line">      &#125;</span><br><span class="line">      .headerText&#123;</span><br><span class="line">        color:<span class="comment">#9CAA9C;</span></span><br><span class="line">        font-size:16pt;</span><br><span class="line">        font-weight:bold;</span><br><span class="line">        font-family: <span class="string">"Tahoma"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script src=<span class="string">"https://js.arcgis.com/3.29/"</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">      var map,timeExtent;</span><br><span class="line">      require([</span><br><span class="line">        <span class="string">"esri/map"</span>,<span class="string">"esri/layers/ArcGISDynamicMapServiceLayer"</span>, <span class="string">"esri/layers/FeatureLayer"</span>, <span class="string">"esri/TimeExtent"</span>, <span class="string">"esri/layers/TimeInfo"</span>,</span><br><span class="line">        <span class="string">"esri/renderers/ClassBreaksRenderer"</span>,</span><br><span class="line">        <span class="string">"esri/symbols/SimpleMarkerSymbol"</span>, <span class="string">"esri/symbols/SimpleLineSymbol"</span>,</span><br><span class="line">        <span class="string">"esri/dijit/editing/TemplatePicker"</span>, <span class="string">"esri/dijit/TimeSlider"</span>,</span><br><span class="line">        <span class="string">"esri/renderers/TimeClassBreaksAger"</span>, <span class="string">"esri/renderers/TemporalRenderer"</span>,</span><br><span class="line">        <span class="string">"dojo/parser"</span>, <span class="string">"dojo/_base/array"</span>, <span class="string">"esri/Color"</span>, <span class="string">"dojo/dom"</span>, <span class="string">"dojo/date"</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="string">"dijit/layout/BorderContainer"</span>, <span class="string">"dijit/layout/ContentPane"</span>, <span class="string">"dojo/domReady!"</span></span><br><span class="line">      ], <span class="keyword">function</span>(</span><br><span class="line">        Map, ArcGISDynamicMapServiceLayer,FeatureLayer, TimeExtent, TimeInfo,</span><br><span class="line">        ClassBreaksRenderer,</span><br><span class="line">        SimpleMarkerSymbol, SimpleLineSymbol,</span><br><span class="line">        TemplatePicker, TimeSlider,</span><br><span class="line">        TimeClassBreaksAger, TemporalRenderer,</span><br><span class="line">        parser, arrayUtils, Color, dom, date</span><br><span class="line">      ) &#123;</span><br><span class="line">        parser.parse();</span><br><span class="line"></span><br><span class="line">        map = new Map(<span class="string">"map"</span>, &#123;</span><br><span class="line">          basemap: <span class="string">"satellite"</span>,</span><br><span class="line">          center: [114.0143, 34.11075],</span><br><span class="line">          slider: <span class="literal">false</span>,</span><br><span class="line">          zoom:15</span><br><span class="line">        &#125;);</span><br><span class="line">        //边界</span><br><span class="line">          var research_scope = new ArcGISDynamicMapServiceLayer(<span class="string">"http://localhost:6080/arcgis/rest/services/Henan_S/research_scope1/MapServer"</span>,&#123;<span class="string">"id"</span>:<span class="string">"100000"</span>&#125;);</span><br><span class="line">        map.on(<span class="string">"load"</span>, mapLoaded);   </span><br><span class="line"></span><br><span class="line">        <span class="keyword">function</span> <span class="function"><span class="title">mapLoaded</span></span>() &#123;</span><br><span class="line">            var SOMtlj = new ArcGISDynamicMapServiceLayer(<span class="string">"http://localhost:6080/arcgis/rest/services/Henan_S/PH1_TLJ/MapServer"</span>,&#123;<span class="string">"id"</span>:<span class="string">"3"</span>&#125;);</span><br><span class="line">            SOMtlj.on(<span class="string">"load"</span>, featureLayerLoaded);</span><br><span class="line">            map.addLayer(SOMtlj);</span><br><span class="line">            map.addLayer(research_scope);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">function</span> <span class="function"><span class="title">featureLayerLoaded</span></span>() &#123;</span><br><span class="line">          // create time slider</span><br><span class="line">          var timeSlider = new TimeSlider(&#123; style: <span class="string">"width: 100%;"</span>&#125;, dom.byId(<span class="string">"timeSliderDiv"</span>));</span><br><span class="line">          map.setTimeSlider(timeSlider);</span><br><span class="line"></span><br><span class="line">          timeExtent = new TimeExtent();</span><br><span class="line">          </span><br><span class="line">          // 设置时区后，开始时间和结束时间</span><br><span class="line">          //timeExtent.startTime = new Date(<span class="string">"2019/06/06 23:59:00 UTC"</span>);</span><br><span class="line">          //timeExtent.endTime = new Date(<span class="string">"2019/06/07 05:52:00 UTC"</span>);</span><br><span class="line"></span><br><span class="line">          timeSlider.setThumbCount(1);</span><br><span class="line">          timeSlider.createTimeStopsByTimeInterval(timeExtent, 1, <span class="string">"esriTimeUnitsMinutes"</span>); </span><br><span class="line">        </span><br><span class="line">          timeSlider.setThumbIndexes([0]);</span><br><span class="line">          timeSlider.on(<span class="string">"time-extent-change"</span>, displayTimeInfo);</span><br><span class="line">          timeSlider.startup();</span><br><span class="line">           // timeSlider.play();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">function</span> displayTimeInfo(timeExtent) &#123;</span><br><span class="line">          var info = timeExtent.endTime;</span><br><span class="line">          dom.byId(<span class="string">"timeInfo"</span>).innerHTML = info;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">  &lt;body class=<span class="string">"claro"</span>&gt;</span><br><span class="line">    &lt;div id=<span class="string">"mainWindow"</span> </span><br><span class="line">         data-dojo-type=<span class="string">"dijit/layout/BorderContainer"</span> </span><br><span class="line">         data-dojo-propx=<span class="string">"design:'sidebar', gutters:true"</span> </span><br><span class="line">         style=<span class="string">"width:100%; height:100%;"</span>&gt;</span><br><span class="line">     &lt;div id=<span class="string">"header"</span> </span><br><span class="line">          data-dojo-type=<span class="string">"dijit/layout/ContentPane"</span> </span><br><span class="line">          data-dojo-props=<span class="string">"region:'top'"</span> </span><br><span class="line">          class=<span class="string">"dijitBorders"</span> style=<span class="string">"height:100px;"</span>&gt;</span><br><span class="line">      &lt;center&gt;</span><br><span class="line">        &lt;span class=<span class="string">"headerText"</span>&gt;采样时序&lt;/span&gt;</span><br><span class="line">        &lt;div id=<span class="string">"timeInfo"</span> class=<span class="string">"labelText"</span>&gt;&lt;/div&gt;</span><br><span class="line">        &lt;div id=<span class="string">"timeSliderDiv"</span> &gt;&lt;/div&gt;</span><br><span class="line">      &lt;/center&gt;</span><br><span class="line">     &lt;/div&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;div id=<span class="string">"map"</span> data-dojo-type=<span class="string">"dijit/layout/ContentPane"</span> </span><br><span class="line">           data-dojo-props=<span class="string">"region:'center'"</span> class=<span class="string">"dijitBorders"</span> </span><br><span class="line">           style=<span class="string">"background-color:inherit;"</span>&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;div id=<span class="string">"right"</span> data-dojo-type=<span class="string">"dijit/layout/ContentPane"</span> </span><br><span class="line">           data-dojo-props=<span class="string">"region:'left'"</span> </span><br><span class="line">           style=<span class="string">"width:100px;font-size:small;"</span>&gt;</span><br><span class="line"></span><br><span class="line">          &lt;center&gt;&lt;span class=<span class="string">"labelText"</span>&gt;Age&lt;/span&gt;&lt;/center&gt;</span><br><span class="line">          &lt;div id=<span class="string">"ageDiv"</span> class=<span class="string">"dijitBorders"</span>&gt;&lt;/div&gt;</span><br><span class="line">          &lt;center&gt;&lt;span class=<span class="string">"labelText"</span>&gt;Magnitude&lt;/span&gt;&lt;/center&gt;</span><br><span class="line">          &lt;div id=<span class="string">"magnitudeDiv"</span> class=<span class="string">"dijitBorders"</span> &gt;&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      </span><br><span class="line">     &lt;/div&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

                
                <div class="readmore">
                    <a href="/2019/08/23/时序动画/">
                        阅读更多
                    </a>
                </div>
            </div>
        
            <div class="post-item">
                <h1>
                    <a href="/2019/08/15/vuex/">
                        vuex
                    </a>
                </h1>
                <div class="create">
                    <span>创建于</span>
                    
                        <time datetime="2019-08-15T03:20:43.000Z">
                            2019-08-15
                        </time>
                    
                    <ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/VUE/">VUE</a></li></ul>
                </div>
                
                    <p>Vuex 是一个专为 Vue.js 应用程序开发的状态管理模式<br>大型项目，涉及复杂的交互时，用vuex</p>

                
                <div class="readmore">
                    <a href="/2019/08/15/vuex/">
                        阅读更多
                    </a>
                </div>
            </div>
        
            <div class="post-item">
                <h1>
                    <a href="/2019/08/13/node5/">
                        Express
                    </a>
                </h1>
                <div class="create">
                    <span>创建于</span>
                    
                        <time datetime="2019-08-13T03:07:47.000Z">
                            2019-08-13
                        </time>
                    
                    <ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Node/">Node</a></li></ul>
                </div>
                
                    <h3 id="Express框架"><a href="#Express框架" class="headerlink" title="Express框架"></a>Express框架</h3><p>1.依赖中间件<br>2.接受请求<br>3.非破坏式的<br>4.static用法</p>
<h4 id="安装、配置、接受请求、响应"><a href="#安装、配置、接受请求、响应" class="headerlink" title="安装、配置、接受请求、响应"></a>安装、配置、接受请求、响应</h4><p>安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express</span><br></pre></td></tr></table></figure></p>
<p>使用</p>
<ul>
<li>创建服务</li>
<li>监听</li>
<li>处理请求<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const express = require(<span class="string">'express'</span>);</span><br><span class="line">var server = express();</span><br><span class="line">server.use(<span class="string">'/a.html'</span>,<span class="keyword">function</span>(req,res)&#123;</span><br><span class="line">    res.send(<span class="string">'abc'</span>);                          //send和write类似</span><br><span class="line">    res.end();</span><br><span class="line">&#125;);</span><br><span class="line">server.use(<span class="string">'/b.html'</span>,<span class="keyword">function</span>(req,res)&#123;</span><br><span class="line">    res.send(<span class="string">'123'</span>);</span><br><span class="line">    res.end();</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(8080);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>express保留了原生的功能，添加了一些方法，增强原有的功能。</p>
<h4 id="3种方法"><a href="#3种方法" class="headerlink" title="3种方法"></a>3种方法</h4><p>get(处理get请求)\post(处理post请求)\use(get,post均可)。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const express = require(<span class="string">'express'</span>);</span><br><span class="line">var server = express();</span><br><span class="line">server.get(<span class="string">'/'</span>,<span class="keyword">function</span>(req,res)&#123;</span><br><span class="line">    console.log(<span class="string">'get请求'</span>)</span><br><span class="line">&#125;);</span><br><span class="line">server.post(<span class="string">'/'</span>,<span class="keyword">function</span>(req,res)&#123;</span><br><span class="line">    console.log(<span class="string">'post请求'</span>)</span><br><span class="line">&#125;);</span><br><span class="line">server.use(<span class="string">'/'</span>,<span class="keyword">function</span>(req,res)&#123;</span><br><span class="line">    console.log(<span class="string">'use了'</span>)</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(8080);</span><br></pre></td></tr></table></figure></p>
<h4 id="Express-static"><a href="#Express-static" class="headerlink" title="Express-static"></a>Express-static</h4><p>读取静态文件<br>安装 npm install express-static -save</p>
<p>实例-登录<br>a.html:<br><img src="/2019/08/13/node5/01.png" alt="01.png"><br>server.js<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">const express = require(<span class="string">'express'</span>);</span><br><span class="line">const expressStatic = require(<span class="string">'express-static'</span>);</span><br><span class="line"></span><br><span class="line">var server = express();</span><br><span class="line">server.listen(8080);</span><br><span class="line"></span><br><span class="line">//用户数据模拟</span><br><span class="line">var users=&#123;</span><br><span class="line">    <span class="string">'blue'</span>:<span class="string">'123456'</span>,</span><br><span class="line">    <span class="string">'zhangsan'</span>:<span class="string">'654321'</span>,</span><br><span class="line">    <span class="string">'lisi'</span>:<span class="string">'987678'</span></span><br><span class="line">&#125;;</span><br><span class="line">server.get(<span class="string">'/login'</span>,<span class="keyword">function</span>(req,res)&#123;</span><br><span class="line">    // urlLib.parse(req.url,<span class="literal">true</span>).query;</span><br><span class="line">    console.log(req.query)</span><br><span class="line">    var user= req.query[<span class="string">'user'</span>];</span><br><span class="line">    var pass= req.query[<span class="string">'pass'</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(users[user]==null)&#123;</span><br><span class="line">        res.send(&#123;ok:<span class="literal">false</span>,mag:<span class="string">'此用户不存在'</span>&#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(users[user]!=pass)&#123;</span><br><span class="line">            res.send(&#123;ok:<span class="literal">false</span>,msg:<span class="string">'密码错了'</span>&#125;)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            res.send(&#123;ok:<span class="literal">true</span>,mag:<span class="string">'成功'</span>&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">server.use(expressStatic(<span class="string">'./www'</span>));</span><br></pre></td></tr></table></figure></p>
<h3 id="数据解析"><a href="#数据解析" class="headerlink" title="数据解析"></a>数据解析</h3><p>get请求数据解析,无需中间件:req.query<br>post请求数据解析，需中间件：body-parser，首先解析数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&apos;express&apos;);</span><br><span class="line">const bodyParser = require(&apos;body-parser&apos;);</span><br><span class="line"></span><br><span class="line">var server = express();</span><br><span class="line">server.listen(8080);</span><br><span class="line"></span><br><span class="line">server.use(bodyParser.urlencoded(&#123;</span><br><span class="line">    extended:true,      //扩展模式</span><br><span class="line">    limit: 2*1024       //限制2M，默认100k</span><br><span class="line">&#125;));</span><br><span class="line">server.use(&apos;/&apos;,function(req,res)&#123;</span><br><span class="line">    console.log(req.body)  //POST</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h4 id="链式操作"><a href="#链式操作" class="headerlink" title="链式操作"></a>链式操作</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&apos;express&apos;);</span><br><span class="line"></span><br><span class="line">var server = express();</span><br><span class="line">server.listen(8080);</span><br><span class="line"></span><br><span class="line">//第三个参数</span><br><span class="line">server.use(&apos;/&apos;,function(req,res,next)&#123;</span><br><span class="line">    console.log(&apos;a&apos;)</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br><span class="line">server.use(&apos;/&apos;,function(req,res.next)&#123;</span><br><span class="line">    console.log(&apos;b&apos;)  </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>中间件,类似’body-parser’<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&apos;express&apos;);</span><br><span class="line">const querystring = require(&apos;querystring&apos;);</span><br><span class="line"></span><br><span class="line">var server = express();</span><br><span class="line">server.listen(8080);</span><br><span class="line"></span><br><span class="line">//第三个参数</span><br><span class="line">server.use(function(req,res,next)&#123;</span><br><span class="line">    var str=&apos;&apos;;</span><br><span class="line">    req.on(&apos;data&apos;,function(data)&#123;</span><br><span class="line">        str+=data;</span><br><span class="line">    &#125;);</span><br><span class="line">    req.on(&apos;end&apos;,function(data)&#123;</span><br><span class="line">        req.body=querystring(str);</span><br><span class="line">        next();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">server.use(&apos;/&apos;,function(req,res.next)&#123;</span><br><span class="line">    console.log(&apos;b&apos;)  </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h3 id="cookie、session"><a href="#cookie、session" class="headerlink" title="cookie、session"></a>cookie、session</h3><ul>
<li>a.发送cookie<br>res.cookie(名字,值,maxAge:毫秒,signed:true)</li>
<li>b.读取cookie<br>cookie-parser<br>server.use(cookieParser(‘秘钥’))<br>server.use(function(){<br>  req.cookie   //未签名<br>  req.signedCookies   //签名版<br>})</li>
<li>c.删除cookie<br>res.clearCookie(名字)</li>
</ul>
<p>保存数据，cookie数据保存浏览器，session 数据保存在服务器。<br>npm install cookie-parser cookie-session<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const express = require(<span class="string">'express'</span>);</span><br><span class="line">const cookieParser = require(<span class="string">'cookie-parser'</span>);</span><br><span class="line"></span><br><span class="line">var server = express();</span><br><span class="line">//发送cookie</span><br><span class="line">server.use(<span class="string">'/aaa/a.html'</span>,<span class="keyword">function</span>(req,res)&#123;</span><br><span class="line">    res.cookie(<span class="string">'user'</span>,<span class="string">'blue'</span>,&#123;path:<span class="string">'/aaa'</span>,<span class="string">'maxAge'</span>:3*24*3600*1000&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">//读取cookie</span><br><span class="line">server.use(cookieParser())；</span><br><span class="line">server.use(<span class="string">'/'</span>,<span class="keyword">function</span>(req,res)&#123;</span><br><span class="line">    console.log(req.cookie)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>实现cookie加密：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const express = require(<span class="string">'express'</span>);</span><br><span class="line">const cookieParser = require(<span class="string">'cookie-parser'</span>);</span><br><span class="line"></span><br><span class="line">var server = express();</span><br><span class="line">//cookieParser</span><br><span class="line">server.use(cookieParser);</span><br><span class="line">server.use(<span class="string">'/'</span>,<span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">    req.secret=<span class="string">'hdwifbonfjfosdjhfsj'</span>;</span><br><span class="line">    res.cookie(<span class="string">'user'</span>,<span class="string">'blue'</span>,&#123;signed:<span class="literal">true</span>&#125;);</span><br><span class="line"></span><br><span class="line">    res.send(<span class="string">'ok'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(8080);</span><br></pre></td></tr></table></figure></p>
<p>session</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const express = require(<span class="string">'express'</span>);</span><br><span class="line">const cookieSession = require(<span class="string">'cookie-session'</span>);</span><br><span class="line"></span><br><span class="line">var server = express();</span><br><span class="line">//cookie</span><br><span class="line">server.use(cookieParser(<span class="string">'dnkfvbscsvius'</span>));</span><br><span class="line">server.use(cookieSession());</span><br><span class="line"></span><br><span class="line">server.use(<span class="string">'/'</span>,<span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">    req.secret=<span class="string">'hdwifbonfjfosdjhfsj'</span>;</span><br><span class="line">    res.cookie(<span class="string">'user'</span>,<span class="string">'blue'</span>,&#123;signed:<span class="literal">true</span>&#125;);</span><br><span class="line"></span><br><span class="line">    res.send(<span class="string">'ok'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(8080);</span><br></pre></td></tr></table></figure>
<h3 id="express框架整合"><a href="#express框架整合" class="headerlink" title="express框架整合"></a>express框架整合</h3><p><img src="/2019/08/13/node5/02.png" alt="02.png"><br><img src="/2019/08/13/node5/03.png" alt="03.png"></p>
<h4 id="multer模块上传文件"><a href="#multer模块上传文件" class="headerlink" title="multer模块上传文件"></a>multer模块上传文件</h4><p>npm install multer</p>
<ul>
<li>body-parser:解析post数据  (application/x-form-urlencoded)<br>server.use(bodyParse.urlencode());</li>
<li>multer:解析post文件   (multipart/form-data)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">//上传到磁盘  重命名</span><br><span class="line"></span><br><span class="line">const multer = require(<span class="string">'multer'</span>);</span><br><span class="line">const pathLib = require(<span class="string">'path'</span>);</span><br><span class="line">const fs = require(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//1、pathLib解析获取原始文件扩展名</span><br><span class="line">    var str=<span class="string">'c:\\wamp\www\a.html'</span>;</span><br><span class="line">    var obj=path.parse(str);</span><br><span class="line"></span><br><span class="line">    base :文件名<span class="string">"a.html"</span></span><br><span class="line">    ext:扩展名<span class="string">"html"</span></span><br><span class="line">    dir:路径<span class="string">'c:\\wamp\www'</span></span><br><span class="line">    name:文件名<span class="string">"a"</span></span><br><span class="line"></span><br><span class="line">//2.fs的rename重命名</span><br><span class="line">    fs.rename(<span class="string">'a.txt'</span>,<span class="string">'b.txt'</span>,<span class="keyword">function</span>(err)&#123;</span><br><span class="line">        console.log(err)</span><br><span class="line">    &#125;)</span><br><span class="line">    fs.rename(老名，新名，<span class="keyword">function</span>(err)&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">var obj=multer(&#123;dest:<span class="string">'./www/upload/'</span>&#125;)  //文件保存的位置</span><br><span class="line"></span><br><span class="line">server.use(obj.any())       //接受任意类型文件</span><br><span class="line">//只接收name=f1的文件 : server.use(obj.single(<span class="string">'f1'</span>))  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//req.files:指上传的文件信息，如下图：</span><br><span class="line">server.use(<span class="keyword">function</span>(req,res)&#123;</span><br><span class="line">    var newName = req.file[0].path+pathLib.parse(req.file[0].originalname).ext</span><br><span class="line">    fs.rename(req.file[0].path,newName,<span class="keyword">function</span>()(err)&#123;</span><br><span class="line">        <span class="keyword">if</span>(err)</span><br><span class="line">            res.send(<span class="string">'上传失败'</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            res.send(<span class="string">'上传成功'</span>)</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/2019/08/13/node5/05.png" alt="05.png"><br><img src="/2019/08/13/node5/06.png" alt="06.png"></p>
<ul>
<li>html文件：</li>
</ul>
<p><img src="/2019/08/13/node5/04.png" alt="04.png"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">'http://localhost:8080/'</span> method=<span class="string">'post'</span> enctype=<span class="string">'multipart/form-data'</span>&gt;</span><br><span class="line">    &lt;input <span class="built_in">type</span>=<span class="string">'file'</span>/&gt;</span><br><span class="line">    &lt;input <span class="built_in">type</span>=<span class="string">'submit'</span> value=<span class="string">'上传/&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="consolidate-模板引擎整合库"><a href="#consolidate-模板引擎整合库" class="headerlink" title="consolidate 模板引擎整合库"></a>consolidate 模板引擎整合库</h3><p>安装：npm install consolidate<br>引用：const consolidate = require(‘consolidate’);<br>配置模板引擎：</p>
<ul>
<li>我要输出什么东西<br>server.set(‘view engine’,’html’)</li>
<li>模板文件放在哪里<br>server.set(‘view’,’./views’)</li>
<li>哪种模板引擎<br>server.engine(‘html’,consolidate.ejs)</li>
</ul>
<p>server.get(‘/‘,function(req,res){<br>    res.render(‘模板文件’，数据);<br>})</p>
<h3 id="route路由"><a href="#route路由" class="headerlink" title="route路由"></a>route路由</h3><p>根据目录的不同，调用不同的模块</p>
<p>const express = require(‘express’);</p>
<p>var server=express();</p>
<p>var routeUser =express.Route();<br>routeUser.get(‘1.html’,function(req,res){<br>    res.send(‘user1’)<br>})<br>routeUser.get(‘2.html’,function(req,res){<br>    res.send(‘user2’)<br>})</p>
<p>server.use(‘/user’,routeUser);<br>server.listen(8080);</p>

                
                <div class="readmore">
                    <a href="/2019/08/13/node5/">
                        阅读更多
                    </a>
                </div>
            </div>
        
            <div class="post-item">
                <h1>
                    <a href="/2019/08/11/node4/">
                        node笔记(一)
                    </a>
                </h1>
                <div class="create">
                    <span>创建于</span>
                    
                        <time datetime="2019-08-11T11:48:05.000Z">
                            2019-08-11
                        </time>
                    
                    <ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Node/">Node</a></li></ul>
                </div>
                
                    <h3 id="node"><a href="#node" class="headerlink" title="node"></a>node</h3><p>优势：<br>1、性能好<br>2、跟前台JS配合方便<br>3、NodeJS便于前端学习</p>
<h3 id="http系统模块使用"><a href="#http系统模块使用" class="headerlink" title="http系统模块使用"></a>http系统模块使用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">const http=require(<span class="string">'http'</span>);</span><br><span class="line">var server = http.creatServer(<span class="keyword">function</span>(req,res)&#123;  //创建服务器</span><br><span class="line">    switch(res.url)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"/1.html"</span>:</span><br><span class="line">            res.write(<span class="string">"向前台写东西111"</span>)；</span><br><span class="line">            <span class="built_in">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="string">"/2.html"</span>:</span><br><span class="line">            res.write(<span class="string">"向前台写东西222"</span>)；</span><br><span class="line">            <span class="built_in">break</span>;</span><br><span class="line">        default</span><br><span class="line">            res.write(<span class="string">"404"</span>)；</span><br><span class="line">            <span class="built_in">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    // res.write(<span class="string">"向前台写东西"</span>)；</span><br><span class="line">    res.end();//结束请求</span><br><span class="line">&#125;)</span><br><span class="line">//监听 —— 等着</span><br><span class="line">//端口 —— 数字</span><br><span class="line">server.listen(8888);</span><br></pre></td></tr></table></figure>
<h3 id="fs文件模块"><a href="#fs文件模块" class="headerlink" title="fs文件模块"></a>fs文件模块</h3><p>fs (file system)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//导入引用:</span><br><span class="line">    const fs = require(<span class="string">'fs'</span>);</span><br><span class="line">//1.readFile(文件名，回调函数)</span><br><span class="line">    fs.readFile(<span class="string">'aaa.txt'</span>,<span class="keyword">function</span>(err,data)&#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            console.log(<span class="string">'读取失败'</span>)；</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            console.log(data.toString());//二进制格式用toString转换</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;)</span><br><span class="line">//2.writeFile(文件名，内容，回调函数)</span><br><span class="line">fs.write(<span class="string">"bbb.txt"</span>,<span class="string">"asdfghjkl"</span>,<span class="keyword">function</span>(err)&#123;</span><br><span class="line">    console.log(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>与服务器结合<br>建立www（可以是其他名字）文件夹，用于存放请求的文件。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">const http=require(<span class="string">'http'</span>);</span><br><span class="line">var server = http.creatServer(<span class="keyword">function</span>(req,res)&#123;  //创建服务器</span><br><span class="line">    //req.url = <span class="string">'index.html'</span></span><br><span class="line">    //读取:<span class="string">'./www/index.html'</span></span><br><span class="line">    var file_name = <span class="string">'./www'</span>+req.url</span><br><span class="line">    </span><br><span class="line">    fs.readFile(file_name,<span class="keyword">function</span>(err,data)&#123; //异步</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            res.write(<span class="string">'读取失败'</span>)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            res.write(data)</span><br><span class="line">        &#125;</span><br><span class="line">        res.end();//结束请求，因为异步，res.end()应放在此处</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line">server.listen(8888);</span><br></pre></td></tr></table></figure></p>
<h3 id="http数据解析（get）"><a href="#http数据解析（get）" class="headerlink" title="http数据解析（get）"></a>http数据解析（get）</h3><p>前台发送请求的方式：form/ajax/jsonp<br>后台都是一样。唯有一点不同，请求方式不同，接受方式不一样（get/post）.下面一个实例：<br>GET数据解析：</p>
<ul>
<li>自己切</li>
<li>querystring:</li>
<li>url:urlLib.parse(…,true)</li>
</ul>
<p>server.js 普通写法<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">const http = require(<span class="string">'http'</span>);</span><br><span class="line">http.createServer(<span class="keyword">function</span>(req,res)&#123;</span><br><span class="line">    //req获取前台请求的数据</span><br><span class="line">    var get=&#123;&#125;;</span><br><span class="line">    <span class="keyword">if</span>(req.url.indexOf(<span class="string">'?'</span>) != -1)&#123;</span><br><span class="line">        console.log(req.url); //  /aaa?user=Tom&amp;pass=123456</span><br><span class="line">        var arr = req.url.split(<span class="string">'？'</span>)；// arr[0]=<span class="string">'/aaa'</span>  arr[1]=<span class="string">'user=Tom&amp;pass=123456'</span></span><br><span class="line">        var url=arr[0];</span><br><span class="line">        var arr2 = arr[1].split(<span class="string">'&amp;'</span>); //arr2</span><br><span class="line">        <span class="keyword">for</span>(var i=0;i&lt;arr2.length;i++)&#123;</span><br><span class="line">            var arr3=arr2[i].split(<span class="string">'='</span>)</span><br><span class="line">            get[arr3[0]]=arr3[1];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        var url=req.url;</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(url,get)</span><br><span class="line">    res.end();</span><br><span class="line">&#125;).listen(8080);</span><br></pre></td></tr></table></figure></p>
<p>server.js querystring模块写法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">  //写法如下：</span><br><span class="line">    //const querystring=require(<span class="string">'querystring'</span>);</span><br><span class="line">    //var json = querystring.parse(<span class="string">'user=Tom&amp;pass=123456'</span>)</span><br><span class="line">    //console.log(json)</span><br><span class="line">//server.js改动后：</span><br><span class="line">    const http = require(<span class="string">'http'</span>);</span><br><span class="line">    const querystring=require(<span class="string">'querystring'</span>);</span><br><span class="line">    http.createServer(<span class="keyword">function</span>(req,res)&#123;</span><br><span class="line">        //req获取前台请求的数据</span><br><span class="line">        var get=&#123;&#125;;</span><br><span class="line">        <span class="keyword">if</span>(req.url.indexOf(<span class="string">'?'</span>) != -1)&#123;</span><br><span class="line">            console.log(req.url); //  /aaa?user=Tom&amp;pass=123456</span><br><span class="line">            var arr = req.url.split(<span class="string">'？'</span>)；// arr[0]=<span class="string">'/aaa'</span>  arr[1]=<span class="string">'user=Tom&amp;pass=123456'</span></span><br><span class="line">            var url=arr[0];</span><br><span class="line">            get=querystring.parse(arr[1]);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            var url=req.url;</span><br><span class="line">        &#125;</span><br><span class="line">        console.log(url,get)</span><br><span class="line">        res.end();</span><br><span class="line">    &#125;).listen(8080);</span><br></pre></td></tr></table></figure></p>
<p>server.js url模块写法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//url.js写法</span><br><span class="line">    const urlLib=require(<span class="string">'url'</span>);</span><br><span class="line">    var obj= urlLib.parse(<span class="string">"http://www.aaa.bbb/index.html?a=12&amp;b=55"</span>,<span class="literal">true</span>);  第二个参数为<span class="literal">true</span>时，会把pathname等解析为json.</span><br><span class="line">    console.log(obj.pathname,obj.query);</span><br><span class="line">//server.js改动后：</span><br><span class="line">    const http = require(<span class="string">'http'</span>);</span><br><span class="line">    http.createServer(<span class="keyword">function</span>(req,res)&#123;</span><br><span class="line">        //req获取前台请求的数据</span><br><span class="line">        var obj = urlLib.parse(req.url,<span class="literal">true</span>);</span><br><span class="line">        var url=obj.pathname;</span><br><span class="line">        var get=obj.query;</span><br><span class="line"></span><br><span class="line">        console.log(url,get)</span><br><span class="line">        res.end();</span><br><span class="line">    &#125;).listen(8080);</span><br></pre></td></tr></table></figure></p>
<p>form.html<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form action=<span class="string">"http://localhost:8080/aaa"</span> method=<span class="string">"get"</span>&gt;</span><br><span class="line">        用户：</span><br><span class="line">        &lt;input <span class="built_in">type</span>=<span class="string">"text"</span> name=<span class="string">"user"</span> value=<span class="string">''</span>&gt; &lt;br&gt;</span><br><span class="line">        &lt;input <span class="built_in">type</span>=<span class="string">"password"</span> name=<span class="string">"pass"</span> value=<span class="string">''</span>&gt; &lt;br&gt;</span><br><span class="line">        &lt;input <span class="built_in">type</span>=<span class="string">"submit"</span> value=<span class="string">'提交'</span></span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="http数据解析（post）"><a href="#http数据解析（post）" class="headerlink" title="http数据解析（post）"></a>http数据解析（post）</h3><p>POST数据接收：POST数据比GET数据大的多,根据数据量大小分段完成<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const http=require(<span class="string">'http'</span>);</span><br><span class="line">const querystring=require(<span class="string">'querystring'</span>);</span><br><span class="line">http.creatServer(<span class="keyword">function</span>(req,res)&#123;</span><br><span class="line">        //POST--req</span><br><span class="line">    var str=<span class="string">''</span>;  //接受数据</span><br><span class="line"></span><br><span class="line">        //data--有一段数据到达（很多次）</span><br><span class="line">    req.on(<span class="string">'data'</span>,<span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">        str+=data</span><br><span class="line">    &#125;);</span><br><span class="line">        //end--数据全部到达（一次）</span><br><span class="line">    req.on(<span class="string">'end'</span>,<span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">        var post = querystring.parse(str);</span><br><span class="line">        console.log(post)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;).listen(8080);</span><br></pre></td></tr></table></figure></p>
<h3 id="应用1-简易httpServer搭建-用户注册登录-略"><a href="#应用1-简易httpServer搭建-用户注册登录-略" class="headerlink" title="应用1:简易httpServer搭建,用户注册登录(略)"></a>应用1:简易httpServer搭建,用户注册登录(略)</h3><h3 id="nodeJS模块化"><a href="#nodeJS模块化" class="headerlink" title="nodeJS模块化"></a>nodeJS模块化</h3><h4 id="系统模块介绍"><a href="#系统模块介绍" class="headerlink" title="系统模块介绍"></a>系统模块介绍</h4><p>除了以上用到的：http、querystring、url,还有：</p>
<ul>
<li>Crypto 加密</li>
<li>Event 事件</li>
<li>Net 网络操作</li>
<li>OS 操作系统信息</li>
<li>Path 处理文件路径</li>
<li>Stream 流操作</li>
<li>Timer 定时器</li>
<li>ZLIB 压缩</li>
</ul>
<h4 id="自定义模块"><a href="#自定义模块" class="headerlink" title="自定义模块"></a>自定义模块</h4><p>关于引入模块写法：若为当前目录自己的模块，加上“./”,系统模块要加。<br>若想要输出东西，必须exports。<br>若都输出多个东西，module可实现批量输出。</p>
<ul>
<li>require:请求引入其他模块。</li>
<li>module:批量输出。</li>
<li>exports:输出。</li>
<li>module.exports == exports。</li>
<li>const aaa = require(‘./bbb.js’); 其中“.js”可省略。</li>
</ul>
<p>npm:nodejs package manager(nodejs包管理器)<br>1、统计下载途径<br>2、自动下载依赖</p>
<p>npm init<br>npm publish<br>npm update<br>npm unpublish<br>npm –force unpublish</p>
<p><img src="/2019/08/11/node4/01.png" alt="01.png"></p>
<p>node_modules:放模块，可以放自己定义的模块，此时若引用，不加“./”</p>
<blockquote>
<p>总结：require引入模块，若有“./”,从当前目录找，若没有“./”，从系统模块或node_modules找。<br>模块优先级：系统&gt;node_modules,一般将自定义模块放在node_modules中。</p>
</blockquote>

                
                <div class="readmore">
                    <a href="/2019/08/11/node4/">
                        阅读更多
                    </a>
                </div>
            </div>
        
            <div class="post-item">
                <h1>
                    <a href="/2019/08/11/apply-and-bind/">
                        apply and bind
                    </a>
                </h1>
                <div class="create">
                    <span>创建于</span>
                    
                        <time datetime="2019-08-11T02:36:27.000Z">
                            2019-08-11
                        </time>
                    
                    <ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/基础前端技术/">基础前端技术</a></li></ul>
                </div>
                
                    <p>本篇主要解决一下几个问题：</p>
<ul>
<li>1.apply和call的区别在哪里</li>
<li>2.什么情况下用apply,什么情况下用call</li>
<li>3.apply的其他巧妙用法（一般在什么情况下可以使用apply）*</li>
</ul>
<p><font color="red"> apply:方法能劫持另外一个对象的方法，继承另外一个对象的属性.</font></p>
<blockquote>
<p>Function.apply(obj,args)方法能接收两个参数<br>obj：这个对象将代替Function类里this对象<br>args：这个是数组，它将作为参数传给Function（args–&gt;arguments）</p>
</blockquote>
<p>call:和apply的意思一样,只不过是参数列表不一样.</p>
<blockquote>
<p>Function.call(obj,[param1[,param2[,…[,paramN]]]])<br>obj：这个对象将代替Function类里this对象<br>params：这个是一个参数列表</p>
</blockquote>
<h4 id="apply示例"><a href="#apply示例" class="headerlink" title="apply示例:"></a>apply示例:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;script <span class="built_in">type</span>=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">    /*定义一个人类*/</span><br><span class="line">    <span class="keyword">function</span> Person(name,age)</span><br><span class="line">    &#123;</span><br><span class="line">        this.name=name;</span><br><span class="line">        this.age=age;</span><br><span class="line">    &#125;</span><br><span class="line">    /*定义一个学生类*/</span><br><span class="line">    functionStudent(name,age,grade)</span><br><span class="line">    &#123;</span><br><span class="line">        Person.apply(this,arguments);</span><br><span class="line">        this.grade=grade;</span><br><span class="line">    &#125;</span><br><span class="line">    //创建一个学生类</span><br><span class="line">    var student=new Student(<span class="string">"qian"</span>,21,<span class="string">"一年级"</span>);</span><br><span class="line">    //测试</span><br><span class="line">    alert(<span class="string">"name:"</span>+student.name+<span class="string">"\n"</span>+<span class="string">"age:"</span>+student.age+<span class="string">"\n"</span>+<span class="string">"grade:"</span>+student.grade);</span><br><span class="line">    //大家可以看到测试结果name:qian  age:21  grade:一年级</span><br><span class="line">    //学生类里面我没有给name和age属性赋值啊,为什么又存在这两个属性的值呢,这个就是apply的神奇之处.</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>分析: Person.apply(this,arguments);</p>
<ul>
<li>this:在创建对象在这个时候代表的是student</li>
<li>arguments:是一个数组,也就是[“qian”,”21”,”一年级”];<br>也就是通俗一点讲就是:用student去执行Person这个类里面的内容,在Person这个类里面存在this.name等之类的语句,这样就将属性创建到了student对象里面</li>
</ul>
<h4 id="call示例"><a href="#call示例" class="headerlink" title="call示例"></a>call示例</h4><p>在Studen函数里面可以将apply中修改成如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Person.call(this,name,age);</span><br></pre></td></tr></table></figure></p>
<h4 id="什么情况下用apply-什么情况下用call"><a href="#什么情况下用apply-什么情况下用call" class="headerlink" title="什么情况下用apply,什么情况下用call"></a>什么情况下用apply,什么情况下用call</h4><p>在给对象参数的情况下,如果参数的形式是数组的时候,比如apply示例里面传递了参数arguments,这个参数是数组类型,并且在调用Person的时候参数的列表是对应一致的(也就是Person和Student的参数列表前两位是一致的) 就可以采用 apply , 如果我的Person的参数列表是这样的(age,name),而Student的参数列表是(name,age,grade),这样就可以用call来实现了,也就是直接指定参数列表对应值的位置(Person.call(this,age,name,grade));</p>
<h4 id="apply的一些其他巧妙用法"><a href="#apply的一些其他巧妙用法" class="headerlink" title="apply的一些其他巧妙用法"></a>apply的一些其他巧妙用法</h4><p>细心的人可能已经察觉到,在我调用apply方法的时候,第一个参数是对象(this), 第二个参数是一个数组集合, 在调用Person的时候,他需要的不是一个数组,但是为什么他给我一个数组我仍然可以将数组解析为一个一个的参数,这个就是apply的一个巧妙的用处,可以将一个数组默认的转换为一个参数列表([param1,param2,param3] 转换为 param1,param2,param3) 这个如果让我们用程序来实现将数组的每一个项,来装换为参数的列表,可能都得费一会功夫,借助apply的这点特性,所以就有了以下高效率的方法:</p>
<p>a) Math.max 可以实现得到数组中最大的一项</p>
<p>因为Math.max参数里面不支持Math.max([param1,param2])也就是数组但是它支持Math.max(param1,param2,param3…),所以可以根据刚才apply的那个特点来解决 var max=Math.max.apply(null,array),这样轻易的可以得到一个数组中最大的一项(apply会将一个数组装换为一个参数接一个参数的传递给方法)<br>这块在调用的时候第一个参数给了一个null,这个是因为没有对象去调用这个方法,我只需要用这个方法帮我运算,得到返回的结果就行,.所以直接传递了一个null过去</p>
<p>b) Math.min  可以实现得到数组中最小的一项同样和 max是一个思想 var min=Math.min.apply(null,array);</p>
<p>c) Array.prototype.push 可以实现两个数组合并</p>
<p>同样push方法没有提供push一个数组,但是它提供了push(param1,param,…paramN) 所以同样也可以通过apply来装换一下这个数组,即:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vararr1=new Array(<span class="string">"1"</span>,<span class="string">"2"</span>,<span class="string">"3"</span>);</span><br><span class="line">vararr2=new Array(<span class="string">"4"</span>,<span class="string">"5"</span>,<span class="string">"6"</span>);</span><br><span class="line">Array.prototype.push.apply(arr1,arr2);</span><br></pre></td></tr></table></figure></p>

                
                <div class="readmore">
                    <a href="/2019/08/11/apply-and-bind/">
                        阅读更多
                    </a>
                </div>
            </div>
        
            <div class="post-item">
                <h1>
                    <a href="/2019/08/10/node3/">
                        node基础(三)
                    </a>
                </h1>
                <div class="create">
                    <span>创建于</span>
                    
                        <time datetime="2019-08-10T09:41:11.000Z">
                            2019-08-10
                        </time>
                    
                    <ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Node/">Node</a></li></ul>
                </div>
                
                    <h3 id="什么是node-js"><a href="#什么是node-js" class="headerlink" title="什么是node.js"></a>什么是node.js</h3><p>编写高性能网络服务器的JS工具包（用js开发服务端程序）<br>单线程、异步、事件驱动<br>特点：快、耗内存</p>
<h4 id="框架"><a href="#框架" class="headerlink" title="框架"></a>框架</h4><p>express、koa、Hapi、以及express基础上的sails</p>
<h3 id="node的安装"><a href="#node的安装" class="headerlink" title="node的安装"></a>node的安装</h3><p><a href="http://nodejs.cn/" target="_blank" rel="noopener">http://nodejs.cn/</a><br>是否成功：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node -v  </span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure></p>
<h4 id="第一个hello程序"><a href="#第一个hello程序" class="headerlink" title="第一个hello程序"></a>第一个hello程序</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var http = require(<span class="string">'http'</span>);</span><br><span class="line">http.createServer(<span class="keyword">function</span>(request,response)&#123;</span><br><span class="line">    response.writeHead(200,&#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html; charset=utf-8'</span>&#125;);</span><br><span class="line">    <span class="keyword">if</span> (request.url!==<span class="string">"/favicon.ico"</span>) &#123;   //清除第二次访问</span><br><span class="line">        console.log(<span class="string">'访问'</span>);</span><br><span class="line">        response.write(<span class="string">'hello,world'</span>);</span><br><span class="line">        response.end(<span class="string">'你好，世界'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).listen(8000);</span><br><span class="line">console.log(<span class="string">'Server running at http://localhost:8000/'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="调用函数"><a href="#调用函数" class="headerlink" title="调用函数"></a>调用函数</h3><ul>
<li>调用本地函数</li>
<li>调用其他js文件中的函数</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">var http = require(<span class="string">'http'</span>);</span><br><span class="line"> var otherfun = require(<span class="string">"./models/other_func.js"</span>);</span><br><span class="line"> http.createServer(<span class="keyword">function</span>(request,response)&#123;</span><br><span class="line">    response.writeHead(200,&#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html; charset=utf-8'</span>&#125;);</span><br><span class="line">    <span class="keyword">if</span> (request.url!==<span class="string">"/favicon.ico"</span>) &#123;</span><br><span class="line">        //fun1(response);</span><br><span class="line">        otherfun.fun2(response);</span><br><span class="line">        otherfun.fun3(response);</span><br><span class="line"></span><br><span class="line">          //用字符串调用对应函数</span><br><span class="line">        // otherfun.fun2(response);</span><br><span class="line">        // otherfun.fun3(response);</span><br><span class="line"></span><br><span class="line">        funname = <span class="string">'fun3'</span>;</span><br><span class="line">        otherfun[funname](response);</span><br><span class="line"></span><br><span class="line">        response.end(<span class="string">''</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).listen(8000);</span><br><span class="line">console.log(<span class="string">'Server running at http://10.75.68.123:8000/'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> fun1(res)&#123;       // 本文件函数</span><br><span class="line">    console.log(<span class="string">"fun1"</span>);</span><br><span class="line">    res.write(<span class="string">"hello,我是fun1"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关于被调用的函数：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//只支持一个函数</span><br><span class="line"><span class="keyword">function</span> fun2(res)&#123;</span><br><span class="line">    console.log(<span class="string">"fun2"</span>);</span><br><span class="line">    res.write(<span class="string">"hello,我是fun2"</span>);</span><br><span class="line">&#125;</span><br><span class="line">module.exports = fun2;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">    //支持多个函数</span><br><span class="line">module.exports=&#123;</span><br><span class="line">    fun2:<span class="keyword">function</span>(res)&#123;</span><br><span class="line">        console.log(<span class="string">"fun2"</span>);</span><br><span class="line">        res.write(<span class="string">"hello,我是fun2"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    fun3:<span class="keyword">function</span>(res)&#123;</span><br><span class="line">        console.log(<span class="string">"fun3"</span>);</span><br><span class="line">        res.write(<span class="string">"hello,我是fun3"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="调用模块"><a href="#调用模块" class="headerlink" title="调用模块"></a>调用模块</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> var http = require(<span class="string">'http'</span>);</span><br><span class="line"> // var User = require(<span class="string">"./models/User"</span>);</span><br><span class="line"> var Teacher = require(<span class="string">"./models/Teacher"</span>);</span><br><span class="line"></span><br><span class="line"> http.createServer(<span class="keyword">function</span>(request,response)&#123;</span><br><span class="line">    response.writeHead(200,&#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html; charset=utf-8'</span>&#125;);</span><br><span class="line">    <span class="keyword">if</span> (request.url!==<span class="string">"/favicon.ico"</span>) &#123;</span><br><span class="line">        teacher = new Teacher(1,<span class="string">"张三"</span>,20);</span><br><span class="line">        teacher.enter();</span><br><span class="line">        teacher.teach(response);</span><br><span class="line">        // user.id=1;</span><br><span class="line">        // user.name=<span class="string">"张三"</span>;</span><br><span class="line">        // user.age=20;</span><br><span class="line">        // user.enter();</span><br><span class="line">        response.end(<span class="string">''</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).listen(8000);</span><br><span class="line">console.log(<span class="string">'Server running at http://localhost:8000/'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="路由初步"><a href="#路由初步" class="headerlink" title="路由初步"></a>路由初步</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> var http = require(<span class="string">'http'</span>);</span><br><span class="line"> var url = require(<span class="string">"url"</span>);</span><br><span class="line"> var router = require(<span class="string">"./router"</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="keyword">function</span>(request,response)&#123;</span><br><span class="line">    response.writeHead(200,&#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html; charset=utf-8'</span>&#125;);</span><br><span class="line">    <span class="keyword">if</span> (request.url!==<span class="string">"/favicon.ico"</span>) &#123;</span><br><span class="line">        var pathname=url.parse(request.url).pathname;</span><br><span class="line">        pathname = pathname.replace(/\//,<span class="string">''</span>);   //替换掉前面的<span class="string">"/"</span></span><br><span class="line">        router[pathname](request,response);</span><br><span class="line">        console.log(pathname);</span><br><span class="line">        response.end(<span class="string">''</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).listen(8000);</span><br><span class="line">console.log(<span class="string">'Server running at http://10.75.68.123:8000/'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="读文件"><a href="#读文件" class="headerlink" title="读文件"></a>读文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">var http = require(<span class="string">'http'</span>);</span><br><span class="line"> var url = require(<span class="string">'url'</span>);</span><br><span class="line"> var router = require(<span class="string">'./router'</span>);</span><br><span class="line"></span><br><span class="line"> // var optfile = require(<span class="string">"./models/optfile"</span>);</span><br><span class="line"></span><br><span class="line"> http.createServer(<span class="keyword">function</span>(request,response)&#123;</span><br><span class="line">    response.writeHead(200,&#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html; charset=utf-8'</span>&#125;);</span><br><span class="line">    <span class="keyword">if</span> (request.url!==<span class="string">"/favicon.ico"</span>) &#123;</span><br><span class="line"></span><br><span class="line">        var pathname=url.parse(request.url).pathname;</span><br><span class="line">        pathname = pathname.replace(/\//,<span class="string">''</span>);   //替换掉前面的<span class="string">"/"</span></span><br><span class="line">        router[pathname](request,response);</span><br><span class="line">        </span><br><span class="line">        /*</span><br><span class="line">        // optfile.readfileSync(<span class="string">'./views/login.html'</span>);</span><br><span class="line">        // optfile.readFile(<span class="string">'./views/login.html'</span>);</span><br><span class="line">        <span class="keyword">function</span> recall(data)&#123;</span><br><span class="line">            response.write(data);</span><br><span class="line">            response.end(<span class="string">'ok'</span>);   //不写则没有http协议尾</span><br><span class="line">        &#125;</span><br><span class="line">        optfile.readFile(<span class="string">'./views/login.html'</span>,recall);</span><br><span class="line">        // optfile.readFile(<span class="string">'C:\inetpub\wwwroot\HN_NTZJS01/index.html'</span>,recall);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">        console.log(<span class="string">"主程序执行完毕"</span>);</span><br><span class="line">        */</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;).listen(8000);</span><br><span class="line">console.log(<span class="string">'Server running at http://localhost:8000/'</span>)</span><br></pre></td></tr></table></figure>
<p>待续。。。</p>

                
                <div class="readmore">
                    <a href="/2019/08/10/node3/">
                        阅读更多
                    </a>
                </div>
            </div>
        
            <div class="post-item">
                <h1>
                    <a href="/2019/08/09/node2/">
                        node基础(二)
                    </a>
                </h1>
                <div class="create">
                    <span>创建于</span>
                    
                        <time datetime="2019-08-09T06:38:25.000Z">
                            2019-08-09
                        </time>
                    
                    <ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Node/">Node</a></li></ul>
                </div>
                
                    <h3 id="Node-js-REPL-交互式解释器"><a href="#Node-js-REPL-交互式解释器" class="headerlink" title="Node.js REPL(交互式解释器)"></a>Node.js REPL(交互式解释器)</h3><p>Node.js REPL(Read Eval Print Loop:交互式解释器) 表示一个电脑的环境，类似 Window 系统的终端或 Unix/Linux shell，我们可以在终端中输入命令，并接收系统的响应。<br>我们可以输入以下命令来启动 Node 的终端：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ node</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p>
<p>停止 REPL<br>前面我们已经提到按下两次 ctrl + c 键就能退出 REPL:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ node</span><br><span class="line">&gt;</span><br><span class="line">(^C again to quit)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="Node-js-回调函数"><a href="#Node-js-回调函数" class="headerlink" title="Node.js 回调函数"></a>Node.js 回调函数</h3><p>Node.js 异步编程的直接体现就是回调。</p>
<p>异步编程依托于回调来实现，但不能说使用了回调后程序就异步化了。</p>
<p>回调函数在完成任务后就会被调用，Node 使用了大量的回调函数，Node 所有 API 都支持回调函数。</p>
<p>例如，我们可以一边读取文件，一边执行其他命令，在文件读取完成后，我们将文件内容作为回调函数的参数返回。这样在执行代码时就没有阻塞或等待文件 I/O 操作。这就大大提高了 Node.js 的性能，可以处理大量的并发请求。</p>
<p>回调函数一般作为函数的最后一个参数出现：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">function foo1(name, age, callback) &#123; &#125;</span><br><span class="line">function foo2(value, callback1, callback2) &#123; &#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="阻塞代码实例"><a href="#阻塞代码实例" class="headerlink" title="阻塞代码实例"></a>阻塞代码实例</h4><p>创建一个文件 input.txt ，内容如下：</p>
<p>菜鸟教程官网地址：<a href="http://www.runoob.com" target="_blank" rel="noopener">www.runoob.com</a><br>创建 main.js 文件, 代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var fs = require(&quot;fs&quot;);</span><br><span class="line"></span><br><span class="line">var data = fs.readFileSync(&apos;input.txt&apos;);</span><br><span class="line"></span><br><span class="line">console.log(data.toString());</span><br><span class="line">console.log(&quot;程序执行结束!&quot;);</span><br></pre></td></tr></table></figure></p>
<p>以上代码执行结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ node main.js</span><br><span class="line">菜鸟教程官网地址：www.runoob.com</span><br><span class="line"></span><br><span class="line">程序执行结束!</span><br></pre></td></tr></table></figure></p>
<p>非阻塞代码实例<br>创建一个文件 input.txt ，内容如下：</p>
<p>菜鸟教程官网地址：<a href="http://www.runoob.com" target="_blank" rel="noopener">www.runoob.com</a><br>创建 main.js 文件, 代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var fs = require(&quot;fs&quot;);</span><br><span class="line"></span><br><span class="line">fs.readFile(&apos;input.txt&apos;, function (err, data) &#123;</span><br><span class="line">    if (err) return console.error(err);</span><br><span class="line">    console.log(data.toString());</span><br><span class="line">&#125;);</span><br><span class="line">console.log(&quot;程序执行结束!&quot;);</span><br></pre></td></tr></table></figure></p>
<p>以上代码执行结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ node main.js</span><br><span class="line">程序执行结束!</span><br><span class="line">菜鸟教程官网地址：www.runoob.com</span><br></pre></td></tr></table></figure></p>
<p>以上两个实例我们了解了阻塞与非阻塞调用的不同。第一个实例在文件读取完后才执行完程序。 第二个实例我们不需要等待文件读取完，这样就可以在读取文件时同时执行接下来的代码，大大提高了程序的性能。</p>
<p>因此，阻塞是按顺序执行的，而非阻塞是不需要按顺序的，所以如果需要处理回调函数的参数，我们就需要写在回调函数内。</p>
<h3 id="Node-js-事件循环"><a href="#Node-js-事件循环" class="headerlink" title="Node.js 事件循环"></a>Node.js 事件循环</h3><p>Node.js 是单进程单线程应用程序，但是因为 V8 引擎提供的异步执行回调接口，通过这些接口可以处理大量的并发，所以性能非常高。</p>
<p>Node.js 几乎每一个 API 都是支持回调函数的。</p>
<p>Node.js 基本上所有的事件机制都是用设计模式中观察者模式实现。</p>
<p>Node.js 单线程类似进入一个while(true)的事件循环，直到没有事件观察者退出，每个异步事件都生成一个事件观察者，如果有事件发生就调用该回调函数.</p>
<h4 id="事件驱动程序"><a href="#事件驱动程序" class="headerlink" title="事件驱动程序"></a>事件驱动程序</h4><p>Node.js 使用事件驱动模型，当web server接收到请求，就把它关闭然后进行处理，然后去服务下一个web请求。</p>
<p>当这个请求完成，它被放回处理队列，当到达队列开头，这个结果被返回给用户。</p>
<p>这个模型非常高效可扩展性非常强，因为webserver一直接受请求而不等待任何读写操作。（这也被称之为非阻塞式IO或者事件驱动IO）</p>
<p>在事件驱动模型中，会生成一个主循环来监听事件，当检测到事件时触发回调函数。<br><img src="/2019/08/09/node2/event_loop.jpg" alt="event_loop.jpg"><br>整个事件驱动的流程就是这么实现的，非常简洁。有点类似于观察者模式，事件相当于一个主题(Subject)，而所有注册到这个事件上的处理函数相当于观察者(Observer)。</p>
<p>Node.js 有多个内置的事件，我们可以通过引入 events 模块，并通过实例化 EventEmitter 类来绑定和监听事件，如下实例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 引入 events 模块</span><br><span class="line">var events = require(&apos;events&apos;);</span><br><span class="line">// 创建 eventEmitter 对象</span><br><span class="line">var eventEmitter = new events.EventEmitter();</span><br></pre></td></tr></table></figure></p>
<p>下程序绑定事件处理程序：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 绑定事件及事件的处理程序</span><br><span class="line">eventEmitter.on(&apos;eventName&apos;, eventHandler);</span><br></pre></td></tr></table></figure></p>
<p>我们可以通过程序触发事件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 触发事件</span><br><span class="line">eventEmitter.emit(&apos;eventName&apos;);</span><br></pre></td></tr></table></figure></p>
<p>实例<br>创建 main.js 文件，代码如下所示：</p>
<p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// 引入 events 模块</span><br><span class="line">var events = require(&apos;events&apos;);</span><br><span class="line">// 创建 eventEmitter 对象</span><br><span class="line">var eventEmitter = new events.EventEmitter();</span><br><span class="line"> </span><br><span class="line">// 创建事件处理程序</span><br><span class="line">var connectHandler = function connected() &#123;</span><br><span class="line">   console.log(&apos;连接成功。&apos;);</span><br><span class="line">  </span><br><span class="line">   // 触发 data_received 事件 </span><br><span class="line">   eventEmitter.emit(&apos;data_received&apos;);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">// 绑定 connection 事件处理程序</span><br><span class="line">eventEmitter.on(&apos;connection&apos;, connectHandler);</span><br><span class="line"> </span><br><span class="line">// 使用匿名函数绑定 data_received 事件</span><br><span class="line">eventEmitter.on(&apos;data_received&apos;, function()&#123;</span><br><span class="line">   console.log(&apos;数据接收成功。&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">// 触发 connection 事件 </span><br><span class="line">eventEmitter.emit(&apos;connection&apos;);</span><br><span class="line"> </span><br><span class="line">console.log(&quot;程序执行完毕。&quot;);</span><br></pre></td></tr></table></figure></p>
<p>接下来让我们执行以上代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ node main.js</span><br><span class="line">连接成功。</span><br><span class="line">数据接收成功。</span><br><span class="line">程序执行完毕。</span><br></pre></td></tr></table></figure></p>
<h3 id="Node-js-EventEmitter"><a href="#Node-js-EventEmitter" class="headerlink" title="Node.js EventEmitter"></a>Node.js EventEmitter</h3><p>Node.js 所有的异步 I/O 操作在完成时都会发送一个事件到事件队列。</p>
<p>Node.js 里面的许多对象都会分发事件：一个 net.Server 对象会在每次有新连接时触发一个事件， 一个 fs.readStream 对象会在文件被打开的时候触发一个事件。 所有这些产生事件的对象都是 events.EventEmitter 的实例。</p>
<h4 id="EventEmitter-类"><a href="#EventEmitter-类" class="headerlink" title="EventEmitter 类"></a>EventEmitter 类</h4><p>events 模块只提供了一个对象： events.EventEmitter。EventEmitter 的核心就是事件触发与事件监听器功能的封装。</p>
<p>你可以通过require(“events”);来访问该模块。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 引入 events 模块</span><br><span class="line">var events = require(&apos;events&apos;);</span><br><span class="line">// 创建 eventEmitter 对象</span><br><span class="line">var eventEmitter = new events.EventEmitter();</span><br></pre></td></tr></table></figure></p>
<p>EventEmitter 对象如果在实例化时发生错误，会触发 error 事件。当添加新的监听器时，newListener 事件会触发，当监听器被移除时，removeListener 事件被触发。</p>
<p>下面我们用一个简单的例子说明 EventEmitter 的用法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//event.js 文件</span><br><span class="line">var EventEmitter = require(&apos;events&apos;).EventEmitter; </span><br><span class="line">var event = new EventEmitter(); </span><br><span class="line">event.on(&apos;some_event&apos;, function() &#123; </span><br><span class="line">    console.log(&apos;some_event 事件触发&apos;); </span><br><span class="line">&#125;); </span><br><span class="line">setTimeout(function() &#123; </span><br><span class="line">    event.emit(&apos;some_event&apos;); </span><br><span class="line">&#125;, 1000);</span><br></pre></td></tr></table></figure></p>
<p>执行结果如下：</p>
<p>运行这段代码，1 秒后控制台输出了 ‘some_event 事件触发’。其原理是 event 对象注册了事件 some_event 的一个监听器，然后我们通过 setTimeout 在 1000 毫秒以后向 event 对象发送事件 some_event，此时会调用some_event 的监听器。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ node event.js </span><br><span class="line">some_event 事件触发</span><br></pre></td></tr></table></figure></p>
<p>EventEmitter 的每个事件由一个事件名和若干个参数组成，事件名是一个字符串，通常表达一定的语义。对于每个事件，EventEmitter 支持 若干个事件监听器。</p>
<p>当事件触发时，注册到这个事件的事件监听器被依次调用，事件参数作为回调函数参数传递。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//event.js 文件</span><br><span class="line">var events = require(&apos;events&apos;); </span><br><span class="line">var emitter = new events.EventEmitter(); </span><br><span class="line">emitter.on(&apos;someEvent&apos;, function(arg1, arg2) &#123; </span><br><span class="line">    console.log(&apos;listener1&apos;, arg1, arg2); </span><br><span class="line">&#125;); </span><br><span class="line">emitter.on(&apos;someEvent&apos;, function(arg1, arg2) &#123; </span><br><span class="line">    console.log(&apos;listener2&apos;, arg1, arg2); </span><br><span class="line">&#125;); </span><br><span class="line">emitter.emit(&apos;someEvent&apos;, &apos;arg1 参数&apos;, &apos;arg2 参数&apos;);</span><br></pre></td></tr></table></figure></p>
<p>执行以上代码，运行的结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ node event.js </span><br><span class="line">listener1 arg1 参数 arg2 参数</span><br><span class="line">listener2 arg1 参数 arg2 参数</span><br></pre></td></tr></table></figure></p>
<p>以上例子中，emitter 为事件 someEvent 注册了两个事件监听器，然后触发了 someEvent 事件。</p>
<p>运行结果中可以看到两个事件监听器回调函数被先后调用。 这就是EventEmitter最简单的用法。</p>
<p>EventEmitter 提供了多个属性，如 on 和 emit。on 函数用于绑定事件函数，emit 属性用于触发一个事件。接下来我们来具体看下 EventEmitter 的属性介绍。</p>
<h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4>
                
                <div class="readmore">
                    <a href="/2019/08/09/node2/">
                        阅读更多
                    </a>
                </div>
            </div>
        
            <div class="post-item">
                <h1>
                    <a href="/2019/08/08/node1/">
                        node基础(一)
                    </a>
                </h1>
                <div class="create">
                    <span>创建于</span>
                    
                        <time datetime="2019-08-08T03:09:06.000Z">
                            2019-08-08
                        </time>
                    
                    <ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Node/">Node</a></li></ul>
                </div>
                
                    <p><font color="red">JavaScript的后端开发</font><br>在Node上运行的JavaScript相比其他后端开发语言有何优势？<br>最大的优势是借助JavaScript天生的事件驱动机制加V8高性能引擎，使编写高性能Web服务轻而易举</p>
<h3 id="安装Node-js和npm"><a href="#安装Node-js和npm" class="headerlink" title="安装Node.js和npm"></a>安装Node.js和npm</h3><p>由于Node.js平台是在后端运行JavaScript代码，所以，必须首先在本机安装Node环境。</p>
<h4 id="安装Node-js"><a href="#安装Node-js" class="headerlink" title="安装Node.js"></a>安装Node.js</h4><p>从Node.js官网下载对应平台的安装程序<br>安装完成后，在Windows环境下，请打开命令提示符，然后输入node -v，如果安装正常，你应该看到v7.6.0这样的输出：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\IEUser&gt;node -v</span><br><span class="line">v7.6.0</span><br></pre></td></tr></table></figure></p>
<h4 id="npm"><a href="#npm" class="headerlink" title="npm"></a>npm</h4><p>在正式开始Node.js学习之前，我们先认识一下npm。</p>
<p>npm是什么东东？npm其实是Node.js的包管理工具（package manager）。</p>
<p>为啥我们需要一个包管理工具呢？因为我们在Node.js上开发时，会用到很多别人写的JavaScript代码。如果我们要使用别人写的某个包，每次都根据名称搜索一下官方网站，下载代码，解压，再使用，非常繁琐。于是一个集中管理的工具应运而生：大家都把自己开发的模块打包后放到npm官网上，如果要使用，直接通过npm安装就可以直接用，不用管代码存在哪，应该从哪下载。</p>
<p>更重要的是，如果我们要使用模块A，而模块A又依赖于模块B，模块B又依赖于模块X和模块Y，npm可以根据依赖关系，把所有依赖的包都下载下来并管理起来。否则，靠我们自己手动管理，肯定既麻烦又容易出错。</p>
<p>讲了这么多，npm究竟在哪？</p>
<p>其实npm已经在Node.js安装的时候顺带装好了。我们在命令提示符或者终端输入npm -v，应该看到类似的输出：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt;npm -v</span><br><span class="line">4.1.2</span><br></pre></td></tr></table></figure></p>
<p>如果直接输入npm，你会看到类似下面的输出：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt; npm</span><br><span class="line"></span><br><span class="line">Usage: npm &lt;command&gt;</span><br><span class="line"></span><br><span class="line">where &lt;command&gt; is one of:</span><br></pre></td></tr></table></figure></p>
<h5 id="卸载模块"><a href="#卸载模块" class="headerlink" title="卸载模块"></a>卸载模块</h5><p>我们可以使用以下命令来卸载 Node.js 模块。</p>
<p>$ npm uninstall express<br>卸载后，你可以到 /node_modules/ 目录下查看包是否还存在，或者使用以下命令查看：</p>
<p>$ npm ls</p>
<h5 id="更新模块"><a href="#更新模块" class="headerlink" title="更新模块"></a>更新模块</h5><p>我们可以使用以下命令更新模块：</p>
<p>$ npm update express</p>
<h5 id="搜索模块"><a href="#搜索模块" class="headerlink" title="搜索模块"></a>搜索模块</h5><p>使用以下来搜索模块：<br>$ npm search express</p>
<h5 id="NPM-常用命令"><a href="#NPM-常用命令" class="headerlink" title="NPM 常用命令"></a>NPM 常用命令</h5><ul>
<li>NPM提供了很多命令，例如install和publish，使用npm help可查看所有命令。</li>
<li>使用npm help <command>可查看某条命令的详细帮助，例如npm help install。</li>
<li>在package.json所在目录下使用npm install . -g可先在本地安装当前命令行程序，可用于发布前的本地测试。</li>
<li>使用npm update <package>可以把当前目录下node_modules子目录里边的对应模块更新至最新版本。</package></li>
<li>使用npm update <package> -g可以把全局安装的对应命令行程序更新至最新版。</package></li>
<li>使用npm cache clear可以清空NPM本地缓存，用于对付使用相同版本号发布新版本代码的人。</li>
<li>使用npm unpublish <package>@<version>可以撤销发布自己发布过的某个版本代码。</version></package></li>
</ul>
<p>使用淘宝 NPM 镜像<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure></p>
<p>这样就可以使用 cnpm 命令来安装模块了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cnpm install [name]</span><br></pre></td></tr></table></figure></p>
<h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><p>请在本机安装Node.js环境，并确保node和npm能正常运行。</p>
<h3 id="第一个Node程序"><a href="#第一个Node程序" class="headerlink" title="第一个Node程序"></a>第一个Node程序</h3><p>用文本编辑器写JavaScript程序，然后保存为后缀为.js的文件，就可以用node直接运行这个程序了。</p>
<p>Node的交互模式和直接运行.js文件有什么区别呢？</p>
<p>直接输入node进入交互模式，相当于启动了Node解释器，但是等待你一行一行地输入源代码，每输入一行就执行一行。</p>
<p>直接运行node hello.js文件相当于启动了Node解释器，然后一次性把hello.js文件的源代码给执行了，你是没有机会以交互的方式输入源代码的。</p>
<p>在编写JavaScript代码的时候，完全可以一边在文本编辑器里写代码，一边开一个Node交互式命令窗口，在写代码的过程中，把部分代码粘到命令行去验证，事半功倍！前提是得有个27’的超大显示器！</p>
<h3 id="搭建Node开发环境"><a href="#搭建Node开发环境" class="headerlink" title="搭建Node开发环境"></a>搭建Node开发环境</h3><p>使用文本编辑器来开发Node程序，最大的缺点是效率太低，运行Node程序还需要在命令行单独敲命令。如果还需要调试程序，就更加麻烦了。</p>
<p>所以我们需要一个IDE集成开发环境，让我们能在一个环境里编码、运行、调试，这样就可以大大提升开发效率。</p>
<p>Java的集成开发环境有Eclipse，Intellij idea等，C#的集成开发环境有Visual Studio，那么问题又来了：Node.js的集成开发环境到底哪家强？</p>
<p>考察Node.js的集成开发环境，重点放在启动速度快，执行简单，调试方便这三点上。当然，免费使用是一个加分项。</p>
<p>综合考察后，我们隆重向大家推荐Node.js集成开发环境： vscode<br>Visual Studio Code由微软出品，但它不是那个大块头的Visual Studio，它是一个精简版的迷你Visual Studio，并且，Visual Studio Code可以跨！平！台！Windows、Mac和Linux通用。</p>
<p>运行和调试JavaScript<br>在VS Code中，我们可以非常方便地运行JavaScript文件。</p>
<p>VS Code以文件夹作为工程目录（Workspace Dir），所有的JavaScript文件都存放在该目录下。此外，VS Code在工程目录下还需要一个.vscode的配置目录，里面存放里VS Code需要的配置文件。</p>
<p>假设我们在C:\Work\目录下创建了一个hello目录作为工程目录，并编写了一个hello.js文件，则该工程目录的结构如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hello/ &lt;-- workspace dir</span><br><span class="line">|</span><br><span class="line">+- hello.js &lt;-- JavaScript file</span><br><span class="line">|</span><br><span class="line">+- .vscode/  &lt;-- VS Code config</span><br><span class="line">   |</span><br><span class="line">   +- launch.json &lt;-- VS Code config file for JavaScript</span><br></pre></td></tr></table></figure></p>
<p>可以用VS Code快速创建launch.json，然后修改如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;version&quot;: &quot;0.2.0&quot;,</span><br><span class="line">    &quot;configurations&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;name&quot;: &quot;Run hello.js&quot;,</span><br><span class="line">            &quot;type&quot;: &quot;node&quot;,</span><br><span class="line">            &quot;request&quot;: &quot;launch&quot;,</span><br><span class="line">            &quot;program&quot;: &quot;$&#123;workspaceRoot&#125;/hello.js&quot;,</span><br><span class="line">            &quot;stopOnEntry&quot;: false,</span><br><span class="line">            &quot;args&quot;: [],</span><br><span class="line">            &quot;cwd&quot;: &quot;$&#123;workspaceRoot&#125;&quot;,</span><br><span class="line">            &quot;preLaunchTask&quot;: null,</span><br><span class="line">            &quot;runtimeExecutable&quot;: null,</span><br><span class="line">            &quot;runtimeArgs&quot;: [</span><br><span class="line">                &quot;--nolazy&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;env&quot;: &#123;</span><br><span class="line">                &quot;NODE_ENV&quot;: &quot;development&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;externalConsole&quot;: false,</span><br><span class="line">            &quot;sourceMaps&quot;: false,</span><br><span class="line">            &quot;outDir&quot;: null</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>有了配置文件，即可使用VS Code调试JavaScript。</p>
<h3 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h3><p>在计算机程序的开发过程中，随着程序代码越写越多，在一个文件里代码就会越来越长，越来越不容易维护。</p>
<p>为了编写可维护的代码，我们把很多函数分组，分别放到不同的文件里，这样，每个文件包含的代码就相对较少，很多编程语言都采用这种组织代码的方式。在Node环境中，一个.js文件就称之为一个模块（module）。</p>
<p>使用模块有什么好处？</p>
<p>最大的好处是大大提高了代码的可维护性。其次，编写代码不必从零开始。当一个模块编写完毕，就可以被其他地方引用。我们在编写程序的时候，也经常引用其他模块，包括Node内置的模块和来自第三方的模块。</p>
<p>使用模块还可以避免函数名和变量名冲突。相同名字的函数和变量完全可以分别存在不同的模块中，因此，我们自己在编写模块时，不必考虑名字会与其他模块冲突。</p>
<p>在上一节，我们编写了一个hello.js文件，这个hello.js文件就是一个模块，模块的名字就是文件名（去掉.js后缀），所以hello.js文件就是名为hello的模块。</p>
<p>我们把hello.js改造一下，创建一个函数，这样我们就可以在其他地方调用这个函数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;;</span><br><span class="line"></span><br><span class="line">var s = &apos;Hello&apos;;</span><br><span class="line"></span><br><span class="line">function greet(name) &#123;</span><br><span class="line">    console.log(s + &apos;, &apos; + name + &apos;!&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = greet;</span><br></pre></td></tr></table></figure></p>
<p>函数greet()是我们在hello模块中定义的，你可能注意到最后一行是一个奇怪的赋值语句，它的意思是，把函数greet作为模块的输出暴露出去，这样其他模块就可以使用greet函数了。</p>
<p>问题是其他模块怎么使用hello模块的这个greet函数呢？我们再编写一个main.js文件，调用hello模块的greet函数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;;</span><br><span class="line"></span><br><span class="line">// 引入hello模块:</span><br><span class="line">var greet = require(&apos;./hello&apos;);</span><br><span class="line"></span><br><span class="line">var s = &apos;Michael&apos;;</span><br><span class="line"></span><br><span class="line">greet(s); // Hello, Michael!</span><br></pre></td></tr></table></figure></p>
<p>注意到引入hello模块用Node提供的require函数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var greet = require(&apos;./hello&apos;);</span><br></pre></td></tr></table></figure></p>
<p>引入的模块作为变量保存在greet变量中，那greet变量到底是什么东西？其实变量greet就是在hello.js中我们用module.exports = greet;输出的greet函数。所以，main.js就成功地引用了hello.js模块中定义的greet()函数，接下来就可以直接使用它了。</p>
<p>在使用require()引入模块的时候，请注意模块的相对路径。因为main.js和hello.js位于同一个目录，所以我们用了当前目录.：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var greet = require(&apos;./hello&apos;); // 不要忘了写相对目录!</span><br></pre></td></tr></table></figure></p>
<p>如果只写模块名：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var greet = require(&apos;hello&apos;);</span><br></pre></td></tr></table></figure></p>
<p>则Node会依次在内置模块、全局模块和当前模块下查找hello.js，你很可能会得到一个错误：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">module.js</span><br><span class="line">    throw err;</span><br><span class="line">          ^</span><br><span class="line">Error: Cannot find module &apos;hello&apos;</span><br><span class="line">    at Function.Module._resolveFilename</span><br><span class="line">    at Function.Module._load</span><br><span class="line">    ...</span><br><span class="line">    at Function.Module._load</span><br><span class="line">    at Function.Module.runMain</span><br></pre></td></tr></table></figure></p>
<p>遇到这个错误，你要检查：</p>
<ul>
<li>模块名是否写对了；</li>
<li>模块文件是否存在；</li>
<li>相对路径是否写对了。</li>
</ul>
<h4 id="CommonJS规范"><a href="#CommonJS规范" class="headerlink" title="CommonJS规范"></a>CommonJS规范</h4><p>这种模块加载机制被称为CommonJS规范。在这个规范下，每个.js文件都是一个模块，它们内部各自使用的变量名和函数名都互不冲突，例如，hello.js和main.js都申明了全局变量var s = ‘xxx’，但互不影响。</p>
<p>一个模块想要对外暴露变量（函数也是变量），可以用module.exports = variable;，一个模块要引用其他模块暴露的变量，用var ref = require(‘module_name’);就拿到了引用模块的变量。</p>
<h4 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h4><p>要在模块中对外输出变量，用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">module.exports = variable;</span><br></pre></td></tr></table></figure></p>
<p>输出的变量可以是任意对象、函数、数组等等。</p>
<p>要引入其他模块输出的对象，用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var foo = require(&apos;other_module&apos;);</span><br></pre></td></tr></table></figure></p>
<p>引入的对象具体是什么，取决于引入模块输出的对象。</p>
<h4 id="module-exports-vs-exports"><a href="#module-exports-vs-exports" class="headerlink" title="module.exports vs exports"></a>module.exports vs exports</h4><p>很多时候，你会看到，在Node环境中，有两种方法可以在一个模块中输出变量：</p>
<p>方法一：对module.exports赋值：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// hello.js</span><br><span class="line"></span><br><span class="line">function hello() &#123;</span><br><span class="line">    console.log(&apos;Hello, world!&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function greet(name) &#123;</span><br><span class="line">    console.log(&apos;Hello, &apos; + name + &apos;!&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    hello: hello,</span><br><span class="line">    greet: greet</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>方法二：直接使用exports：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// hello.js</span><br><span class="line"></span><br><span class="line">function hello() &#123;</span><br><span class="line">    console.log(&apos;Hello, world!&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function greet(name) &#123;</span><br><span class="line">    console.log(&apos;Hello, &apos; + name + &apos;!&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function hello() &#123;</span><br><span class="line">    console.log(&apos;Hello, world!&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.hello = hello;</span><br><span class="line">exports.greet = greet;</span><br></pre></td></tr></table></figure></p>
<p>但是你不可以直接对exports赋值：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 代码可以执行，但是模块并没有输出任何变量:</span><br><span class="line">exports = &#123;</span><br><span class="line">    hello: hello,</span><br><span class="line">    greet: greet</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

                
                <div class="readmore">
                    <a href="/2019/08/08/node1/">
                        阅读更多
                    </a>
                </div>
            </div>
        
    </div>


    <div id="content-aside">
    <div class="content-aside-owner">
        <div id="owner">
    <div class="avatar-bg">
        <div class="index-page">
            <div class="banner">
                <div class="slide slide1">
                    <div class="bg-wrapper">
                        <div class="bg" id="container_left">
                            <div id="canvas_left"></div>
                        </div>
                    </div>
                </div>
                <div class="slide slide2">
                    <div class="bg-wrapper">
                        <div class="bg" id="container_right">
                            <div id="canvas_right"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <a href="/"><img class="avatar" src="/images/avatar.jpg" alt=""></a>
    <a href="/"><h3 class="author">I&#39;m xiedandan</h3></a>
    <h4>^_^</h4>
    <div class="social">
        
            
              <a href="https://github.com/xdd7130" title="github" class="fa fa-github" target="_blank"></a>
            
        
            
              <a href="#" title="weibo" class="fa fa-weibo" target="_blank"></a>
            
        
    </div>
</div>
    </div>
    
        <div class="content-aside-about">
            <h2>
                <a href="/about">关于</a>
            </h2>
        </div>
    
    <div class="content-aside-tags">
        <h2>
            <a href="/tags">
                标签
                <sup style="font-size: 12px">
                    [24]
                </sup>
            </a>
        </h2>
    </div>
    
<aside id="categories">
    <h2>分类</h2>
    
        <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ArcGIS/">ArcGIS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Node/">Node</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/React/">React</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/VUE/">VUE</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/其他前端技术/">其他前端技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/基础前端技术/">基础前端技术</a></li></ul>
    
</aside>

    
<aside id="acchives">
    <h2>归档</h2>
    
    <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li></ul>
    
</aside>

</div>

</div>
<nav id="pagination" class="clearfix">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a>
</nav>

    </div>
</div>
<footer id="footer">
     <div id="copyright">&copy; I&#39;m xiedandan  2019</div>
     
             <!-- 不蒜子统计 -->
             <span id="busuanzi_container_site_pv">
                     本站总访问量<span id="busuanzi_value_site_pv" style='color:#17a167'></span>次
             </span>
             <span class="post-meta-divider">|</span>
             <span id="busuanzi_container_site_uv">
                     本站访客数<span id="busuanzi_value_site_uv"  style='color:#17a167'></span>人
             </span>
             <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
       
    <div id="theme">
        Powered by <a href="http://hexo.io">Hexo</a>. Theme by <a href="https://github.com/markyong/hexo-theme-stage">Stage</a>
    </div>
</footer>
<script src="/lib/js/waterrippleeffect.min.js"></script>
<script src="/js/header-bg.main.js"></script>

    <script src="/lib/js/cav.js"></script>
    <script src="/js/avatar-bg.main.js"></script>

</body>
</html>
