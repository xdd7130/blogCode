
<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <title>ArcGIS API For Javascript之调用动态地图服务 | DD_XIE的学习笔记</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="">
    <meta name="description" content="主要记录一下在ArcGIS API如何调用自己发布的动态地图服务,利用动态地图服务我们可以完成哪一些需求等等。
调用动态地图服务  在ArcGIS API 中给我们提供了一个类叫做ArcGISDynamicMapServiceLayer利用这个类，我们可以获得发布的地图服务。调用动态地图服务一般只需要两步：
通过地图服务的URL创建一个ArcGISDynamicMapServiceLayer对象将动态地图服务的对象添加到地图容器中123456789101112131415161718192021222324&amp;lt;!DOCTYPE html&amp;gt;&amp;lt;html lang=&amp;quot;en&amp;quot;&amp;gt;&amp;lt;h...">
    
        <link rel="icon" href="/favicon.ico">
    
    
        
            <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
        
            <link rel="stylesheet" href="/css/stage.css">
        
            <link rel="stylesheet" href="/css/avatar-bg.css">
        
    
</head>
</html>
<body>
<header id="header">
    <div class="menu">
        <i class="fa fa-bars"></i>
    </div>
    <div class="header-main">
        <h1><a href="/">DD_XIE的学习笔记</a></h1>
    </div>
    <div id="nav">
        <div class="nav-img" id="nav-img"></div>
        <div class="sentences">
            云里写诗，泥里生活，岁月里洒脱。
        </div>
    </div>
</header>

<div id="content-outer">
    <div id="content-inner">
        <div class="clearfix">
    <article id="post">
        <h1>ArcGIS API For Javascript之调用动态地图服务</h1>
        <div class="create">
            <span>创建于</span>
            
                <time datetime="2019-08-06T05:40:02.000Z">
                    2019-08-06
                </time>
            
            <ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/ArcGIS/">ArcGIS</a></li></ul>
        </div>
        <p>主要记录一下在ArcGIS API如何调用自己发布的动态地图服务,利用动态地图服务我们可以完成哪一些需求等等。</p>
<h3 id="调用动态地图服务"><a href="#调用动态地图服务" class="headerlink" title="调用动态地图服务"></a>调用动态地图服务</h3><p>  在ArcGIS API 中给我们提供了一个类叫做ArcGISDynamicMapServiceLayer利用这个类，我们可以获得发布的地图服务。调用动态地图服务一般只需要两步：</p>
<p>通过地图服务的URL创建一个ArcGISDynamicMapServiceLayer对象将动态地图服务的对象添加到地图容器中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Hello World&lt;/title&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        require([&quot;esri/map&quot;,&quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">                    &quot;dojo/domReady!&quot;],</span><br><span class="line">                function(Map,ArcGISDynamicMapServiceLayer)&#123;</span><br><span class="line">                    var map = new Map(&quot;mapDiv&quot;);</span><br><span class="line">                    //利用url创建一个动态地图服务对象</span><br><span class="line">                    var layer=new ArcGISDynamicMapServiceLayer(&quot;http://localhost:6080/arcgis/rest/services/Test/MyServer/MapServer&quot;);</span><br><span class="line">                    //将地图服务对象添加到地图容器中</span><br><span class="line">                    map.addLayer(layer);</span><br><span class="line">                &#125;)</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body class=&quot;tundra&quot;&gt;</span><br><span class="line">&lt;div id=&quot;mapDiv&quot; style=&quot;width:900px; height:600px; border:1px solid #000;&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p>在ArcGIS API中与ArcMap不同的是：一个服务图层相当于一组图层的集合（即多个图层）</p>
<h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>在真实开发过程中，动态地图服务可以帮助我们完成很多的功能需求，例如：</p>
<ul>
<li>根据需求隐藏服务中的某一个图层（动态地图服务可以实现，但是切片地图服务就不能实现）</li>
<li>通过属性查询地图服务中的信息</li>
<li>通过空间查询地图服务中的信息（包括点查询，线查询，面查询等等）</li>
</ul>
<h4 id="根据需求隐藏服务中的某一个图层"><a href="#根据需求隐藏服务中的某一个图层" class="headerlink" title="根据需求隐藏服务中的某一个图层"></a>根据需求隐藏服务中的某一个图层</h4><p>我们发布的地图服务中有四个图层<br><img src="/2019/08/06/ArcGIS-API-for-JS11/01.png" alt="01.png"><br>在本需求中,我们主要是给页面添加一个按钮，然后将地图服务中的road2隐藏,代码如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">require([&quot;esri/map&quot;,&quot;dojo/dom&quot;,&quot;dojo/on&quot;,&quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">                   &quot;dojo/domReady!&quot;],</span><br><span class="line">               function(Map,dom,on,ArcGISDynamicMapServiceLayer)&#123;</span><br><span class="line">                   var map = new Map(&quot;mapDiv&quot;);</span><br><span class="line">                   var layer=new ArcGISDynamicMapServiceLayer(&quot;http://localhost:6080/arcgis/rest/services/Test/MyServer/MapServer&quot;);</span><br><span class="line">                   map.addLayer(layer);</span><br><span class="line">                   //给id为btn的按钮绑定click事件</span><br><span class="line">                   on(dom.byId(&quot;btn&quot;),&quot;click&quot;,function()</span><br><span class="line">                   &#123;</span><br><span class="line">                       layer.setVisibleLayers([1,2,3]);</span><br><span class="line">                   &#125;)</span><br><span class="line">               &#125;)</span><br></pre></td></tr></table></figure></p>
<p>代码解释：</p>
<ul>
<li>此代码功能的实现非常简单，只利用了setVisibleLayers方法，告诉服务，我要显示图层编号为1，2，3的图层。</li>
<li>在require中加载了一个新的模块dojo/dom模块，此模块给我们提供了一个方法dom.byId(id),我们可以通过id获得dom对象，类似于document.getElementById()方法。</li>
<li><p>在require中加载了一个新的模块dojo/on模块，在dojo中on是用来绑定事件的,on(target,type,listener)的第一个参数是给哪一个对象绑定事件，第二个参数是事件的类型，第三个是参数是回调函数。</p>
<h4 id="通过属性查询地图服务中的信息"><a href="#通过属性查询地图服务中的信息" class="headerlink" title="通过属性查询地图服务中的信息"></a>通过属性查询地图服务中的信息</h4><p>根据属性查询出我们想要的要素图形，然后将该图形高亮（在本事例中查询教学楼的信息，例如根据教学楼的名称将该楼层成高亮）<br><img src="/2019/08/06/ArcGIS-API-for-JS11/02.png" alt="02.png"><br>在实现这个功能的时候我们分几步开始考虑：</p>
</li>
<li><p>在网页上新建一个文本框</p>
</li>
<li>将文本框中的教学楼名称获取，并创建属性查询对象</li>
<li>将查询到的楼层信息（几何信息）获取，利用graphics高亮显示</li>
</ul>
<h5 id="创建一个文本框"><a href="#创建一个文本框" class="headerlink" title="创建一个文本框"></a>创建一个文本框</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Name:&lt;input class=&quot;nm&quot; type=&quot;text&quot;&gt;</span><br><span class="line">&lt;input type=&quot;button&quot; value=&quot;查询&quot;&gt;</span><br></pre></td></tr></table></figure>
<h5 id="将文本框中的教学楼名称获取，并创建属性查询对象"><a href="#将文本框中的教学楼名称获取，并创建属性查询对象" class="headerlink" title="将文本框中的教学楼名称获取，并创建属性查询对象"></a>将文本框中的教学楼名称获取，并创建属性查询对象</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">query(&quot;#btn&quot;).on(&quot;click&quot;,function()&#123;</span><br><span class="line">                        //获得教学楼的名称</span><br><span class="line">                        var name=query(&quot;.nm&quot;)[0].value;</span><br><span class="line">                        //实例化查询参数</span><br><span class="line">                        var findParams = new esri.tasks.FindParameters();</span><br><span class="line">                        findParams.returnGeometry = true;</span><br><span class="line">                        findParams.layerIds = [3];</span><br><span class="line">                        findParams.searchFields = [&quot;name&quot;];</span><br><span class="line">                        findParams.searchText = name;</span><br><span class="line">                        //实例化查询对象</span><br><span class="line">                        var FindTask = new esri.tasks.FindTask(&quot;http://localhost:6080/arcgis/rest/services/Test/MyServer/MapServer&quot;);</span><br><span class="line">                        //进行查询</span><br><span class="line">                        FindTask.execute(findParams,ShowFindResult)</span><br><span class="line">                    &#125;)</span><br></pre></td></tr></table></figure>
<h5 id="将查询到的楼层信息（几何信息）获取，利用graphics高亮显示"><a href="#将查询到的楼层信息（几何信息）获取，利用graphics高亮显示" class="headerlink" title="将查询到的楼层信息（几何信息）获取，利用graphics高亮显示"></a>将查询到的楼层信息（几何信息）获取，利用graphics高亮显示</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">function showFindResult(queryResult)</span><br><span class="line">                    &#123;</span><br><span class="line">                        if (queryResult.length == 0) &#123;</span><br><span class="line">                            alert(&quot;没有该元素&quot;);</span><br><span class="line">                            return;</span><br><span class="line">                        &#125;</span><br><span class="line">                        for (var i = 0; i &lt; queryResult.length; i++) &#123;</span><br><span class="line">                                //获得该图形的形状</span><br><span class="line">                                var graphic = queryResult[i].feature;</span><br><span class="line">                                var geometry = graphic.geometry;</span><br><span class="line">                                //定义高亮图形的符号</span><br><span class="line">                                //1.定义面的边界线符号</span><br><span class="line">                                var outline= new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASHDOT,new Color([255, 0, 0]), 1);</span><br><span class="line">                                //2.定义面符号</span><br><span class="line">                                var PolygonSymbol = new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, outline,new Color([0, 255, 0, 1]));</span><br><span class="line">                                //创建客户端图形</span><br><span class="line">                                var graphic = new Graphic(geometry, PolygonSymbol);</span><br><span class="line">                                //将客户端图形添加到map中</span><br><span class="line">                                map.graphics.add(graphic);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2019/08/06/ArcGIS-API-for-JS11/03.png" alt="03.png"></p>
<h5 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Hello World&lt;/title&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        require([&quot;esri/map&quot;,&quot;dojo/query&quot;,&quot;dojo/on&quot;,</span><br><span class="line">            &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">            &quot;esri/tasks/FindTask&quot;,</span><br><span class="line">            &quot;esri/tasks/FindParameters&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleLineSymbol&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleFillSymbol&quot;,</span><br><span class="line">            &quot;esri/Color&quot;,</span><br><span class="line">            &quot;esri/graphic&quot;,</span><br><span class="line">            &quot;dojo/domReady!&quot;],</span><br><span class="line">                function(Map,query,on,ArcGISDynamicMapServiceLayer,FindTask,FindParameters,SimpleLineSymbol,SimpleFillSymbol,Color,Graphic)&#123;</span><br><span class="line">                    var map = new Map(&quot;mapDiv&quot;);</span><br><span class="line">                    var layer=new ArcGISDynamicMapServiceLayer(&quot;http://localhost:6080/arcgis/rest/services/Test/MyServer/MapServer&quot;);</span><br><span class="line">                    map.addLayer(layer);</span><br><span class="line">                    query(&quot;#btn&quot;).on(&quot;click&quot;,function()&#123;</span><br><span class="line">                        //获得教学楼的名称</span><br><span class="line">                        var name=query(&quot;.nm&quot;)[0].value;</span><br><span class="line">                        //实例化查询参数</span><br><span class="line">                        var findParams = new FindParameters();</span><br><span class="line">                        findParams.returnGeometry = true;</span><br><span class="line">                        findParams.layerIds = [3];</span><br><span class="line">                        findParams.searchFields = [&quot;name&quot;];</span><br><span class="line">                        findParams.searchText = name;</span><br><span class="line">                        //实例化查询对象</span><br><span class="line">                        var findTask = new FindTask(&quot;http://localhost:6080/arcgis/rest/services/Test/MyServer/MapServer&quot;);</span><br><span class="line">                        //进行查询</span><br><span class="line">                        findTask.execute(findParams,showFindResult)</span><br><span class="line">                    &#125;);</span><br><span class="line">                    function showFindResult(queryResult)</span><br><span class="line">                    &#123;</span><br><span class="line">                        if (queryResult.length == 0) &#123;</span><br><span class="line">                            alert(&quot;没有该元素&quot;);</span><br><span class="line">                            return;</span><br><span class="line">                        &#125;</span><br><span class="line">                        for (var i = 0; i &lt; queryResult.length; i++) &#123;</span><br><span class="line">                                //获得该图形的形状</span><br><span class="line">                                var feature= queryResult[i].feature;</span><br><span class="line">                                var geometry = feature.geometry;</span><br><span class="line">                                //定义高亮图形的符号</span><br><span class="line">                                //1.定义面的边界线符号</span><br><span class="line">                                var outline= new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASHDOT,new Color([255, 0, 0]), 1);</span><br><span class="line">                                //2.定义面符号</span><br><span class="line">                                var PolygonSymbol = new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, outline,new Color([0, 255, 0, 1]));</span><br><span class="line">                                //创建客户端图形</span><br><span class="line">                                var graphic = new Graphic(geometry, PolygonSymbol);</span><br><span class="line">                                //将客户端图形添加到map中</span><br><span class="line">                                map.graphics.add(graphic);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                &#125;)</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body class=&quot;tundra&quot;&gt;</span><br><span class="line">&lt;div id=&quot;mapDiv&quot; style=&quot;width:900px; height:580px; border:1px solid #000;&quot;&gt;&lt;/div&gt;</span><br><span class="line">    Name:&lt;input class=&quot;nm&quot; type=&quot;text&quot;&gt;</span><br><span class="line">    &lt;input id=&quot;btn&quot; type=&quot;button&quot; value=&quot;查询&quot;&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h5 id="代码解释"><a href="#代码解释" class="headerlink" title="代码解释"></a>代码解释</h5><ul>
<li>FindTask 是Esri提供的一个属性查询的类，他所对应的参数为：FindParameters，FindTask只能用于属性查询，不能用于空间查询</li>
<li>FindTask类中有一个方法叫做execute,execute的第一个参数是属性查询的参数，第二个参数是一个回调函数（即是一个异步函数），当服务器返回数据时，此函数才会被触发。</li>
<li>dojo/query是dojo提供的一个DOM选择器，他的功能非常强大，与JQuery中的$符一样强大，可以根据id选择query（”#id”）,也可以根据类名选择query（”.classname”），query方法还有很多强大的地方，具体可以参考官方文档</li>
<li>query(“#btn”).on()是dojo提供给我们第二种绑定事件的方式。</li>
<li>graphicesri提供给我们使用的客户端图层，利用graphic，我们可以完成很多操作，graphic具体的使用，将在Draw工具时说明。</li>
</ul>
<h4 id="通过空间查询地图服务中的信息"><a href="#通过空间查询地图服务中的信息" class="headerlink" title="通过空间查询地图服务中的信息"></a>通过空间查询地图服务中的信息</h4><p>相信大家都遇到过这种问题，当我点击地图时，将我点击的图形进行高亮显示，此时就用到了空间查询。为了实现该功能我们可以分为以下几步：</p>
<ul>
<li>因为要点击地图，所以首先我们给地图绑定点击事件</li>
<li>获得点击的地图坐标(点坐标)，并创建空间查询参数对象</li>
<li>将教学楼与点相交的楼层查询出来，然后利用graphic进行高亮显示</li>
</ul>
<h5 id="给地图绑定点击事件"><a href="#给地图绑定点击事件" class="headerlink" title="给地图绑定点击事件"></a>给地图绑定点击事件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map.on(&quot;click&quot;,mapClick);</span><br></pre></td></tr></table></figure>
<h5 id="获得点击的地图坐标-点坐标-，并创建空间查询参数对象"><a href="#获得点击的地图坐标-点坐标-，并创建空间查询参数对象" class="headerlink" title="获得点击的地图坐标(点坐标)，并创建空间查询参数对象"></a>获得点击的地图坐标(点坐标)，并创建空间查询参数对象</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function mapClick(e)&#123;</span><br><span class="line">                        //获得用户点击的地图坐标</span><br><span class="line">                        var point=e.mapPoint;</span><br><span class="line">                        //实例化查询参数</span><br><span class="line">                        query=new Query();</span><br><span class="line">                        query.geometry = point;</span><br><span class="line">                        query.outFields = [&quot;*&quot;];</span><br><span class="line">                        query.outSpatialReference = map.spatialReference;</span><br><span class="line">                        query.spatialRelationship = Query.SPATIAL_REL_INTERSECTS;</span><br><span class="line">                        query.returnGeometry = true;</span><br><span class="line">                        //实例化查询对象</span><br><span class="line">                        var queryTask = new QueryTask(&quot;http://localhost:6080/arcgis/rest/services/Test/MyServer/MapServer/3&quot;);</span><br><span class="line">                        //进行查询</span><br><span class="line">                        queryTask.execute(query,showFindResult)</span><br><span class="line">                    &#125;</span><br></pre></td></tr></table></figure>
<h5 id="将教学楼与点相交的楼层查询出来，然后利用graphic进行高亮显示"><a href="#将教学楼与点相交的楼层查询出来，然后利用graphic进行高亮显示" class="headerlink" title="将教学楼与点相交的楼层查询出来，然后利用graphic进行高亮显示"></a>将教学楼与点相交的楼层查询出来，然后利用graphic进行高亮显示</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">function showFindResult(queryResult)</span><br><span class="line">                    &#123;</span><br><span class="line">                        if (queryResult.features == 0) &#123;</span><br><span class="line">                            alert(&quot;没有该元素&quot;);</span><br><span class="line">                            return;</span><br><span class="line">                        &#125;</span><br><span class="line">                        for (var i = 0; i &lt; queryResult.features.length; i++) &#123;</span><br><span class="line">                            //获得该图形的形状</span><br><span class="line">                            var feature = queryResult.features[i];</span><br><span class="line">                            var geometry = feature.geometry;</span><br><span class="line">                            //定义高亮图形的符号</span><br><span class="line">                            //1.定义面的边界线符号</span><br><span class="line">                            var outline= new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASHDOT,new Color([255, 0, 0]), 1);</span><br><span class="line">                            //2.定义面符号</span><br><span class="line">                            var PolygonSymbol = new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, outline,new Color([0, 255, 0, 1]));</span><br><span class="line">                            //创建客户端图形</span><br><span class="line">                            var graphic = new Graphic(geometry, PolygonSymbol);</span><br><span class="line">                            //将客户端图形添加到map中</span><br><span class="line">                            map.graphics.add(graphic);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br></pre></td></tr></table></figure>
<h5 id="完整代码-1"><a href="#完整代码-1" class="headerlink" title="完整代码"></a>完整代码</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Hello World&lt;/title&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        require([&quot;esri/map&quot;,&quot;dojo/query&quot;,&quot;dojo/on&quot;,</span><br><span class="line">                    &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">                    &quot;esri/tasks/QueryTask&quot;,</span><br><span class="line">                    &quot;esri/tasks/query&quot;,</span><br><span class="line">                    &quot;esri/symbols/SimpleLineSymbol&quot;,</span><br><span class="line">                    &quot;esri/symbols/SimpleFillSymbol&quot;,</span><br><span class="line">                    &quot;esri/Color&quot;,</span><br><span class="line">                    &quot;esri/graphic&quot;,</span><br><span class="line">                    &quot;dojo/domReady!&quot;],</span><br><span class="line">                function(Map,query,on,ArcGISDynamicMapServiceLayer,QueryTask,Query,SimpleLineSymbol,SimpleFillSymbol,Color,Graphic)&#123;</span><br><span class="line">                    var map = new Map(&quot;mapDiv&quot;);</span><br><span class="line">                    var layer=new ArcGISDynamicMapServiceLayer(&quot;http://localhost:6080/arcgis/rest/services/Test/MyServer/MapServer&quot;);</span><br><span class="line">                    map.addLayer(layer);</span><br><span class="line">                    map.on(&quot;click&quot;,mapClick);</span><br><span class="line">                    function mapClick(e)&#123;</span><br><span class="line">                        //获得用户点击的地图坐标</span><br><span class="line">                        var point=e.mapPoint;</span><br><span class="line">                        //实例化查询参数</span><br><span class="line">                        query=new Query();</span><br><span class="line">                        query.geometry = point;</span><br><span class="line">                        query.outFields = [&quot;*&quot;];</span><br><span class="line">                        query.outSpatialReference = map.spatialReference;</span><br><span class="line">                        query.spatialRelationship = Query.SPATIAL_REL_INTERSECTS;</span><br><span class="line">                        query.returnGeometry = true;</span><br><span class="line">                        //实例化查询对象</span><br><span class="line">                        var queryTask = new QueryTask(&quot;http://localhost:6080/arcgis/rest/services/Test/MyServer/MapServer/3&quot;);</span><br><span class="line">                        //进行查询</span><br><span class="line">                        queryTask.execute(query,showFindResult)</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                    function showFindResult(queryResult)</span><br><span class="line">                    &#123;</span><br><span class="line">                        if (queryResult.features == 0) &#123;</span><br><span class="line">                            alert(&quot;没有该元素&quot;);</span><br><span class="line">                            return;</span><br><span class="line">                        &#125;</span><br><span class="line">                        for (var i = 0; i &lt; queryResult.features.length; i++) &#123;</span><br><span class="line">                            //获得该图形的形状</span><br><span class="line">                            var feature = queryResult.features[i];</span><br><span class="line">                            var geometry = feature.geometry;</span><br><span class="line">                            //定义高亮图形的符号</span><br><span class="line">                            //1.定义面的边界线符号</span><br><span class="line">                            var outline= new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASHDOT,new Color([255, 0, 0]), 1);</span><br><span class="line">                            //2.定义面符号</span><br><span class="line">                            var PolygonSymbol = new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID, outline,new Color([0, 255, 0, 1]));</span><br><span class="line">                            //创建客户端图形</span><br><span class="line">                            var graphic = new Graphic(geometry, PolygonSymbol);</span><br><span class="line">                            //将客户端图形添加到map中</span><br><span class="line">                            map.graphics.add(graphic);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body class=&quot;tundra&quot;&gt;</span><br><span class="line">&lt;div id=&quot;mapDiv&quot; style=&quot;width:900px; height:580px; border:1px solid #000;&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h5 id="代码解释-1"><a href="#代码解释-1" class="headerlink" title="代码解释"></a>代码解释</h5><ul>
<li>QueryTask是esri提供给我们的一个工具类，可用于属性查询，也可用于空间查询，QueryTask只能作用于地图服务的某一个图层，而不能作用于一整个地图服务（IdentifyTask类可作用于一整个地图服务）</li>
<li>Query类是QueryTask参数类，用于设定空间查询的参数。</li>
<li>QueryTask类中有一个方法叫做execute,execute的第一个参数是查询的参数，第二个参数是一个回调函数（即是一个异步函数），当服务器返回数据时，此函数才会被触发</li>
</ul>
<h5 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h5><p>绑定事件之后，在某些情况下也解除事件的绑定，下面提供几种方法解除事件绑定<br>直接通过事件句柄解除（dojo新版本）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//绑定事件</span><br><span class="line">var handle=map.on(&quot;click&quot;,mapClick);</span><br><span class="line">//解除事件</span><br><span class="line">handle.remove();</span><br></pre></td></tr></table></figure></p>
<p>通过老版本的方法解除<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//绑定事件</span><br><span class="line">var handle=map.on(&quot;click&quot;,mapClick);</span><br><span class="line">//解除事件</span><br><span class="line">dojo.disconnect(handle)</span><br></pre></td></tr></table></figure></p>

        <div>
            <ul class="tags-category-list"><li class="tags-category-list-item"><a class="tags-category-list-link" href="/tags/ArcGIS-API-for-JS/">ArcGIS API for JS</a></li></ul>
        </div>
        <div class="bottom-line"></div>
        
    <nav id="article-nav">
        
            <a href="/2019/08/06/ArcGIS-API-for-JS12/" id="article-nav-newer" class="article-nav-link-wrap">
        <span class="article-nav-title">
            
                ArcGIS API For Javascript之地图操作及小部件
            
        </span>
                <strong class="article-nav-caption">&gt;</strong>
            </a>
        
        
            <a href="/2019/08/05/ArcGIS-API-for-JS10/" id="article-nav-older" class="article-nav-link-wrap">
                <strong class="article-nav-caption">&lt;</strong>
                <span class="article-nav-title">
                    
                        ArcGIS API For JavaScript之添加地图
                </span>
                
            </a>
        
    </nav>


        
    </article>
    <div id="toc">
        
            <h2>文章目录</h2>
            <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#调用动态地图服务"><span class="toc-number">1.</span> <span class="toc-text">调用动态地图服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#需求"><span class="toc-number">2.</span> <span class="toc-text">需求</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#根据需求隐藏服务中的某一个图层"><span class="toc-number">2.1.</span> <span class="toc-text">根据需求隐藏服务中的某一个图层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#通过属性查询地图服务中的信息"><span class="toc-number">2.2.</span> <span class="toc-text">通过属性查询地图服务中的信息</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#创建一个文本框"><span class="toc-number">2.2.1.</span> <span class="toc-text">创建一个文本框</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#将文本框中的教学楼名称获取，并创建属性查询对象"><span class="toc-number">2.2.2.</span> <span class="toc-text">将文本框中的教学楼名称获取，并创建属性查询对象</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#将查询到的楼层信息（几何信息）获取，利用graphics高亮显示"><span class="toc-number">2.2.3.</span> <span class="toc-text">将查询到的楼层信息（几何信息）获取，利用graphics高亮显示</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#完整代码"><span class="toc-number">2.2.4.</span> <span class="toc-text">完整代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#代码解释"><span class="toc-number">2.2.5.</span> <span class="toc-text">代码解释</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#通过空间查询地图服务中的信息"><span class="toc-number">2.3.</span> <span class="toc-text">通过空间查询地图服务中的信息</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#给地图绑定点击事件"><span class="toc-number">2.3.1.</span> <span class="toc-text">给地图绑定点击事件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#获得点击的地图坐标-点坐标-，并创建空间查询参数对象"><span class="toc-number">2.3.2.</span> <span class="toc-text">获得点击的地图坐标(点坐标)，并创建空间查询参数对象</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#将教学楼与点相交的楼层查询出来，然后利用graphic进行高亮显示"><span class="toc-number">2.3.3.</span> <span class="toc-text">将教学楼与点相交的楼层查询出来，然后利用graphic进行高亮显示</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#完整代码-1"><span class="toc-number">2.3.4.</span> <span class="toc-text">完整代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#代码解释-1"><span class="toc-number">2.3.5.</span> <span class="toc-text">代码解释</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#补充"><span class="toc-number">2.3.6.</span> <span class="toc-text">补充</span></a></li></ol></li></ol></li></ol>
        
    </div>
</div>

    </div>
</div>
<footer id="footer">
     <div id="copyright">&copy; I&#39;m xiedandan  2020</div>
     
             <!-- 不蒜子统计 -->
             <span id="busuanzi_container_site_pv">
                     本站总访问量<span id="busuanzi_value_site_pv" style='color:#17a167'></span>次
             </span>
             <span class="post-meta-divider">|</span>
             <span id="busuanzi_container_site_uv">
                     本站访客数<span id="busuanzi_value_site_uv"  style='color:#17a167'></span>人
             </span>
             <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
       
    <div id="theme">
        Powered by <a href="http://hexo.io">Hexo</a>. Theme by <a href="https://github.com/markyong/hexo-theme-stage">Stage</a>
    </div>
</footer>
<script src="/lib/js/waterrippleeffect.min.js"></script>
<script src="/js/header-bg.main.js"></script>

    <script src="/lib/js/smooth-scroll.min.js"></script>
    <script src="/js/toc.main.js"></script>

</body>
</html>
