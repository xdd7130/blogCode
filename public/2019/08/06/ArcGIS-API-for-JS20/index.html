
<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <title>ArcGIS API For Javascript之编辑服务器端图层 | DD_XIE的学习笔记</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="">
    <meta name="description" content="在现实需求中，我们不仅仅需要编辑客户端图层，也有可能去编辑服务器端图层，要想编辑服务器端的图层，必须要将地图发布为：要素服务
需求（服务器端图层编辑）关于服务器端图层的操作,基本就是增删改查操作，要素服务的查询前面已经介绍过，在此篇博客中主要记录一下关于要素服务的增删改操作,在ArcGIS API for JS中给我们提供了三个类用于要素的增Add,删Delete,改Update,接下来就用这三个类来实现我们的功能。

我们操作的是要素服务的sushelou图层
我们的服务：

注意：宿舍楼图层编号为1
图层的属性信息
实现首先在页面添加三个按钮(用于实现用户的增删改操作)
添加要素
删除要素
修改要素
查询要素添加地图...">
    
        <link rel="icon" href="/favicon.ico">
    
    
        
            <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
        
            <link rel="stylesheet" href="/css/stage.css">
        
            <link rel="stylesheet" href="/css/avatar-bg.css">
        
    
</head>
</html>
<body>
<header id="header">
    <div class="menu">
        <i class="fa fa-bars"></i>
    </div>
    <div class="header-main">
        <h1><a href="/">DD_XIE的学习笔记</a></h1>
    </div>
    <div id="nav">
        <div class="nav-img" id="nav-img"></div>
        <div class="sentences">
            How goes the world with you?
        </div>
    </div>
</header>

<div id="content-outer">
    <div id="content-inner">
        <div class="clearfix">
    <article id="post">
        <h1>ArcGIS API For Javascript之编辑服务器端图层</h1>
        <div class="create">
            <span>创建于</span>
            
                <time datetime="2019-08-06T09:19:00.000Z">
                    2019-08-06
                </time>
            
            <ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/ArcGIS/">ArcGIS</a></li></ul>
        </div>
        <p>在现实需求中，我们不仅仅需要编辑客户端图层，也有可能去编辑服务器端图层，要想编辑服务器端的图层，必须要将地图发布为：要素服务</p>
<h3 id="需求（服务器端图层编辑）"><a href="#需求（服务器端图层编辑）" class="headerlink" title="需求（服务器端图层编辑）"></a>需求（服务器端图层编辑）</h3><p>关于服务器端图层的操作,基本就是增删改查操作，要素服务的查询前面已经介绍过，在此篇博客中主要记录一下关于要素服务的增删改操作,在ArcGIS API for JS中给我们提供了三个类用于要素的增Add,删Delete,改Update,接下来就用这三个类来实现我们的功能。</p>
<ul>
<li>我们操作的是要素服务的sushelou图层</li>
<li>我们的服务：</li>
</ul>
<p><img src="/2019/08/06/ArcGIS-API-for-JS20/01.png" alt="01.png"><br>注意：宿舍楼图层编号为1</p>
<p>图层的属性信息<br><img src="/2019/08/06/ArcGIS-API-for-JS20/02.png" alt="02.png"></p>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p>首先在页面添加三个按钮(用于实现用户的增删改操作)</p>
<p><button class="btn">添加要素</button></p>
<p><button class="btn">删除要素</button></p>
<p><button class="btn">修改要素</button></p>
<p><button class="btn">查询要素</button><br>添加地图（省略）<br>创建通用的对象，例如Draw<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//用于操作的要素图层，注意我们是操作的宿舍楼图层</span><br><span class="line">var featureLayer = new FeatureLayer(&quot;http://localhost:6080/arcgis/rest/services/Test/ft/FeatureServer/1&quot;,</span><br><span class="line">                    &#123;</span><br><span class="line">                            mode:FeatureLayer.MODE_SNAPSHOT,</span><br><span class="line">                            outFields: [&quot;*&quot;]</span><br><span class="line">                    &#125;);</span><br><span class="line">                    //在添加要素时，利用Draw工具获得geometry对象</span><br><span class="line">                    var d = new Draw(map, &#123; showTooltips: true &#125;);</span><br><span class="line">                    //要操作的graphic</span><br><span class="line">                    var g;</span><br></pre></td></tr></table></figure></p>
<p>给相应的按钮添加绑定事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">query(&quot;button&quot;).on(&quot;click&quot;,function(event)&#123;</span><br><span class="line">                        //获得按钮的文本</span><br><span class="line">                        var value=this.innerHTML; </span><br><span class="line">                        //根据文本绑定不同的事件</span><br><span class="line">                        switch(value)&#123;</span><br><span class="line">                            case &quot;添加要素&quot;:</span><br><span class="line">                                d.activate(Draw.POLYGON);</span><br><span class="line">                                break;</span><br><span class="line">                            case &quot;删除要素&quot;:</span><br><span class="line">                                //创建Graphic对象，删除OBJECTID为34的元素，</span><br><span class="line">                                //因为OBJECTID是主键，所以只需要指定主键即可</span><br><span class="line">                                g=new Graphic(&quot;&quot;,&quot;&quot;,&#123;</span><br><span class="line">                                    &quot;OBJECTID&quot;:34</span><br><span class="line">                                &#125;);</span><br><span class="line">                                //创建删除对象</span><br><span class="line">                                var de=new Delete(&#123;</span><br><span class="line">                                    &quot;featureLayer&quot;:featureLayer,</span><br><span class="line">                                    &quot;deletedGraphics&quot;:[g]</span><br><span class="line">                                &#125;);</span><br><span class="line">                                //执行删除结果</span><br><span class="line">                                de.performRedo();</span><br><span class="line">                                //刷新图层</span><br><span class="line">                                layer.refresh();</span><br><span class="line">                                break;</span><br><span class="line">                            case &quot;修改要素&quot;:</span><br><span class="line">                                //用于修改要素的函数,查询更新为36的要素</span><br><span class="line">                                updateFeature(36);</span><br><span class="line">                                break;                          </span><br><span class="line">                            case &quot;查询要素&quot;:</span><br><span class="line">                                //用于查询要素的函数，查询主键为36的要素</span><br><span class="line">                                searchFeather(36);</span><br><span class="line">                                break;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br></pre></td></tr></table></figure></p>
<p>如果是添加操作（利用draw添加geometry属性）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//当画图完毕时，添加要素</span><br><span class="line">                    on(d, &quot;draw-complete&quot;, function (result) &#123;</span><br><span class="line">                        //要素只赋予了geometry，属性信息为空</span><br><span class="line">                        var graphic = new Graphic(result.geometry, null,&#123;&#125;);</span><br><span class="line">                        var add=new Add(&#123;</span><br><span class="line">                            &quot;featureLayer&quot;:featureLayer,//给哪一个要素图层添加要素</span><br><span class="line">                            &quot;addedGraphics&quot;:[graphic]//用于添加的要素</span><br><span class="line">                        &#125;)</span><br><span class="line">                        //执行添加函数</span><br><span class="line">                        add.performRedo();</span><br><span class="line">                        //刷新视图</span><br><span class="line">                        layer.refresh();</span><br><span class="line">                        //关闭绘图对象</span><br><span class="line">                        d.deactivate();</span><br><span class="line">                    &#125;);</span><br></pre></td></tr></table></figure></p>
<p>如果是查询操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">//根据id查询要素</span><br><span class="line">            function searchFeather(id,callback)&#123;</span><br><span class="line">                        //得到要素图层的主键属性</span><br><span class="line">                        var idProperty = featureLayer.objectIdField;</span><br><span class="line">                        //定义查询参数</span><br><span class="line">                        var query = new Query();</span><br><span class="line">                        //是否返回几何形状</span><br><span class="line">                        query.returnGeometry = false;</span><br><span class="line">                        //图层的主键名称（根据自己要求修改）</span><br><span class="line">                        query.objectIds = [id];</span><br><span class="line">                        //查询条件1=1意思是：只根据主键查询，忽略where子句</span><br><span class="line">                        query.where = &quot;1=1&quot;;</span><br><span class="line">                        //进行查询</span><br><span class="line">                        featureLayer.selectFeatures(query, FeatureLayer.SELECTION_NEW,function(result)&#123;</span><br><span class="line">                            //如果callback不存在，说明仅仅是查询操作</span><br><span class="line">                            if(!callback)&#123;</span><br><span class="line">                                //因为我们根据主键查询，一定只有一个元素</span><br><span class="line">                                var graphic=result[0];</span><br><span class="line">                                //获得属性</span><br><span class="line">                                var attributes=graphic.attributes;</span><br><span class="line">                                //得到该属性信息转换成字符串</span><br><span class="line">                                var result=jsonUtil.stringify(attributes)</span><br><span class="line">                                //将结果弹出一下</span><br><span class="line">                                alert(result);</span><br><span class="line">                            &#125;else//如果callback存在，说明是更新操作</span><br><span class="line">                            &#123;</span><br><span class="line">                                callback(result);</span><br><span class="line">                            &#125;</span><br><span class="line">                            </span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br></pre></td></tr></table></figure></p>
<p>如果是更新操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">//根据id修改要素</span><br><span class="line">                    function updateFeature(id)&#123;</span><br><span class="line">                        //注意:（第二个参数）这里传入一个回调函数，用于处理查询出来的数据</span><br><span class="line">                        searchFeather(id,function(result)&#123;</span><br><span class="line">                                //获得旧的要素</span><br><span class="line">                                var oldgraphic=result[0];</span><br><span class="line">                                //新的要素</span><br><span class="line">                                var newgraphic=new Graphic(oldgraphic.toJson());</span><br><span class="line">                                //将alias属性修改为:修改后的C区</span><br><span class="line">                                newgraphic.attributes.alias=&quot;修改后的C区&quot;;</span><br><span class="line">                                //创建更新对象</span><br><span class="line">                                var update=new Update(&#123;</span><br><span class="line">                                    &quot;featureLayer&quot;:featureLayer,</span><br><span class="line">                                    &quot;postUpdatedGraphics&quot;:[newgraphic],//修改之后的要素</span><br><span class="line">                                    &quot;preUpdatedGraphics&quot;:[oldgraphic]//修改之前的要素</span><br><span class="line">                                &#125;)</span><br><span class="line">                                //执行刷新操作</span><br><span class="line">                                update.performRedo();</span><br><span class="line">                                //刷新视图</span><br><span class="line">                                layer.refresh();</span><br><span class="line">                                alert(&quot;修改成功&quot;);</span><br><span class="line">                                </span><br><span class="line">                        &#125;)</span><br><span class="line">                        </span><br><span class="line">                    &#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="全部代码"><a href="#全部代码" class="headerlink" title="全部代码"></a>全部代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;/&gt;</span><br><span class="line">    &lt;title&gt;WebGIS&lt;/title&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script  type=&quot;text/Javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">        .MapClass&#123;</span><br><span class="line">            width:100%;</span><br><span class="line">            height:500px;</span><br><span class="line">            border:1px solid #000;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line"></span><br><span class="line">        require([&quot;esri/map&quot;,</span><br><span class="line">        &quot;dojo/on&quot;,</span><br><span class="line">        &quot;dojo/query&quot;,</span><br><span class="line">        &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">        &quot;esri/toolbars/draw&quot;,</span><br><span class="line">        &quot;esri/layers/FeatureLayer&quot;,</span><br><span class="line">        &quot;esri/graphic&quot;, &quot;esri/dijit/editing/Add&quot;,</span><br><span class="line">        &quot;esri/dijit/editing/Delete&quot;,&quot;esri/dijit/editing/Update&quot;,&quot;esri/tasks/query&quot;,&quot;dojo/json&quot;,</span><br><span class="line">        &quot;dojo/domReady!&quot;],</span><br><span class="line">                function (Map,on,query, ArcGISDynamicMapServiceLayer, Draw,FeatureLayer,Graphic,Add,Delete,Update,Query,jsonUtil) &#123;</span><br><span class="line"></span><br><span class="line">                    </span><br><span class="line">                    var map = new esri.Map(&quot;MyMapDiv&quot;);</span><br><span class="line">                    var layer = new ArcGISDynamicMapServiceLayer(&quot;http://localhost:6080/arcgis/rest/services/Test/ft/MapServer&quot;);</span><br><span class="line">                    map.addLayer(layer);</span><br><span class="line">                    //用于操作的要素图层，注意我们是操作的宿舍楼图层</span><br><span class="line">                    var featureLayer = new FeatureLayer(&quot;http://localhost:6080/arcgis/rest/services/Test/ft/FeatureServer/1&quot;,</span><br><span class="line">                         &#123;</span><br><span class="line">                            mode:FeatureLayer.MODE_SNAPSHOT,</span><br><span class="line">                            outFields: [&quot;*&quot;]</span><br><span class="line">                         &#125;);</span><br><span class="line">                    //在添加要素时，利用Draw工具获得geometry对象</span><br><span class="line">                    var d = new Draw(map, &#123; showTooltips: true &#125;);</span><br><span class="line">                    //要操作的graphic</span><br><span class="line">                    var g;</span><br><span class="line">                    query(&quot;button&quot;).on(&quot;click&quot;,function(event)&#123;</span><br><span class="line">                        var value=this.innerHTML;</span><br><span class="line">                        switch(value)&#123;</span><br><span class="line">                            case &quot;添加要素&quot;:</span><br><span class="line">                                d.activate(Draw.POLYGON);</span><br><span class="line">                                break;</span><br><span class="line">                            case &quot;删除要素&quot;:</span><br><span class="line">                                //创建Graphic对象，删除OBJECTID为34的元素，</span><br><span class="line">                                //因为OBJECTID是主键，所以只需要指定主键即可</span><br><span class="line">                                g=new Graphic(&quot;&quot;,&quot;&quot;,&#123;</span><br><span class="line">                                    &quot;OBJECTID&quot;:34</span><br><span class="line">                                &#125;);</span><br><span class="line">                                //创建删除对象</span><br><span class="line">                                var de=new Delete(&#123;</span><br><span class="line">                                    &quot;featureLayer&quot;:featureLayer,</span><br><span class="line">                                    &quot;deletedGraphics&quot;:[g]</span><br><span class="line">                                &#125;);</span><br><span class="line">                                //执行删除结果</span><br><span class="line">                                de.performRedo();</span><br><span class="line">                                //刷新图层</span><br><span class="line">                                layer.refresh();</span><br><span class="line">                                break;</span><br><span class="line">                            case &quot;修改要素&quot;:</span><br><span class="line">                                //用于修改要素的函数,查询更新为36的要素</span><br><span class="line">                                updateFeature(1);</span><br><span class="line">                                break;                          </span><br><span class="line">                            case &quot;查询要素&quot;:</span><br><span class="line">                                //用于查询要素的函数，查询主键为36的要素</span><br><span class="line">                                searchFeather(1);</span><br><span class="line">                                break;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    //当画图完毕时，添加要素</span><br><span class="line">                    on(d, &quot;draw-complete&quot;, function (result) &#123;</span><br><span class="line">                        //要素只赋予了geometry，属性信息为空</span><br><span class="line">                        var graphic = new Graphic(result.geometry, null,&#123;&#125;);</span><br><span class="line">                        var add=new Add(&#123;</span><br><span class="line">                            &quot;featureLayer&quot;:featureLayer,//给哪一个要素图层添加要素</span><br><span class="line">                            &quot;addedGraphics&quot;:[graphic]//用于添加的要素</span><br><span class="line">                        &#125;)</span><br><span class="line">                        //执行添加函数</span><br><span class="line">                        add.performRedo();</span><br><span class="line">                        //刷新视图</span><br><span class="line">                        layer.refresh();</span><br><span class="line">                        //关闭绘图对象</span><br><span class="line">                        d.deactivate();</span><br><span class="line">                    &#125;);</span><br><span class="line">                    //根据id修改要素</span><br><span class="line">                    function updateFeature(id)&#123;</span><br><span class="line">                        //注意:（第二个参数）这里传入一个回调函数，用于处理查询出来的数据</span><br><span class="line">                        searchFeather(id,function(result)&#123;</span><br><span class="line">                                //获得旧的要素</span><br><span class="line">                                var oldgraphic=result[0];</span><br><span class="line">                                //新的要素</span><br><span class="line">                                var newgraphic=new Graphic(oldgraphic.toJson());</span><br><span class="line">                                //将alias属性修改为:修改后的A区宿舍</span><br><span class="line">                                newgraphic.attributes.alias=&quot;修改后的A区宿舍&quot;;</span><br><span class="line">                                //创建更新对象</span><br><span class="line">                                var update=new Update(&#123;</span><br><span class="line">                                    &quot;featureLayer&quot;:featureLayer,</span><br><span class="line">                                    &quot;postUpdatedGraphics&quot;:[newgraphic],//修改之后的要素</span><br><span class="line">                                    &quot;preUpdatedGraphics&quot;:[oldgraphic]//修改之前的要素</span><br><span class="line">                                &#125;)</span><br><span class="line">                                //执行刷新操作</span><br><span class="line">                                update.performRedo();</span><br><span class="line">                                //刷新视图</span><br><span class="line">                                layer.refresh();</span><br><span class="line">                                alert(&quot;修改成功&quot;);</span><br><span class="line">                                </span><br><span class="line">                        &#125;)</span><br><span class="line">                        </span><br><span class="line">                    &#125;</span><br><span class="line">                    //根据id查询要素</span><br><span class="line">                    function searchFeather(id,callback)&#123;</span><br><span class="line">                        //得到要素图层的主键属性</span><br><span class="line">                        var idProperty = featureLayer.objectIdField;</span><br><span class="line">                        //定义查询参数</span><br><span class="line">                        var query = new Query();</span><br><span class="line">                        //是否返回几何形状</span><br><span class="line">                        query.returnGeometry = false;</span><br><span class="line">                        //图层的主键名称（根据自己要求修改）</span><br><span class="line">                        query.objectIds = [id];</span><br><span class="line">                        //查询条件1=1意思是：只根据主键查询，忽略where子句</span><br><span class="line">                        query.where = &quot;1=1&quot;;</span><br><span class="line">                        //进行查询</span><br><span class="line">                        featureLayer.selectFeatures(query, FeatureLayer.SELECTION_NEW,function(result)&#123;</span><br><span class="line">                            //如果callback不存在，说明仅仅是查询操作</span><br><span class="line">                            if(!callback)&#123;</span><br><span class="line">                                //因为我们根据主键查询，一定只有一个元素</span><br><span class="line">                                var graphic=result[0];</span><br><span class="line">                                //获得属性</span><br><span class="line">                                var attributes=graphic.attributes;</span><br><span class="line">                                //得到该属性信息转换成字符串</span><br><span class="line">                                var result=jsonUtil.stringify(attributes)</span><br><span class="line">                                //将结果弹出一下</span><br><span class="line">                                alert(result);</span><br><span class="line">                            &#125;else//如果callback存在，说明是更新操作</span><br><span class="line">                            &#123;</span><br><span class="line">                                callback(result);</span><br><span class="line">                            &#125;</span><br><span class="line">                            </span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;MyMapDiv&quot; class=&quot;MapClass&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;button class=&quot;btn&quot;&gt;添加要素&lt;/button&gt;</span><br><span class="line">&lt;button class=&quot;btn&quot;&gt;删除要素&lt;/button&gt;</span><br><span class="line">&lt;button class=&quot;btn&quot;&gt;修改要素&lt;/button&gt;</span><br><span class="line">&lt;button class=&quot;btn&quot;&gt;查询要素&lt;/button&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
        <div>
            <ul class="tags-category-list"><li class="tags-category-list-item"><a class="tags-category-list-link" href="/tags/ArcGIS-API-for-JS/">ArcGIS API for JS</a></li></ul>
        </div>
        <div class="bottom-line"></div>
        
    <nav id="article-nav">
        
            <a href="/2019/08/06/ArcGIS-API-for-JS21/" id="article-nav-newer" class="article-nav-link-wrap">
        <span class="article-nav-title">
            
                ArcGIS API For Javascript之网络分析
            
        </span>
                <strong class="article-nav-caption">&gt;</strong>
            </a>
        
        
            <a href="/2019/08/06/ArcGIS-API-for-JS19/" id="article-nav-older" class="article-nav-link-wrap">
                <strong class="article-nav-caption">&lt;</strong>
                <span class="article-nav-title">
                    
                        ArcGIS API For Javacsript编辑客户端图形
                </span>
                
            </a>
        
    </nav>


        
    </article>
    <div id="toc">
        
            <h2>文章目录</h2>
            <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#需求（服务器端图层编辑）"><span class="toc-number">1.</span> <span class="toc-text">需求（服务器端图层编辑）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现"><span class="toc-number">2.</span> <span class="toc-text">实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#全部代码"><span class="toc-number">2.1.</span> <span class="toc-text">全部代码</span></a></li></ol></li></ol>
        
    </div>
</div>

    </div>
</div>
<footer id="footer">
     <div id="copyright">&copy; I&#39;m xiedandan  2020</div>
     
             <!-- 不蒜子统计 -->
             <span id="busuanzi_container_site_pv">
                     本站总访问量<span id="busuanzi_value_site_pv" style='color:#17a167'></span>次
             </span>
             <span class="post-meta-divider">|</span>
             <span id="busuanzi_container_site_uv">
                     本站访客数<span id="busuanzi_value_site_uv"  style='color:#17a167'></span>人
             </span>
             <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
       
    <div id="theme">
        Powered by <a href="http://hexo.io">Hexo</a>. Theme by <a href="https://github.com/markyong/hexo-theme-stage">Stage</a>
    </div>
</footer>
<script src="/lib/js/waterrippleeffect.min.js"></script>
<script src="/js/header-bg.main.js"></script>

    <script src="/lib/js/smooth-scroll.min.js"></script>
    <script src="/js/toc.main.js"></script>

</body>
</html>
