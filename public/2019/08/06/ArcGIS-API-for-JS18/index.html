
<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="UTF-8">
    <title>ArcGIS API For Javascript之动态图层 | DD_XIE的学习笔记</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="">
    <meta name="description" content="动态图层主要特点：

改变地图服务的现有图层
动态图层适用于海量图层的情况
不需要将shp文件发布为服务，服务器可以直接读取shp文件在前端显示

调用动态图层在前面已经说过动态图层并不是一种新的服务类型，而是地图服务的一种扩展，因此我们不需要发布服务，只需要对地图服务添加动态图层功能即可。启用地图服务的步骤为：

给相应的地图服务启用动态工作空间
选择服务器相应的硬盘地址并赋予其id
将相应位置注册到ArcGIS Server服务器（保证ArcGIS Server可以访问数据）
在Web端进行调用

启用动态图层我们打开Manager-&amp;gt;登录，找到该服务，点击功能，选择允许每次请求修改图层顺序和符号-&amp;gt;添加...">
    
        <link rel="icon" href="/favicon.ico">
    
    
        
            <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
        
            <link rel="stylesheet" href="/css/stage.css">
        
            <link rel="stylesheet" href="/css/avatar-bg.css">
        
    
</head>
</html>
<body>
<header id="header">
    <div class="menu">
        <i class="fa fa-bars"></i>
    </div>
    <div class="header-main">
        <h1><a href="/">DD_XIE的学习笔记</a></h1>
    </div>
    <div id="nav">
        <div class="nav-img" id="nav-img"></div>
        <div class="sentences">
            云里写诗，泥里生活，岁月里洒脱。
        </div>
    </div>
</header>

<div id="content-outer">
    <div id="content-inner">
        <div class="clearfix">
    <article id="post">
        <h1>ArcGIS API For Javascript之动态图层</h1>
        <div class="create">
            <span>创建于</span>
            
                <time datetime="2019-08-06T08:42:34.000Z">
                    2019-08-06
                </time>
            
            <ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/ArcGIS/">ArcGIS</a></li></ul>
        </div>
        <p>动态图层主要特点：</p>
<ul>
<li>改变地图服务的现有图层</li>
<li>动态图层适用于海量图层的情况</li>
<li>不需要将shp文件发布为服务，服务器可以直接读取shp文件在前端显示</li>
</ul>
<h3 id="调用动态图层"><a href="#调用动态图层" class="headerlink" title="调用动态图层"></a>调用动态图层</h3><p>在前面已经说过动态图层并不是一种新的服务类型，而是地图服务的一种扩展，因此我们不需要发布服务，只需要对地图服务添加动态图层功能即可。启用地图服务的步骤为：</p>
<ul>
<li>给相应的地图服务启用动态工作空间</li>
<li>选择服务器相应的硬盘地址并赋予其id</li>
<li>将相应位置注册到ArcGIS Server服务器（保证ArcGIS Server可以访问数据）</li>
<li>在Web端进行调用</li>
</ul>
<h4 id="启用动态图层"><a href="#启用动态图层" class="headerlink" title="启用动态图层"></a>启用动态图层</h4><p>我们打开Manager-&gt;登录，找到该服务，点击功能，选择允许每次请求修改图层顺序和符号-&gt;添加<br><img src="/2019/08/06/ArcGIS-API-for-JS18/01.png" alt="01.png"><br>硬盘上的数据<br><img src="/2019/08/06/ArcGIS-API-for-JS18/02.png" alt="02.png"><br>注:D:\myshp文件夹下面有一个shp文件：lunkuoxian.shp<br>因此我们选择工作空间类型为：shpfile文件夹，工作空间id在此处取名为my，硬盘路径：D：\myshp<br><img src="/2019/08/06/ArcGIS-API-for-JS18/03.png" alt="03.png"><br>点击确定，重新启动服务<br><img src="/2019/08/06/ArcGIS-API-for-JS18/04.png" alt="04.png"><br><img src="/2019/08/06/ArcGIS-API-for-JS18/05.png" alt="05.png"><br>注册文件夹到服务器<br>点击站点-&gt;数据存储-&gt;注册文件夹（因为我们是文件夹，所以是注册文件夹，如果是数据库，那么就要注册数据库）<br><img src="/2019/08/06/ArcGIS-API-for-JS18/06.png" alt="06.png"><br><img src="/2019/08/06/ArcGIS-API-for-JS18/07.png" alt="07.png"><br><img src="/2019/08/06/ArcGIS-API-for-JS18/08.png" alt="08.png"><br>在Services Directory 查看动态图层是否启用<br><img src="/2019/08/06/ArcGIS-API-for-JS18/09.png" alt="09.png"></p>
<h4 id="Web端调用"><a href="#Web端调用" class="headerlink" title="Web端调用"></a>Web端调用</h4><h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><p>首先我们加载地图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">require([&quot;esri/map&quot;,</span><br><span class="line">            &quot;dojo/dom&quot;,</span><br><span class="line">            &quot;dojo/on&quot;,</span><br><span class="line">            &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">            &quot;esri/layers/FeatureLayer&quot;,</span><br><span class="line">            &quot;esri/layers/TableDataSource&quot;,</span><br><span class="line">            &quot;esri/layers/LayerDataSource&quot;,</span><br><span class="line">            &quot;esri/renderers/SimpleRenderer&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleMarkerSymbol&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleLineSymbol&quot;,</span><br><span class="line">            &quot;dojo/domReady!&quot;], function (</span><br><span class="line">                Map,dom,on, ArcGISDynamicMapServiceLayer, FeatureLayer, TableDataSource, LayerDataSource, SimpleRenderer, SimpleMarkerSymbol,SimpleLineSymbol) &#123;</span><br><span class="line">            var map = new Map(&quot;mapDiv&quot;);</span><br><span class="line">            var layer1 = new ArcGISDynamicMapServiceLayer(&quot;http://localhost:6080/arcgis/rest/services//Test/MyService/MapServer&quot;);</span><br><span class="line">            map.addLayer(layer1);</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure></p>
<p>添加一个按钮（用于添加动态图层）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button id=&quot;btn&quot;&gt;添加动态图层&lt;/button&gt;</span><br></pre></td></tr></table></figure></p>
<p>给按钮添加事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">on(dom.byId(&quot;btn&quot;),&quot;click&quot;,function(e)&#123;</span><br><span class="line">                //定义一个数据源</span><br><span class="line">                var dataSource = new TableDataSource();</span><br><span class="line">                //此处为我们设置的命名空间</span><br><span class="line">                dataSource.workspaceId = &quot;my&quot;;</span><br><span class="line">                //命名空间下面的shp</span><br><span class="line">                dataSource.dataSourceName = &quot;lunkuoxian.shp&quot;;</span><br><span class="line">                //定义一个图层数据源</span><br><span class="line">                var layerSource = new LayerDataSource();</span><br><span class="line">                //给图层数据源赋值</span><br><span class="line">                layerSource.dataSource = dataSource;</span><br><span class="line">                //定义一个要素图层:注意链接为动态图层的地址</span><br><span class="line">                var layer2 = new FeatureLayer(&quot;http://localhost:6080/arcgis/rest/services/Test/MyService/MapServer/dynamicLayer&quot;, &#123;</span><br><span class="line">                    mode: FeatureLayer.MODE_ONDEMAND,</span><br><span class="line">                    outFields: [&quot;*&quot;],</span><br><span class="line">                    source: layerSource</span><br><span class="line">                &#125;);</span><br><span class="line">                //定义线符号</span><br><span class="line">                var lineSymbol = new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new dojo.Color([255, 0, 0]), 3);</span><br><span class="line">                //定义渲染器</span><br><span class="line">                var renderer = new esri.renderer.SimpleRenderer(lineSymbol);</span><br><span class="line">                //定义渲染器</span><br><span class="line">                layer2.setRenderer(renderer);</span><br><span class="line">                layer2.refresh();</span><br><span class="line">                map.addLayer(layer2);</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure></p>
<h5 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head lang=&quot;en&quot;&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script  type=&quot;text/Javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">        require([&quot;esri/map&quot;,</span><br><span class="line">            &quot;dojo/dom&quot;,</span><br><span class="line">            &quot;dojo/on&quot;,</span><br><span class="line">            &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">            &quot;esri/layers/FeatureLayer&quot;,</span><br><span class="line">            &quot;esri/layers/TableDataSource&quot;,</span><br><span class="line">            &quot;esri/layers/LayerDataSource&quot;,</span><br><span class="line">            &quot;esri/renderers/SimpleRenderer&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleLineSymbol&quot;,</span><br><span class="line">            &quot;dojo/domReady!&quot;], function (</span><br><span class="line">                Map,dom,on, ArcGISDynamicMapServiceLayer, FeatureLayer, TableDataSource, LayerDataSource, SimpleRenderer,SimpleLineSymbol) &#123;</span><br><span class="line">            var map = new Map(&quot;mapDiv&quot;);</span><br><span class="line">            var layer1 = new ArcGISDynamicMapServiceLayer(&quot;http://localhost:6080/arcgis/rest/services//Test/MyService/MapServer&quot;);</span><br><span class="line">            map.addLayer(layer1);</span><br><span class="line"></span><br><span class="line">            on(dom.byId(&quot;btn&quot;),&quot;click&quot;,function(e)&#123;</span><br><span class="line">                //定义一个数据源</span><br><span class="line">                var dataSource = new TableDataSource();</span><br><span class="line">                //此处为我们设置的命名空间</span><br><span class="line">                dataSource.workspaceId = &quot;my&quot;;</span><br><span class="line">                //命名空间下面的shp</span><br><span class="line">                dataSource.dataSourceName = &quot;lunkuoxian.shp&quot;;</span><br><span class="line">                //定义一个图层数据源</span><br><span class="line">                var layerSource = new LayerDataSource();</span><br><span class="line">                //给图层数据源赋值</span><br><span class="line">                layerSource.dataSource = dataSource;</span><br><span class="line">                //定义一个要素图层:注意链接为动态图层的地址</span><br><span class="line">                var layer2 = new FeatureLayer(&quot;http://localhost:6080/arcgis/rest/services/Test/MyService/MapServer/dynamicLayer&quot;, &#123;</span><br><span class="line">                    mode: FeatureLayer.MODE_ONDEMAND,</span><br><span class="line">                    outFields: [&quot;*&quot;],</span><br><span class="line">                    source: layerSource</span><br><span class="line">                &#125;);</span><br><span class="line">                //定义线符号</span><br><span class="line">                var lineSymbol = new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new dojo.Color([255, 0, 0]), 3);</span><br><span class="line">                //定义渲染器</span><br><span class="line">                var renderer = new esri.renderer.SimpleRenderer(lineSymbol);</span><br><span class="line">                //定义渲染器</span><br><span class="line">                layer2.setRenderer(renderer);</span><br><span class="line">                layer2.refresh();</span><br><span class="line">                map.addLayer(layer2);</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">        &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;mapDiv&quot; style=&quot;height:600px;&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;button id=&quot;btn&quot;&gt;添加动态图层&lt;/button&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>运行结果之后：<br><img src="/2019/08/06/ArcGIS-API-for-JS18/10.png" alt="10.png"></p>
<h3 id="动态图层的属性查询"><a href="#动态图层的属性查询" class="headerlink" title="动态图层的属性查询"></a>动态图层的属性查询</h3><p>在真实需求中,我们不仅仅是将shp在地图中显示那么简单，我们往往要查询该图层的属性信息,我们在前面代码的基础上添加上属性查询。</p>
<h4 id="方法1（通过click直接获取）"><a href="#方法1（通过click直接获取）" class="headerlink" title="方法1（通过click直接获取）"></a>方法1（通过click直接获取）</h4><h5 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h5><p>给要素图层添加点击事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">layer2.on(&quot;click&quot;, function(evt) &#123;</span><br><span class="line">                    //得到点击的graphics</span><br><span class="line">                    var graphic=evt.graphic;</span><br><span class="line">                    //得到该属性信息</span><br><span class="line">                    var attributes=graphic.attributes;</span><br><span class="line">                    //得到该属性信息转换成字符串</span><br><span class="line">                    var result=jsonUtil.stringify(attributes)</span><br><span class="line">                    //将结果弹出一下</span><br><span class="line">                    alert(result);</span><br><span class="line">                    //获得要素图层的主键名称</span><br><span class="line">                    </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h5 id="全部代码"><a href="#全部代码" class="headerlink" title="全部代码"></a>全部代码</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head lang=&quot;en&quot;&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script  type=&quot;text/Javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">        require([&quot;esri/map&quot;,</span><br><span class="line">            &quot;dojo/dom&quot;,</span><br><span class="line">            &quot;dojo/on&quot;,</span><br><span class="line">            &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">            &quot;esri/layers/FeatureLayer&quot;,</span><br><span class="line">            &quot;esri/layers/TableDataSource&quot;,</span><br><span class="line">            &quot;esri/layers/LayerDataSource&quot;,</span><br><span class="line">            &quot;esri/renderers/SimpleRenderer&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleLineSymbol&quot;,&quot;dojo/json&quot;,</span><br><span class="line">            &quot;dojo/domReady!&quot;], function (</span><br><span class="line">                Map,dom,on, ArcGISDynamicMapServiceLayer, FeatureLayer, TableDataSource, LayerDataSource, SimpleRenderer,SimpleLineSymbol,jsonUtil) &#123;</span><br><span class="line">            var map = new Map(&quot;mapDiv&quot;);</span><br><span class="line">            var layer1 = new ArcGISDynamicMapServiceLayer(&quot;http://localhost:6080/arcgis/rest/services//Test/MyService/MapServer&quot;);</span><br><span class="line">            map.addLayer(layer1);</span><br><span class="line"></span><br><span class="line">            on(dom.byId(&quot;btn&quot;),&quot;click&quot;,function(e)&#123;</span><br><span class="line">                //定义一个数据源</span><br><span class="line">                var dataSource = new TableDataSource();</span><br><span class="line">                //此处为我们设置的命名空间</span><br><span class="line">                dataSource.workspaceId = &quot;my&quot;;</span><br><span class="line">                //命名空间下面的shp</span><br><span class="line">                dataSource.dataSourceName = &quot;lunkuoxian.shp&quot;;</span><br><span class="line">                //定义一个图层数据源</span><br><span class="line">                var layerSource = new LayerDataSource();</span><br><span class="line">                //给图层数据源赋值</span><br><span class="line">                layerSource.dataSource = dataSource;</span><br><span class="line">                //定义一个要素图层:注意链接为动态图层的地址</span><br><span class="line">                var layer2 = new FeatureLayer(&quot;http://localhost:6080/arcgis/rest/services/Test/MyService/MapServer/dynamicLayer&quot;, &#123;</span><br><span class="line">                    mode: FeatureLayer.MODE_ONDEMAND,</span><br><span class="line">                    outFields: [&quot;*&quot;],</span><br><span class="line">                    source: layerSource</span><br><span class="line">                &#125;);</span><br><span class="line">                //定义线符号</span><br><span class="line">                var lineSymbol = new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new dojo.Color([255, 0, 0]), 3);</span><br><span class="line">                //定义渲染器</span><br><span class="line">                var renderer = new esri.renderer.SimpleRenderer(lineSymbol);</span><br><span class="line">                //定义渲染器</span><br><span class="line">                layer2.setRenderer(renderer);</span><br><span class="line">                layer2.refresh();</span><br><span class="line">                map.addLayer(layer2);</span><br><span class="line">                layer2.on(&quot;click&quot;, function(evt) &#123;</span><br><span class="line">                    //得到点击的graphics</span><br><span class="line">                    var graphic=evt.graphic;</span><br><span class="line">                    //得到该属性信息</span><br><span class="line">                    var attributes=graphic.attributes;</span><br><span class="line">                    //得到该属性信息转换成字符串</span><br><span class="line">                    var result=jsonUtil.stringify(attributes)</span><br><span class="line">                    //将结果弹出一下</span><br><span class="line">                    alert(result);</span><br><span class="line">                    //获得要素图层的主键名称</span><br><span class="line"></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">        &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;mapDiv&quot; style=&quot;height:600px;&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;button id=&quot;btn&quot;&gt;添加动态图层&lt;/button&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>运行结果:<br><img src="/2019/08/06/ArcGIS-API-for-JS18/11.png" alt="11.png"></p>
<h4 id="通过查询获得属性"><a href="#通过查询获得属性" class="headerlink" title="通过查询获得属性"></a>通过查询获得属性</h4><h5 id="代码实现-2"><a href="#代码实现-2" class="headerlink" title="代码实现"></a>代码实现</h5><p>定义一个按钮（用户获得属性）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button id=&quot;attr&quot;&gt;用户弹出属性&lt;/button&gt;</span><br></pre></td></tr></table></figure></p>
<p>给相应的按钮绑定事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">on(dom.byId(&quot;attr&quot;),&quot;click&quot;,function()&#123;</span><br><span class="line">                    //得到要素图层的主键属性</span><br><span class="line">                    var idProperty = layer2.objectIdField;</span><br><span class="line">                    //定义查询参数</span><br><span class="line">                    var query = new Query();</span><br><span class="line">                    //是否返回几何形状</span><br><span class="line">                    query.returnGeometry = false;</span><br><span class="line">                    //图层的主键名称（根据自己要求修改）</span><br><span class="line">                    query.objectIds = [247];</span><br><span class="line">                    //查询条件1=1意思是：只根据主键查询，忽略where子句</span><br><span class="line">                    query.where = &quot;1=1&quot;;</span><br><span class="line">                    //进行查询</span><br><span class="line">                    layer2.selectFeatures(query, FeatureLayer.SELECTION_NEW,function(result)&#123;</span><br><span class="line">                        //因为我们根据主键查询，一定只有一个元素</span><br><span class="line">                        var graphic=result[0];</span><br><span class="line">                        //获得属性</span><br><span class="line">                        var attributes=graphic.attributes;</span><br><span class="line">                        //得到该属性信息转换成字符串</span><br><span class="line">                        var result=jsonUtil.stringify(attributes)</span><br><span class="line">                        //将结果弹出一下</span><br><span class="line">                        alert(result);</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line">                &#125;)</span><br></pre></td></tr></table></figure></p>
<h5 id="全部代码-1"><a href="#全部代码-1" class="headerlink" title="全部代码"></a>全部代码</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head lang=&quot;en&quot;&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/dijit/themes/tundra/tundra.css&quot;/&gt;</span><br><span class="line">    &lt;link  rel=&quot;stylesheet&quot;  type=&quot;text/css&quot; href=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/esri/css/esri.css&quot; /&gt;</span><br><span class="line">    &lt;script  type=&quot;text/Javascript&quot; src=&quot;http://localhost/arcgis_js_api/library/3.17/3.17/init.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">        require([&quot;esri/map&quot;,</span><br><span class="line">            &quot;dojo/dom&quot;,</span><br><span class="line">            &quot;dojo/on&quot;,</span><br><span class="line">            &quot;esri/layers/ArcGISDynamicMapServiceLayer&quot;,</span><br><span class="line">            &quot;esri/layers/FeatureLayer&quot;,</span><br><span class="line">            &quot;esri/layers/TableDataSource&quot;,</span><br><span class="line">            &quot;esri/layers/LayerDataSource&quot;,</span><br><span class="line">            &quot;esri/renderers/SimpleRenderer&quot;,</span><br><span class="line">            &quot;esri/symbols/SimpleLineSymbol&quot;,&quot;dojo/json&quot;,&quot;esri/tasks/query&quot;,</span><br><span class="line">            &quot;dojo/domReady!&quot;], function (</span><br><span class="line">                Map,dom,on, ArcGISDynamicMapServiceLayer, FeatureLayer, TableDataSource, LayerDataSource, SimpleRenderer,SimpleLineSymbol,jsonUtil,Query) &#123;</span><br><span class="line">            var map = new Map(&quot;mapDiv&quot;);</span><br><span class="line">            var layer1 = new ArcGISDynamicMapServiceLayer(&quot;http://localhost:6080/arcgis/rest/services//Test/MyService/MapServer&quot;);</span><br><span class="line">            map.addLayer(layer1);</span><br><span class="line"></span><br><span class="line">            on(dom.byId(&quot;btn&quot;),&quot;click&quot;,function(e)&#123;</span><br><span class="line">                //定义一个数据源</span><br><span class="line">                var dataSource = new TableDataSource();</span><br><span class="line">                //此处为我们设置的命名空间</span><br><span class="line">                dataSource.workspaceId = &quot;my&quot;;</span><br><span class="line">                //命名空间下面的shp</span><br><span class="line">                dataSource.dataSourceName = &quot;lunkuoxian.shp&quot;;</span><br><span class="line">                //定义一个图层数据源</span><br><span class="line">                var layerSource = new LayerDataSource();</span><br><span class="line">                //给图层数据源赋值</span><br><span class="line">                layerSource.dataSource = dataSource;</span><br><span class="line">                //定义一个要素图层:注意链接为动态图层的地址</span><br><span class="line">                var layer2 = new FeatureLayer(&quot;http://localhost:6080/arcgis/rest/services/Test/MyService/MapServer/dynamicLayer&quot;, &#123;</span><br><span class="line">                    mode: FeatureLayer.MODE_ONDEMAND,</span><br><span class="line">                    outFields: [&quot;*&quot;],</span><br><span class="line">                    source: layerSource</span><br><span class="line">                &#125;);</span><br><span class="line">                //定义线符号</span><br><span class="line">                var lineSymbol = new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASH, new dojo.Color([255, 0, 0]), 3);</span><br><span class="line">                //定义渲染器</span><br><span class="line">                var renderer = new esri.renderer.SimpleRenderer(lineSymbol);</span><br><span class="line">                //定义渲染器</span><br><span class="line">                layer2.setRenderer(renderer);</span><br><span class="line">                layer2.refresh();</span><br><span class="line">                map.addLayer(layer2);</span><br><span class="line">                on(dom.byId(&quot;attr&quot;),&quot;click&quot;,function()&#123;</span><br><span class="line">                    //得到要素图层的主键属性</span><br><span class="line">                    var idProperty = layer2.objectIdField;</span><br><span class="line">                    //定义查询参数</span><br><span class="line">                    var query = new Query();</span><br><span class="line">                    //是否返回几何形状</span><br><span class="line">                    query.returnGeometry = false;</span><br><span class="line">                    //图层的主键名称（根据自己要求修改）</span><br><span class="line">                    query.objectIds = [247];</span><br><span class="line">                    //查询条件1=1意思是：只根据主键查询，忽略where子句</span><br><span class="line">                    query.where = &quot;1=1&quot;;</span><br><span class="line">                    //进行查询</span><br><span class="line">                    layer2.selectFeatures(query, FeatureLayer.SELECTION_NEW,function(result)&#123;</span><br><span class="line">                        //因为我们根据主键查询，一定只有一个元素</span><br><span class="line">                        var graphic=result[0];</span><br><span class="line">                        //获得属性</span><br><span class="line">                        var attributes=graphic.attributes;</span><br><span class="line">                        //得到该属性信息转换成字符串</span><br><span class="line">                        var result=jsonUtil.stringify(attributes)</span><br><span class="line">                        //将结果弹出一下</span><br><span class="line">                        alert(result);</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">        &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;mapDiv&quot; style=&quot;height:600px;&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;button id=&quot;btn&quot;&gt;添加动态图层&lt;/button&gt;</span><br><span class="line">&lt;button id=&quot;attr&quot;&gt;用户弹出属性&lt;/button&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><h4 id="启用文件地理数据库三点不同"><a href="#启用文件地理数据库三点不同" class="headerlink" title="启用文件地理数据库三点不同"></a>启用文件地理数据库三点不同</h4><p>文件的目录<br><img src="/2019/08/06/ArcGIS-API-for-JS18/12.png" alt="12.png"><br>命名空间配置<br><img src="/2019/08/06/ArcGIS-API-for-JS18/13.png" alt="13.png"><br>注册文件夹配置<br><img src="/2019/08/06/ArcGIS-API-for-JS18/14.png" alt="14.png"><br>代码调用差别<br><img src="/2019/08/06/ArcGIS-API-for-JS18/15.png" alt="15.png"><br>注意：忽略了要素集的存在，即调用是lunkuoxian，而不是vector.lunkuoxian，调用的时候后面没有*.shp</p>

        <div>
            <ul class="tags-category-list"><li class="tags-category-list-item"><a class="tags-category-list-link" href="/tags/ArcGIS-API-for-JS/">ArcGIS API for JS</a></li></ul>
        </div>
        <div class="bottom-line"></div>
        
    <nav id="article-nav">
        
            <a href="/2019/08/06/ArcGIS-API-for-JS19/" id="article-nav-newer" class="article-nav-link-wrap">
        <span class="article-nav-title">
            
                ArcGIS API For Javacsript编辑客户端图形
            
        </span>
                <strong class="article-nav-caption">&gt;</strong>
            </a>
        
        
            <a href="/2019/08/06/ArcGIS-API-for-JS17/" id="article-nav-older" class="article-nav-link-wrap">
                <strong class="article-nav-caption">&lt;</strong>
                <span class="article-nav-title">
                    
                        ArcGIS API For Javascript调用结果地图服务
                </span>
                
            </a>
        
    </nav>


        
    </article>
    <div id="toc">
        
            <h2>文章目录</h2>
            <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#调用动态图层"><span class="toc-number">1.</span> <span class="toc-text">调用动态图层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#启用动态图层"><span class="toc-number">1.1.</span> <span class="toc-text">启用动态图层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Web端调用"><span class="toc-number">1.2.</span> <span class="toc-text">Web端调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#代码实现"><span class="toc-number">1.3.</span> <span class="toc-text">代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#完整代码"><span class="toc-number">1.3.1.</span> <span class="toc-text">完整代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#动态图层的属性查询"><span class="toc-number">2.</span> <span class="toc-text">动态图层的属性查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#方法1（通过click直接获取）"><span class="toc-number">2.1.</span> <span class="toc-text">方法1（通过click直接获取）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#代码实现-1"><span class="toc-number">2.1.1.</span> <span class="toc-text">代码实现</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#全部代码"><span class="toc-number">2.1.2.</span> <span class="toc-text">全部代码</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#通过查询获得属性"><span class="toc-number">2.2.</span> <span class="toc-text">通过查询获得属性</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#代码实现-2"><span class="toc-number">2.2.1.</span> <span class="toc-text">代码实现</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#全部代码-1"><span class="toc-number">2.2.2.</span> <span class="toc-text">全部代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#补充"><span class="toc-number">3.</span> <span class="toc-text">补充</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#启用文件地理数据库三点不同"><span class="toc-number">3.1.</span> <span class="toc-text">启用文件地理数据库三点不同</span></a></li></ol></li></ol>
        
    </div>
</div>

    </div>
</div>
<footer id="footer">
     <div id="copyright">&copy; 解丹丹  2019</div>
     
             <!-- 不蒜子统计 -->
             <span id="busuanzi_container_site_pv">
                     本站总访问量<span id="busuanzi_value_site_pv" style="color:#17a167"></span>次
             </span>
             <span class="post-meta-divider">|</span>
             <span id="busuanzi_container_site_uv">
                     本站访客数<span id="busuanzi_value_site_uv" style="color:#17a167"></span>人
             </span>
             <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
       
    <div id="theme">
        Powered by <a href="http://hexo.io">Hexo</a>. Theme by <a href="https://github.com/markyong/hexo-theme-stage">Stage</a>
    </div>
</footer>
<script src="/lib/js/waterrippleeffect.min.js"></script>
<script src="/js/header-bg.main.js"></script>

    <script src="/lib/js/smooth-scroll.min.js"></script>
    <script src="/js/toc.main.js"></script>

</body>
</html>
